import{j as e,a0 as z,a1 as C,B as i,z as _,H as P,av as A,f as a,K as g,bI as D,a_ as B,ae as H,P as N,af as F,ag as K,ah as m,ai as t,aj as V,ab as d,a4 as O,am as Z,bK as T,U as L,l as f,I as b,bn as G,aD as J,aE as U,aF as q,aH as Q,N as X,bL as Y,bM as ee,b2 as ne}from"./vendor-mui-BiVZR0IW.js";import{r as c,L as se}from"./vendor-react-CBtCGaWm.js";import{s as o}from"./semesterService-CfIHzVdr.js";import{b as ae,c as te,g as ie}from"./index-ChymPdOX.js";import"./vendor-utils-DTv3oRQQ.js";const I=te("SemesterManagement"),re=()=>{const l=ae(n=>n.showToast),[M,v]=c.useState(!0),[k,$]=c.useState([]),[r,E]=c.useState(null),[x,h]=c.useState({open:!1,action:"",semester:null}),[u,S]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{v(!0);try{const n=await o.getAllSemesters();n.success&&n.data&&$(n.data);const s=await o.getAutoSuggestion();s.success&&s.data&&E(s.data)}catch(n){I.error(" Error loading data:",{error:n}),l("Fehler beim Laden der Daten","error")}finally{v(!1)}},y=(n,s)=>{h({open:!0,action:s?"activate_with_phase":"activate",semester:n})},w=(n,s)=>{h({open:!0,action:s?"open_phase":"close_phase",semester:n})},R=async()=>{if(x.semester){S(!0);try{const{action:n,semester:s}=x;switch(n){case"activate":await o.activateSemester(s.id,!1),l(`‚úÖ ${s.bezeichnung} aktiviert`,"success");break;case"activate_with_phase":await o.activateSemester(s.id,!0),l(`‚úÖ ${s.bezeichnung} aktiviert und Planungsphase ge√∂ffnet`,"success");break;case"open_phase":await o.controlPlanningPhase(s.id,"oeffnen"),l(`‚úÖ Planungsphase f√ºr ${s.bezeichnung} ge√∂ffnet`,"success");break;case"close_phase":await o.controlPlanningPhase(s.id,"schliessen"),l(`‚úÖ Planungsphase f√ºr ${s.bezeichnung} geschlossen`,"success");break}await j()}catch(n){I.error(" Error executing action:",{error:n}),l(ie(n,"Fehler bei der Aktion"),"error")}finally{S(!1),h({open:!1,action:"",semester:null})}}},p=n=>new Date(n).toLocaleDateString("de-DE"),W=()=>{const{action:n,semester:s}=x;if(!s)return"";switch(n){case"activate":return`M√∂chten Sie "${s.bezeichnung}" als aktives Semester setzen?

Dies deaktiviert alle anderen Semester.`;case"activate_with_phase":return`M√∂chten Sie "${s.bezeichnung}" aktivieren und die Planungsphase √∂ffnen?

Dies deaktiviert alle anderen Semester und √∂ffnet die Planungsphase f√ºr dieses Semester.`;case"open_phase":return`M√∂chten Sie die Planungsphase f√ºr "${s.bezeichnung}" √∂ffnen?

Professoren k√∂nnen dann ihre Semesterplanungen einreichen.`;case"close_phase":return`M√∂chten Sie die Planungsphase f√ºr "${s.bezeichnung}" schlie√üen?

Professoren k√∂nnen dann keine neuen Planungen mehr einreichen.`;default:return""}};return M?e.jsx(z,{children:e.jsx(C,{children:e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(_,{})})})}):e.jsxs(i,{children:[r&&!r.ist_korrekt&&r.vorschlag&&e.jsxs(P,{severity:"warning",sx:{mb:3},action:e.jsx(g,{color:"inherit",size:"small",onClick:()=>y(r.vorschlag,!0),startIcon:e.jsx(D,{}),children:"Jetzt aktivieren"}),children:[e.jsx(A,{children:"üìÖ Semesterwechsel empfohlen"}),e.jsx(a,{variant:"body2",children:r.empfehlung}),e.jsxs(a,{variant:"caption",display:"block",sx:{mt:1},children:["Heute: ",p(r.datum_heute)]})]}),r&&r.ist_korrekt&&e.jsxs(P,{severity:"success",sx:{mb:3},children:[e.jsx(A,{children:"‚úÖ Semester-Status korrekt"}),e.jsx(a,{variant:"body2",children:r.empfehlung})]}),e.jsx(z,{elevation:3,children:e.jsxs(C,{children:[e.jsxs(i,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsxs(i,{display:"flex",alignItems:"center",children:[e.jsx(B,{color:"primary",sx:{mr:1}}),e.jsx(a,{variant:"h6",component:"h2",children:"Semester-Verwaltung"})]}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(D,{}),onClick:j,size:"small",children:"Aktualisieren"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{mb:3},children:"Verwalten Sie Semester und Planungsphasen. Nur ein Semester kann gleichzeitig aktiv sein."}),e.jsx(H,{component:N,variant:"outlined",children:e.jsxs(F,{children:[e.jsx(K,{children:e.jsxs(m,{children:[e.jsx(t,{children:e.jsx("strong",{children:"Semester"})}),e.jsx(t,{children:e.jsx("strong",{children:"Zeitraum"})}),e.jsx(t,{align:"center",children:e.jsx("strong",{children:"Status"})}),e.jsx(t,{align:"center",children:e.jsx("strong",{children:"Planungsphase"})}),e.jsx(t,{align:"center",children:e.jsx("strong",{children:"Statistik"})}),e.jsx(t,{align:"right",children:e.jsx("strong",{children:"Aktionen"})})]})}),e.jsxs(V,{children:[k.map(n=>e.jsxs(m,{sx:{backgroundColor:n.ist_aktiv?"action.selected":"inherit"},children:[e.jsx(t,{children:e.jsxs(i,{children:[e.jsx(a,{variant:"body2",fontWeight:"bold",children:n.bezeichnung}),e.jsx(a,{variant:"caption",color:"text.secondary",children:n.kuerzel})]})}),e.jsxs(t,{children:[e.jsxs(a,{variant:"caption",display:"block",children:[p(n.start_datum)," - ",p(n.ende_datum)]}),n.ist_laufend&&e.jsx(d,{label:"L√§uft aktuell",size:"small",color:"success",sx:{mt:.5}})]}),e.jsx(t,{align:"center",children:n.ist_aktiv?e.jsx(d,{label:"Aktiv",color:"primary",size:"small",icon:e.jsx(O,{})}):e.jsx(d,{label:"Inaktiv",variant:"outlined",size:"small",icon:e.jsx(Z,{})})}),e.jsx(t,{align:"center",children:n.ist_planungsphase?e.jsx(d,{label:"Offen",color:"success",size:"small",icon:e.jsx(T,{})}):e.jsx(d,{label:"Geschlossen",variant:"outlined",size:"small",icon:e.jsx(L,{})})}),e.jsx(t,{align:"center",children:e.jsxs(i,{children:[e.jsxs(a,{variant:"caption",display:"block",children:[n.statistik?.gesamt||0," Planungen"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[n.statistik?.freigegeben||0," freigegeben"]})]})}),e.jsx(t,{align:"right",children:e.jsxs(i,{display:"flex",gap:.5,justifyContent:"flex-end",children:[!n.ist_aktiv&&e.jsx(f,{title:"Semester aktivieren",children:e.jsx(b,{size:"small",color:"primary",onClick:()=>y(n,!1),children:e.jsx(G,{})})}),n.ist_aktiv&&!n.ist_planungsphase&&e.jsx(f,{title:"Planungsphase √∂ffnen",children:e.jsx(b,{size:"small",color:"success",onClick:()=>w(n,!0),children:e.jsx(T,{})})}),n.ist_aktiv&&n.ist_planungsphase&&e.jsx(f,{title:"Planungsphase schlie√üen",children:e.jsx(b,{size:"small",color:"warning",onClick:()=>w(n,!1),children:e.jsx(L,{})})})]})})]},n.id)),k.length===0&&e.jsx(m,{children:e.jsx(t,{colSpan:6,align:"center",children:e.jsx(a,{variant:"body2",color:"text.secondary",py:2,children:"Keine Semester vorhanden"})})})]})]})})]})}),e.jsxs(J,{open:x.open,onClose:()=>h({open:!1,action:"",semester:null}),maxWidth:"sm",fullWidth:!0,children:[e.jsx(U,{children:"Best√§tigung erforderlich"}),e.jsx(q,{children:e.jsx(a,{variant:"body1",sx:{whiteSpace:"pre-line"},children:W()})}),e.jsxs(Q,{children:[e.jsx(g,{onClick:()=>h({open:!1,action:"",semester:null}),disabled:u,children:"Abbrechen"}),e.jsx(g,{onClick:R,variant:"contained",disabled:u,startIcon:u?e.jsx(_,{size:16}):null,children:u?"Wird ausgef√ºhrt...":"Best√§tigen"})]})]})]})},xe=()=>e.jsxs(X,{maxWidth:"xl",children:[e.jsx(i,{sx:{mb:3},children:e.jsxs(Y,{separator:e.jsx(ne,{fontSize:"small"}),children:[e.jsx(ee,{component:se,to:"/dashboard",underline:"hover",color:"inherit",children:"Dashboard"}),e.jsx(a,{color:"text.primary",children:"Semesterverwaltung"})]})}),e.jsxs(i,{sx:{mb:4},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(B,{sx:{fontSize:40,color:"primary.main"}}),e.jsx(a,{variant:"h4",component:"h1",children:"Semesterverwaltung"})]}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Verwalten Sie Semester, Planungsphasen und akademische Zeitr√§ume"})]}),e.jsx(re,{})]});export{xe as default};
