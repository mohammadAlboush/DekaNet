import{j as e,N as U,B as r,z as ue,P as G,I as b,bj as he,f as a,K as c,bS as J,aY as Z,H as Y,$ as q,a0 as me,a1 as xe,ab as D,D as pe,bT as ge,l as w,R as je,ak as be,bI as fe,b3 as ye,aD as W,aE as F,aF as A,aw as I,ax as E,az as $,o as f,bd as M,be as B,O as S,aH as L,a$ as ve,b7 as ke}from"./vendor-mui-BiVZR0IW.js";import{u as Te,r as i}from"./vendor-react-CBtCGaWm.js";import{t as d}from"./templateService-DPVmfzBZ.js";import{p as Ce}from"./planungService-CoVGOVAB.js";import{b as we,c as Se,g as p}from"./index-ChymPdOX.js";import"./vendor-utils-DTv3oRQQ.js";const _e=Se("TemplateVerwaltung"),Ie=()=>{const _=Te(),l=we(s=>s.showToast),[Q,N]=i.useState(!0),[z,X]=i.useState([]),[m,ee]=i.useState([]),[se,g]=i.useState(!1),[ne,y]=i.useState(!1),[re,j]=i.useState(!1),[K,O]=i.useState(null),[u,v]=i.useState({semester_typ:"winter",name:"",beschreibung:""}),[h,k]=i.useState({name:"",beschreibung:"",ist_aktiv:!0}),[T,R]=i.useState(null),[P,V]=i.useState("winter");i.useEffect(()=>{x()},[]);const x=async()=>{try{N(!0);const s=await d.getAllTemplates();s.success&&s.data&&X(s.data);const n=await Ce.getAllPlanungen();n.success&&n.data&&ee(n.data)}catch(s){_e.error("Error loading data:",s),l(p(s,"Fehler beim Laden der Daten"),"error")}finally{N(!1)}},ae=async()=>{try{(await d.createTemplate(u)).success&&(l("Template erstellt","success"),g(!1),v({semester_typ:"winter",name:"",beschreibung:""}),x())}catch(s){l(p(s,"Fehler beim Erstellen"),"error")}},te=async()=>{if(K)try{(await d.updateTemplate(K.id,h)).success&&(l("Template aktualisiert","success"),y(!1),O(null),x())}catch(s){l(p(s,"Fehler beim Aktualisieren"),"error")}},le=async s=>{if(confirm(`Template "${s.name||s.semester_typ}" wirklich loeschen?`))try{await d.deleteTemplate(s.id),l("Template geloescht","success"),x()}catch(n){l(p(n,"Fehler beim Loeschen"),"error")}},ie=async()=>{if(T)try{const s=await d.createFromPlanung(T,P);s.success&&(l(`Template erstellt mit ${s.data?.anzahl_module||0} Modulen`,"success"),j(!1),R(null),x())}catch(s){l(p(s,"Fehler beim Erstellen"),"error")}},oe=async s=>{const n=m.find(t=>d.getSemesterTypFromKuerzel(t.semester?.kuerzel)===s.semester_typ);if(!n){l("Keine passende Planung gefunden","warning");return}if(confirm(`Template aus Planung "${n.semester?.kuerzel}" aktualisieren? Alle bestehenden Module werden ueberschrieben.`))try{(await d.updateFromPlanung(s.id,n.id)).success&&(l("Template aktualisiert","success"),x())}catch(t){l(p(t,"Fehler beim Aktualisieren"),"error")}},ce=s=>{O(s),k({name:s.name||"",beschreibung:s.beschreibung||"",ist_aktiv:s.ist_aktiv}),y(!0)},de=s=>s==="winter"?e.jsx(M,{color:"primary"}):e.jsx(B,{sx:{color:"orange"}}),o=s=>z.some(n=>n.semester_typ===s);return Q?e.jsx(U,{maxWidth:"lg",sx:{mt:4},children:e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ue,{})})}):e.jsxs(U,{maxWidth:"lg",sx:{mt:3,mb:4},children:[e.jsx(G,{sx:{p:3,mb:3},children:e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2,children:[e.jsxs(r,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(b,{onClick:()=>_(-1),size:"small",children:e.jsx(he,{})}),e.jsxs(r,{children:[e.jsx(a,{variant:"h5",fontWeight:"600",children:"Planungs-Templates"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Standard-Modulkonfigurationen fuer Winter- und Sommersemester"})]})]}),e.jsxs(r,{display:"flex",gap:1,children:[e.jsx(c,{variant:"outlined",startIcon:e.jsx(J,{}),onClick:()=>j(!0),disabled:m.length===0,children:"Aus Planung erstellen"}),e.jsx(c,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:()=>g(!0),disabled:o("winter")&&o("sommer"),children:"Neues Template"})]})]})}),e.jsx(Y,{severity:"info",sx:{mb:3},children:e.jsx(a,{variant:"body2",children:"Templates speichern Ihre Standard-Module fuer jedes Semester. Beim Start einer neuen Planung koennen Sie das passende Template laden und die Module werden automatisch uebernommen."})}),z.length===0?e.jsxs(G,{sx:{p:4,textAlign:"center"},children:[e.jsx(a,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Keine Templates vorhanden"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Erstellen Sie Ihr erstes Template oder importieren Sie es aus einer bestehenden Planung."}),e.jsxs(r,{display:"flex",gap:2,justifyContent:"center",children:[e.jsx(c,{variant:"outlined",startIcon:e.jsx(J,{}),onClick:()=>j(!0),disabled:m.length===0,children:"Aus Planung"}),e.jsx(c,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:()=>g(!0),children:"Manuell erstellen"})]})]}):e.jsx(q,{container:!0,spacing:3,children:z.map(s=>e.jsx(q,{item:!0,xs:12,md:6,children:e.jsxs(me,{elevation:3,children:[e.jsxs(xe,{children:[e.jsxs(r,{display:"flex",alignItems:"center",gap:1,mb:2,children:[de(s.semester_typ),e.jsx(a,{variant:"h6",children:s.name||d.formatSemesterTyp(s.semester_typ)}),s.ist_aktiv&&e.jsx(D,{label:"Aktiv",color:"success",size:"small"})]}),s.beschreibung&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:s.beschreibung}),e.jsx(pe,{sx:{my:2}}),e.jsxs(r,{display:"flex",gap:3,mb:2,children:[e.jsxs(r,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Module"}),e.jsx(a,{variant:"h6",children:s.anzahl_module})]}),e.jsxs(r,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Wunsch-Tage"}),e.jsx(a,{variant:"h6",children:s.wunsch_freie_tage?.length||0})]}),s.anmerkungen&&e.jsxs(r,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Anmerkungen"}),e.jsx(a,{variant:"body2",children:"Ja"})]}),s.raumbedarf&&e.jsxs(r,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Raumbedarf"}),e.jsx(a,{variant:"body2",children:"Ja"})]})]}),s.template_module&&s.template_module.length>0&&e.jsxs(r,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Module mit Konfiguration:"}),e.jsxs(r,{display:"flex",flexDirection:"column",gap:.5,mt:.5,children:[s.template_module.slice(0,4).map(n=>{const t=[];n.anzahl_vorlesungen>0&&t.push(`${n.anzahl_vorlesungen}V`),n.anzahl_uebungen>0&&t.push(`${n.anzahl_uebungen}Ue`),n.anzahl_praktika>0&&t.push(`${n.anzahl_praktika}P`),n.anzahl_seminare>0&&t.push(`${n.anzahl_seminare}S`);const C=t.join("+")||"Keine LF",H=n.mitarbeiter_ids?.length||0;return e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(D,{label:n.modul?.kuerzel||`Modul ${n.modul_id}`,size:"small",variant:"outlined",color:"primary"}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[C,H>0&&` • ${H} MA`,n.raum_vorlesung&&" • Raum"]})]},n.id)}),s.template_module.length>4&&e.jsxs(a,{variant:"caption",color:"text.secondary",children:["+",s.template_module.length-4," weitere Module..."]})]})]}),s.wunsch_freie_tage&&s.wunsch_freie_tage.length>0&&e.jsxs(r,{mt:1,children:[e.jsx(a,{variant:"caption",color:"text.secondary",children:"Wunsch-freie Tage:"}),e.jsx(r,{display:"flex",flexWrap:"wrap",gap:.5,mt:.5,children:s.wunsch_freie_tage.map((n,t)=>e.jsx(D,{label:`${n.wochentag} (${n.zeitraum})`,size:"small",variant:"outlined",color:n.prioritaet==="hoch"?"error":n.prioritaet==="mittel"?"warning":"default"},t))})]}),e.jsxs(a,{variant:"caption",color:"text.secondary",display:"block",mt:2,children:["Erstellt: ",s.created_at?new Date(s.created_at).toLocaleDateString("de-DE"):"-"]})]}),e.jsxs(ge,{sx:{px:2,pb:2},children:[e.jsx(w,{title:"Template bearbeiten (Detail-Ansicht)",children:e.jsx(b,{size:"small",color:"primary",onClick:()=>_(`/templates/${s.id}`),children:e.jsx(je,{})})}),e.jsx(w,{title:"Name/Beschreibung bearbeiten",children:e.jsx(b,{size:"small",onClick:()=>ce(s),children:e.jsx(be,{})})}),e.jsx(w,{title:"Aus aktueller Planung aktualisieren",children:e.jsx(b,{size:"small",onClick:()=>oe(s),disabled:m.length===0,children:e.jsx(fe,{})})}),e.jsx(w,{title:"Template loeschen",children:e.jsx(b,{size:"small",color:"error",onClick:()=>le(s),children:e.jsx(ye,{})})}),e.jsx(r,{flexGrow:1}),e.jsx(c,{size:"small",variant:"outlined",onClick:()=>_(`/templates/${s.id}`),children:"Details"})]})]})},s.id))}),e.jsxs(W,{open:se,onClose:()=>g(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:"Neues Template erstellen"}),e.jsx(A,{children:e.jsxs(r,{display:"flex",flexDirection:"column",gap:2,pt:1,children:[e.jsxs(I,{fullWidth:!0,children:[e.jsx(E,{children:"Semestertyp"}),e.jsxs($,{value:u.semester_typ,label:"Semestertyp",onChange:s=>v({...u,semester_typ:s.target.value}),children:[e.jsx(f,{value:"winter",disabled:o("winter"),children:e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(M,{color:"primary"})," Wintersemester",o("winter")&&" (existiert bereits)"]})}),e.jsx(f,{value:"sommer",disabled:o("sommer"),children:e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(B,{sx:{color:"orange"}})," Sommersemester",o("sommer")&&" (existiert bereits)"]})})]})]}),e.jsx(S,{label:"Name (optional)",fullWidth:!0,value:u.name,onChange:s=>v({...u,name:s.target.value}),placeholder:u.semester_typ==="winter"?"Wintersemester Template":"Sommersemester Template"}),e.jsx(S,{label:"Beschreibung (optional)",fullWidth:!0,multiline:!0,rows:3,value:u.beschreibung,onChange:s=>v({...u,beschreibung:s.target.value})})]})}),e.jsxs(L,{children:[e.jsx(c,{onClick:()=>g(!1),children:"Abbrechen"}),e.jsx(c,{variant:"contained",onClick:ae,children:"Erstellen"})]})]}),e.jsxs(W,{open:ne,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:"Template bearbeiten"}),e.jsx(A,{children:e.jsxs(r,{display:"flex",flexDirection:"column",gap:2,pt:1,children:[e.jsx(S,{label:"Name",fullWidth:!0,value:h.name,onChange:s=>k({...h,name:s.target.value})}),e.jsx(S,{label:"Beschreibung",fullWidth:!0,multiline:!0,rows:3,value:h.beschreibung,onChange:s=>k({...h,beschreibung:s.target.value})}),e.jsx(ve,{control:e.jsx(ke,{checked:h.ist_aktiv,onChange:s=>k({...h,ist_aktiv:s.target.checked})}),label:"Template aktiv"})]})}),e.jsxs(L,{children:[e.jsx(c,{onClick:()=>y(!1),children:"Abbrechen"}),e.jsx(c,{variant:"contained",onClick:te,children:"Speichern"})]})]}),e.jsxs(W,{open:re,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{children:"Template aus Planung erstellen"}),e.jsx(A,{children:e.jsxs(r,{display:"flex",flexDirection:"column",gap:2,pt:1,children:[e.jsx(Y,{severity:"info",children:"Waehlen Sie eine bestehende Planung aus. Alle Module und Einstellungen werden in das neue Template uebernommen."}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(E,{children:"Planung auswaehlen"}),e.jsx($,{value:T||"",label:"Planung auswaehlen",onChange:s=>{const n=Number(s.target.value);R(n);const t=m.find(C=>C.id===n);t?.semester?.kuerzel&&V(d.getSemesterTypFromKuerzel(t.semester.kuerzel))},children:m.map(s=>e.jsxs(f,{value:s.id,children:[s.semester?.kuerzel||`Semester ${s.semester_id}`," - ",s.status,s.geplante_module?.length>0&&` (${s.geplante_module.length} Module)`]},s.id))})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(E,{children:"Ziel-Semestertyp"}),e.jsxs($,{value:P,label:"Ziel-Semestertyp",onChange:s=>V(s.target.value),children:[e.jsx(f,{value:"winter",disabled:o("winter"),children:e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(M,{color:"primary"})," Wintersemester",o("winter")&&" (existiert bereits)"]})}),e.jsx(f,{value:"sommer",disabled:o("sommer"),children:e.jsxs(r,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(B,{sx:{color:"orange"}})," Sommersemester",o("sommer")&&" (existiert bereits)"]})})]})]})]})}),e.jsxs(L,{children:[e.jsx(c,{onClick:()=>j(!1),children:"Abbrechen"}),e.jsx(c,{variant:"contained",onClick:ie,disabled:!T||o(P),children:"Template erstellen"})]})]})]})};export{Ie as default};
