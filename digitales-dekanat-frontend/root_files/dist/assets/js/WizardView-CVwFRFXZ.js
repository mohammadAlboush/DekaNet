import{j as e,B as l,z as he,f as r,H as W,av as Ye,a0 as ue,a1 as de,a2 as ve,a4 as Q,a_ as _n,ab as M,K as P,P as N,ay as Nn,$ as d,O as G,Q as Ae,aL as wn,aw as Mn,ax as Cn,az as In,o as De,a$ as fe,an as Le,b0 as An,D as xe,aA as Sn,w as le,b1 as ke,b2 as Pe,aY as We,ae as Wn,af as Tn,ag as Pn,ah as Ee,ai as H,aj as Dn,I as Te,ak as un,b3 as dn,aD as Be,aE as Re,aS as Hn,aF as Fe,aH as $e,b4 as qn,b5 as Xe,k as Ke,b6 as Un,aC as Jn,aO as Yn,L as en,g as nn,aZ as Ln,l as En,am as Qn,b7 as we,aV as Xn,b8 as sn,G as Bn,b9 as er,ba as nr,ap as Qe,bb as rr,al as tr,N as sr,a6 as ar,bc as vn,bd as kn,be as zn,bf as ir,bg as lr,bh as or,bi as ur}from"./vendor-mui-BiVZR0IW.js";import{r as m,b as dr,u as cr,i as hr}from"./vendor-react-CBtCGaWm.js";import{b as cn,u as Ze,c as Ve,g as oe,l as He,d as _,a as Ge,e as gr}from"./index-BXi_OX1m.js";import{p as mr}from"./planungPhaseService-BG7zO8Dx.js";import{p as Se}from"./planungService-BVn8qP8e.js";import{c as qe,a6 as xr}from"./vendor-utils-DTv3oRQQ.js";import{P as pr,M as Me,D as ie,W as jr}from"./WunschTagEditor-D86ctGzX.js";import{a as Ue}from"./auftragService-DS9683K3.js";import{u as br}from"./auftragStore-DxRuTrz3.js";import{t as an}from"./templateService-C2aAXxn3.js";import{u as fr}from"./planungPhaseStore-CqQvbFGd.js";const be=Ve("StepSemesterAuswahl"),Sr=({data:s,onUpdate:k,onNext:i,planungId:g,setPlanungId:p})=>{const x=cn(a=>a.showToast),D=Ze(a=>a.user),[O,y]=m.useState(!0),[T,n]=m.useState(null),[C,L]=m.useState(null),[q,V]=m.useState(null);m.useEffect(()=>{j()},[]);const j=async()=>{y(!0),V(null);try{be.debug(" Loading active phase with semester...");const a=await mr.getActivePhasWithSemester();if(!a.success||!a.phase||!a.semester){V("Keine aktive Planungsphase vorhanden. Bitte wenden Sie sich an das Dekanat."),y(!1);return}be.debug(" Active phase loaded:",a.phase.name),be.debug(" Semester:",a.semester.bezeichnung),n(a.phase),L(a.semester),be.debug(" Creating/loading planung for semester:",a.semester.id);const S=await Se.createPlanung({semester_id:a.semester.id,po_id:1});if(!S.success||!S.data){V("Fehler beim Erstellen der Planung."),y(!1);return}const E=S.data.id,R=S.data.status||"entwurf",$=S.data.created!==!1;be.debug(" Planung response:",{id:E,status:R,created:$});const ne=R==="freigegeben"||R==="eingereicht";p(E),k({semesterId:a.semester.id,semester:a.semester,planungId:E,planungStatus:R,isExistingPlanung:!$,planungLocked:ne}),$?x("Neue Planung erfolgreich erstellt","success"):ne||x("Bestehende Planung im Entwurf-Status geladen","info"),ne||(be.debug("Auto-advancing to next step (semester auto-selected from phase)"),setTimeout(()=>i(),500))}catch(a){be.error(" Error loading phase:",a),V(oe(a,"Fehler beim Laden der Planungsphase"))}finally{y(!1)}};return O?e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:6},children:[e.jsx(he,{size:48}),e.jsx(r,{sx:{mt:2},color:"text.secondary",children:"Lade aktive Planungsphase..."})]}):q?e.jsxs(W,{severity:"error",sx:{my:2},children:[e.jsx(Ye,{children:"Keine Planungsphase verf√ºgbar"}),q]}):s.planungLocked?e.jsxs(l,{children:[e.jsxs(W,{severity:"warning",sx:{mb:3},children:[e.jsx(Ye,{children:"Planung bereits eingereicht"}),e.jsxs(r,{variant:"body2",children:["Sie haben bereits eine Planung f√ºr das Semester ",e.jsx("strong",{children:C?.bezeichnung})," eingereicht (Status: ",e.jsx("strong",{children:s.planungStatus}),")."]}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Bitte wenden Sie sich an das Dekanat, wenn Sie √Ñnderungen vornehmen m√∂chten."})]}),e.jsx(ue,{variant:"outlined",sx:{mb:3},children:e.jsxs(de,{children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Aktive Planungsphase"}),e.jsx(r,{variant:"h6",children:T?.name}),T?.enddatum&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(ve,{fontSize:"small",color:"action"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Deadline: ",qe(new Date(T.enddatum),"dd.MM.yyyy HH:mm",{locale:He})]})]})]})})]}):e.jsxs(l,{children:[D&&e.jsx(W,{severity:"info",sx:{mb:3},icon:!1,children:e.jsxs(r,{variant:"body2",children:["Eingeloggt als: ",e.jsxs("strong",{children:[D.vorname," ",D.nachname]})," (",D.username,")"]})}),e.jsxs(W,{severity:"success",sx:{mb:3},children:[e.jsx(Ye,{children:"Aktive Planungsphase"}),e.jsx(r,{variant:"body1",fontWeight:600,children:T?.name}),T?.enddatum&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(ve,{fontSize:"small"}),e.jsxs(r,{variant:"body2",children:["Deadline: ",qe(new Date(T.enddatum),"dd.MM.yyyy HH:mm",{locale:He})]})]})]}),e.jsx(ue,{variant:"outlined",sx:{mb:3,borderColor:"primary.main",borderWidth:2,bgcolor:"primary.50"},children:e.jsx(de,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Q,{color:"primary",fontSize:"large"}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(r,{variant:"h6",children:C?.bezeichnung}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(_n,{fontSize:"small",color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:C?.start_datum&&C?.ende_datum&&e.jsxs(e.Fragment,{children:[qe(new Date(C.start_datum),"dd.MM.yyyy",{locale:He})," -"," ",qe(new Date(C.ende_datum),"dd.MM.yyyy",{locale:He})]})})]})]}),e.jsx(M,{label:"Ausgew√§hlt",color:"primary"})]})})}),g&&e.jsx(W,{severity:"success",sx:{mb:3},icon:e.jsx(Q,{}),children:e.jsxs(r,{variant:"body2",children:["Planung erstellt - ID: ",e.jsx("strong",{children:g})," - Status: ",e.jsx("strong",{children:s.planungStatus||"entwurf"})]})}),e.jsx(l,{sx:{display:"flex",justifyContent:"flex-end",mt:4},children:e.jsx(P,{variant:"contained",size:"large",onClick:i,disabled:!g,children:"Weiter zur Modul-Auswahl"})})]})},vr=({data:s,onUpdate:k,onNext:i,onBack:g})=>{const[p,x]=m.useState(!0),[D,O]=m.useState([]),[y,T]=m.useState([]),[n,C]=m.useState([]),[L,q]=m.useState(new Set),[V,j]=m.useState(null),[a,S]=m.useState({turnus:"",minECTS:0,maxECTS:30,suchbegriff:"",nurMeineModule:!0});m.useEffect(()=>{E()},[]),m.useEffect(()=>{if(s.selectedModules&&s.selectedModules.length>0){const o=new Set(s.selectedModules.map(v=>v.id));q(o)}},[s.selectedModules]),m.useEffect(()=>{R()},[a,D,y]);const E=async()=>{try{x(!0),_.debug("StepModuleAuswahl","Load data start"),_.debug("StepModuleAuswahl","Fetching current user from /auth/me...");const o=await Ge.get("/auth/me");if(_.debug("StepModuleAuswahl","User response",{success:o.data.success,status:o.status,dataKeys:Object.keys(o.data)}),o.data.success){const A=o.data.data.user||o.data.data;j(A),_.debug("StepModuleAuswahl","Current user loaded",{id:A.id,username:A.username,dozent_id:A.dozent_id,rolle:A.rolle,allKeys:Object.keys(A)})}else _.error("StepModuleAuswahl","User response not successful");_.debug("StepModuleAuswahl","Fetching all modules from /module...");const v=await Ge.get("/module");if(_.debug("StepModuleAuswahl","Module response",{success:v.data.success,status:v.status,dataLength:v.data.data?.length}),v.data.success){const A=v.data.data||[];O(A),_.debug("StepModuleAuswahl","Alle Module geladen",{count:A.length}),_.debug("StepModuleAuswahl","Struktur der ersten 3 Module"),A.slice(0,3).forEach((Z,t)=>{_.debug("StepModuleAuswahl",`Modul ${t+1}: ${Z.kuerzel}`,{id:Z.id,kuerzel:Z.kuerzel,hasDozenten:!!Z.dozenten,dozentenIsArray:Array.isArray(Z.dozenten),dozentenLength:Z.dozenten?.length||0,dozenten:Z.dozenten,allModuleKeys:Object.keys(Z)})});const B=o.data.data.user||o.data.data;if(o.data.success&&B.dozent_id){const Z=B.dozent_id;_.debug("StepModuleAuswahl","Filtering modules for dozent_id",{dozentId:Z});const t=A.filter(b=>{if(!(b.dozenten&&Array.isArray(b.dozenten)&&b.dozenten.length>0))return _.warn("StepModuleAuswahl",`Modul ${b.kuerzel} hat keine Dozenten-Zuordnung`),!1;const I=b.dozenten?.some(ee=>{const se=ee.dozent_id===Z;return _.debug("StepModuleAuswahl",`${se?"Match":"No match"} Checking ${b.kuerzel} - Dozent ${ee.dozent_id} vs ${Z}`),se})||!1;return I&&_.debug("StepModuleAuswahl",`MATCH: ${b.kuerzel} ist dem Dozenten zugeordnet`),I});T(t),_.debug("StepModuleAuswahl","Meine Module gefunden",{count:t.length,kuerzel:t.map(b=>b.kuerzel).join(", ")}),t.forEach((b,z)=>{_.debug("StepModuleAuswahl",`Eigenes Modul ${z+1}: ${b.kuerzel}`,{id:b.id,dozenten:b.dozenten?.map(I=>({dozent_id:I.dozent_id,name:I.name_komplett||`${I.vorname} ${I.nachname}`,rolle:I.rolle}))})})}else _.error("StepModuleAuswahl","Kein dozent_id gefunden - kann nicht filtern",{userData:B,rawResponseData:o.data.data}),T([])}else _.error("StepModuleAuswahl","Module response not successful");_.debug("StepModuleAuswahl","Load data end")}catch(o){_.error("StepModuleAuswahl","Error loading data",o),o instanceof Error&&_.error("StepModuleAuswahl","Error details",{message:o.message,stack:o.stack})}finally{x(!1)}},R=()=>{_.debug("StepModuleAuswahl","Apply filters start",{filters:a,availableModules:{alleModule:D.length,meineModule:y.length}});let o=a.nurMeineModule?y:D;if(_.debug("StepModuleAuswahl","Starting with",{source:a.nurMeineModule?"meineModule":"alleModule",count:o.length}),a.turnus){const v=o.length;o=o.filter(A=>A.turnus===a.turnus||A.turnus==="Jedes Semester"),_.debug("StepModuleAuswahl",`Turnus filter "${a.turnus}"`,{beforeCount:v,afterCount:o.length})}if(a.minECTS>0){const v=o.length;o=o.filter(A=>(A.leistungspunkte||0)>=a.minECTS),_.debug("StepModuleAuswahl",`Min ECTS filter (>=${a.minECTS})`,{beforeCount:v,afterCount:o.length})}if(a.maxECTS<30){const v=o.length;o=o.filter(A=>(A.leistungspunkte||0)<=a.maxECTS),_.debug("StepModuleAuswahl",`Max ECTS filter (<=${a.maxECTS})`,{beforeCount:v,afterCount:o.length})}if(a.suchbegriff&&a.suchbegriff.trim()!==""){const v=a.suchbegriff.toLowerCase().trim(),A=o.length;o=o.filter(B=>[B.kuerzel?.toLowerCase(),B.bezeichnung_de?.toLowerCase(),B.bezeichnung_en?.toLowerCase(),B.untertitel?.toLowerCase()].some(t=>t&&t.includes(v))),_.debug("StepModuleAuswahl",`Search filter "${v}"`,{beforeCount:A,afterCount:o.length})}C(o),_.debug("StepModuleAuswahl","Apply filters end",{finalCount:o.length,kuerzel:o.map(v=>v.kuerzel).join(", ")})},$=o=>{const v=new Set(L);v.has(o.id)?v.delete(o.id):v.add(o.id),q(v);const A=D.filter(B=>v.has(B.id));k({selectedModules:A})},ne=()=>{const o=new Set(n.map(A=>A.id));q(o);const v=D.filter(A=>o.has(A.id));k({selectedModules:v})},J=()=>{q(new Set),k({selectedModules:[]})},te=o=>L.has(o),X=L.size>0;return p?e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(he,{})}):e.jsxs(l,{children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Module ausw√§hlen"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["W√§hlen Sie die Module aus, die Sie in diesem Semester planen m√∂chten.",a.nurMeineModule&&y.length>0&&e.jsxs("strong",{children:[" Es werden nur Ihre zugeordneten Module angezeigt (",y.length,")."]})]})]}),s.semester&&e.jsx(W,{severity:"info",sx:{mb:3},children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Semester:"})," ",s.semester.bezeichnung," (",s.semester.kuerzel,")"]})}),!1,e.jsxs(N,{sx:{p:2,mb:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Nn,{color:"primary"}),e.jsx(r,{variant:"subtitle1",fontWeight:600,children:"Filter & Suche"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(G,{fullWidth:!0,size:"small",placeholder:"Modul suchen (K√ºrzel, Name)...",value:a.suchbegriff,onChange:o=>S(v=>({...v,suchbegriff:o.target.value})),InputProps:{startAdornment:e.jsx(Ae,{position:"start",children:e.jsx(wn,{})})}})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsxs(Mn,{fullWidth:!0,size:"small",children:[e.jsx(Cn,{children:"Turnus"}),e.jsxs(In,{value:a.turnus,label:"Turnus",onChange:o=>S(v=>({...v,turnus:o.target.value})),children:[e.jsx(De,{value:"",children:"Alle"}),e.jsx(De,{value:"Wintersemester",children:"Wintersemester"}),e.jsx(De,{value:"Sommersemester",children:"Sommersemester"}),e.jsx(De,{value:"Jedes Semester",children:"Jedes Semester"})]})]})}),e.jsx(d,{item:!0,xs:6,md:2,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Min ECTS",value:a.minECTS,onChange:o=>S(v=>({...v,minECTS:parseInt(o.target.value)||0})),inputProps:{min:0,max:30}})}),e.jsx(d,{item:!0,xs:6,md:2,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Max ECTS",value:a.maxECTS,onChange:o=>S(v=>({...v,maxECTS:parseInt(o.target.value)||30})),inputProps:{min:0,max:30}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(fe,{control:e.jsx(An,{checked:a.nurMeineModule,onChange:o=>S(v=>({...v,nurMeineModule:o.target.checked})),color:"primary"}),label:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{fontSize:"small"}),e.jsxs(r,{variant:"body2",children:["Nur meine zugeordneten Module anzeigen",y.length>0?` (${y.length} Module)`:" (keine Module zugeordnet)"]})]})})})]}),e.jsx(xe,{sx:{my:2}}),e.jsxs(Sn,{direction:"row",spacing:1,children:[e.jsxs(P,{size:"small",onClick:ne,disabled:n.length===0,children:["Alle ausw√§hlen (",n.length,")"]}),e.jsx(P,{size:"small",onClick:J,disabled:L.size===0,children:"Auswahl aufheben"})]})]}),L.size>0&&e.jsx(W,{severity:"success",sx:{mb:2},children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:L.size})," ",L.size===1?"Modul":"Module"," ausgew√§hlt"]})}),n.length===0?e.jsx(W,{severity:"info",children:e.jsx(r,{variant:"body2",children:a.nurMeineModule&&y.length===0?'Ihnen sind noch keine Module zugeordnet. Deaktivieren Sie den Filter "Nur meine Module" um alle Module zu sehen.':a.suchbegriff?`Keine Module f√ºr "${a.suchbegriff}" gefunden. Passen Sie die Suche an.`:"Keine Module gefunden. Passen Sie die Filter an."})}):e.jsx(d,{container:!0,spacing:2,children:n.map(o=>e.jsx(d,{item:!0,xs:12,md:6,lg:4,children:e.jsx(ue,{variant:"outlined",sx:{cursor:"pointer",transition:"all 0.2s",border:te(o.id)?2:1,borderColor:te(o.id)?"primary.main":"divider",bgcolor:te(o.id)?"primary.50":"background.paper","&:hover":{borderColor:"primary.main",boxShadow:2}},onClick:()=>$(o),children:e.jsxs(de,{children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(r,{variant:"h6",component:"div",sx:{fontWeight:600},children:o.kuerzel}),te(o.id)&&e.jsx(Q,{color:"primary"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2,minHeight:40},children:o.bezeichnung_de}),e.jsxs(Sn,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:[o.leistungspunkte&&e.jsx(M,{size:"small",icon:e.jsx(le,{}),label:`${o.leistungspunkte} ECTS`,color:"primary",variant:"outlined"}),o.sws_gesamt&&o.sws_gesamt>0&&e.jsx(M,{size:"small",icon:e.jsx(ve,{}),label:`${o.sws_gesamt} SWS`,color:"secondary",variant:"outlined"}),o.turnus&&e.jsx(M,{size:"small",label:o.turnus==="Wintersemester"?"WS":o.turnus==="Sommersemester"?"SS":"WS+SS",variant:"outlined"})]}),y.some(v=>v.id===o.id)&&e.jsx(l,{sx:{mt:1},children:e.jsx(M,{size:"small",icon:e.jsx(Le,{}),label:"Mein Modul",color:"success",variant:"outlined"})})]})})},o.id))}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:g,children:"Zur√ºck"}),e.jsxs(P,{variant:"contained",endIcon:e.jsx(Pe,{}),onClick:i,disabled:!X,children:["Weiter (",L.size," ",L.size===1?"Modul":"Module",")"]})]})]})},kr=({data:s,onUpdate:k,onNext:i,onBack:g,planungId:p})=>{const x=cn(t=>t.showToast),[D,O]=m.useState(!1),[y,T]=m.useState(null),[n,C]=m.useState(null),[L,q]=m.useState(!1),[V,j]=m.useState([]),[a,S]=m.useState("");m.useEffect(()=>{E()},[]);const E=async()=>{try{const t=await Ge.get("/module");t.data.success&&(j(t.data.data||[]),_.debug("StepModule","Alle Module geladen",{count:t.data.data?.length||0}))}catch(t){_.error("StepModule","Error loading modules",t),x("Fehler beim Laden der Module","error")}},R=()=>{if(s.selectedModules&&s.selectedModules.length>0){const t=s.selectedModules[0].po_id;if(t)return t}if(s.geplantModule&&s.geplantModule.length>0){const t=s.geplantModule[0].po_id;if(t)return t}return _.warn("StepModule","Keine PO-ID gefunden, verwende Standard-PO 1"),1},$=t=>{_.debug("StepModule","Opening dialog for module",{kuerzel:t.kuerzel,id:t.id,po_id:t.po_id,lehrformen:t.lehrformen?.length||0});let b=0,z=0,I=0,ee=0;if(t.lehrformen&&t.lehrformen.length>0){const se=t.lehrformen.some(f=>f.kuerzel==="V"),ge=t.lehrformen.some(f=>f.kuerzel==="√ú"),me=t.lehrformen.some(f=>f.kuerzel==="P"),h=t.lehrformen.some(f=>f.kuerzel==="S");b=se?1:0,z=ge?1:0,I=me?1:0,ee=h?1:0,_.debug("StepModule","Lehrformen gefunden",{V:se,√ú:ge,P:me,S:h})}else _.warn("StepModule","Keine Lehrformen definiert, verwende Standard"),b=1;C({modul:t,anzahl_vorlesungen:b,anzahl_uebungen:z,anzahl_praktika:I,anzahl_seminare:ee,anmerkungen:"",raum_vorlesung:"",raum_uebung:"",raum_praktikum:"",raum_seminar:"",kapazitaet_vorlesung:ie.vorlesung,kapazitaet_uebung:ie.uebung,kapazitaet_praktikum:ie.praktikum,kapazitaet_seminar:ie.seminar}),T(null),O(!0)},ne=t=>{_.debug("StepModule","Editing module",{kuerzel:t.modul?.kuerzel}),C({modul:t.modul,anzahl_vorlesungen:t.anzahl_vorlesungen||0,anzahl_uebungen:t.anzahl_uebungen||0,anzahl_praktika:t.anzahl_praktika||0,anzahl_seminare:t.anzahl_seminare||0,anmerkungen:t.anmerkungen||"",raum_vorlesung:t.raum_vorlesung||"",raum_uebung:t.raum_uebung||"",raum_praktikum:t.raum_praktikum||"",raum_seminar:t.raum_seminar||"",kapazitaet_vorlesung:t.kapazitaet_vorlesung||ie.vorlesung,kapazitaet_uebung:t.kapazitaet_uebung||ie.uebung,kapazitaet_praktikum:t.kapazitaet_praktikum||ie.praktikum,kapazitaet_seminar:t.kapazitaet_seminar||ie.seminar}),T(t),O(!0)},J=async()=>{if(!n||!p){x("Keine Planung-ID vorhanden","error");return}if(n.anzahl_vorlesungen+n.anzahl_uebungen+n.anzahl_praktika+n.anzahl_seminare===0){x("Mindestens eine Lehrform muss > 0 sein","warning");return}_.debug("StepModule","Saving module",{modul_kuerzel:n.modul.kuerzel,modul_id:n.modul.id,po_id:R(),planungId:p,multiplikatoren:{V:n.anzahl_vorlesungen,√ú:n.anzahl_uebungen,P:n.anzahl_praktika,S:n.anzahl_seminare}}),q(!0);try{if(y){_.debug("StepModule","Updating existing module",{id:y.id}),await Se.updateModule(p,y.id,{anzahl_vorlesungen:n.anzahl_vorlesungen,anzahl_uebungen:n.anzahl_uebungen,anzahl_praktika:n.anzahl_praktika,anzahl_seminare:n.anzahl_seminare,anmerkungen:n.anmerkungen,raum_vorlesung:n.raum_vorlesung||void 0,raum_uebung:n.raum_uebung||void 0,raum_praktikum:n.raum_praktikum||void 0,raum_seminar:n.raum_seminar||void 0,kapazitaet_vorlesung:n.kapazitaet_vorlesung||void 0,kapazitaet_uebung:n.kapazitaet_uebung||void 0,kapazitaet_praktikum:n.kapazitaet_praktikum||void 0,kapazitaet_seminar:n.kapazitaet_seminar||void 0});const b=s.geplantModule.map(z=>z.id===y.id?{...z,anzahl_vorlesungen:n.anzahl_vorlesungen,anzahl_uebungen:n.anzahl_uebungen,anzahl_praktika:n.anzahl_praktika,anzahl_seminare:n.anzahl_seminare,anmerkungen:n.anmerkungen,raum_vorlesung:n.raum_vorlesung,raum_uebung:n.raum_uebung,raum_praktikum:n.raum_praktikum,raum_seminar:n.raum_seminar,kapazitaet_vorlesung:n.kapazitaet_vorlesung,kapazitaet_uebung:n.kapazitaet_uebung,kapazitaet_praktikum:n.kapazitaet_praktikum,kapazitaet_seminar:n.kapazitaet_seminar,sws_gesamt:X(n.modul,n)}:z);k({geplantModule:b}),x("Modul aktualisiert","success")}else{_.debug("StepModule","Adding new module",{kuerzel:n.modul.kuerzel});const b=n.modul.po_id||R();_.debug("StepModule","PO-ID Debug",{"formData.modul.po_id":n.modul.po_id,"getPOId()":R(),"Final po_id":b});const z={modul_id:n.modul.id,po_id:b,anzahl_vorlesungen:n.anzahl_vorlesungen,anzahl_uebungen:n.anzahl_uebungen,anzahl_praktika:n.anzahl_praktika,anzahl_seminare:n.anzahl_seminare,bemerkung:n.anmerkungen,anmerkungen:n.anmerkungen,raum_vorlesung:n.raum_vorlesung||void 0,raum_uebung:n.raum_uebung||void 0,raum_praktikum:n.raum_praktikum||void 0,raum_seminar:n.raum_seminar||void 0,kapazitaet_vorlesung:n.kapazitaet_vorlesung||void 0,kapazitaet_uebung:n.kapazitaet_uebung||void 0,kapazitaet_praktikum:n.kapazitaet_praktikum||void 0,kapazitaet_seminar:n.kapazitaet_seminar||void 0};_.debug("StepModule","Sending to backend",{...z,multiplikatoren:{V:z.anzahl_vorlesungen,√ú:z.anzahl_uebungen,P:z.anzahl_praktika,S:z.anzahl_seminare}});const I=await Se.addModule(p,z);if(I.success&&I.data){_.info("StepModule","Module added successfully",{data:I.data,sws_gesamt:I.data.sws_gesamt});const ee={...I.data,modul:n.modul,sws_gesamt:I.data.sws_gesamt||0,sws_vorlesung:I.data.sws_vorlesung||0,sws_uebung:I.data.sws_uebung||0,sws_praktikum:I.data.sws_praktikum||0,sws_seminar:I.data.sws_seminar||0,raum_vorlesung:n.raum_vorlesung,raum_uebung:n.raum_uebung,raum_praktikum:n.raum_praktikum,raum_seminar:n.raum_seminar,kapazitaet_vorlesung:n.kapazitaet_vorlesung,kapazitaet_uebung:n.kapazitaet_uebung,kapazitaet_praktikum:n.kapazitaet_praktikum,kapazitaet_seminar:n.kapazitaet_seminar};_.debug("StepModule","Gesamt SWS gespeichert",{sws_gesamt:ee.sws_gesamt}),k({geplantModule:[...s.geplantModule,ee]}),x(`Modul hinzugef√ºgt (${ee.sws_gesamt?.toFixed(1)} SWS)`,"success")}else throw new Error(I.message||"Fehler beim Hinzuf√ºgen")}O(!1),C(null),T(null)}catch(b){_.error("StepModule","Error saving module",{error:b});const z=oe(b,"Fehler beim Speichern des Moduls");_.error("StepModule","Final error message",{errorMessage:z}),x(z,"error")}finally{q(!1)}},te=async t=>{if(p&&window.confirm(`Modul "${t.modul?.kuerzel}" wirklich entfernen?`)){_.debug("StepModule","Removing module",{id:t.id});try{await Se.removeModule(p,t.id);const b=s.geplantModule.filter(z=>z.id!==t.id);k({geplantModule:b}),x("Modul entfernt","success")}catch(b){_.error("StepModule","Error removing module",{error:b}),x(oe(b,"Fehler beim Entfernen"),"error")}}},X=(t,b)=>{if(!t.lehrformen)return 0;let z=0;return t.lehrformen.forEach(I=>{switch(I.kuerzel){case"V":z+=b.anzahl_vorlesungen*I.sws;break;case"√ú":z+=b.anzahl_uebungen*I.sws;break;case"P":z+=b.anzahl_praktika*I.sws;break;case"S":z+=b.anzahl_seminare*I.sws;break}}),z},o=()=>n?X(n.modul,n):0,v=t=>{const b=[];return t.anzahl_vorlesungen>0&&b.push(`${t.anzahl_vorlesungen}V`),t.anzahl_uebungen>0&&b.push(`${t.anzahl_uebungen}√ú`),t.anzahl_praktika>0&&b.push(`${t.anzahl_praktika}P`),t.anzahl_seminare>0&&b.push(`${t.anzahl_seminare}S`),b.join(" + ")||"Keine"},A=()=>s.geplantModule.reduce((t,b)=>t+(b.sws_gesamt||0),0),B=s.geplantModule.length>0,Z=(t,b)=>t.lehrformen?t.lehrformen.some(z=>z.kuerzel===b):!1;return e.jsxs(l,{children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Module zur Planung hinzuf√ºgen"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"F√ºgen Sie die ausgew√§hlten Module zur Planung hinzu und definieren Sie die Lehrformen."})]}),s.geplantModule.length>0&&e.jsx(N,{sx:{p:2,mb:3,bgcolor:"background.default"},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{color:"primary"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Geplante Module"}),e.jsx(r,{variant:"h6",children:s.geplantModule.length})]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{color:"secondary"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Gesamt SWS"}),e.jsx(r,{variant:"h6",children:A().toFixed(1)})]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"success"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Status"}),e.jsx(r,{variant:"h6",color:"success.main",children:B?"Bereit":"Unvollst√§ndig"})]})]})})]})}),s.selectedModules&&s.selectedModules.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"success",fontSize:"small"}),"Ausgew√§hlte Module aus Schritt 2"]}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:'Diese Module haben Sie in Schritt 2 ausgew√§hlt. Klicken Sie auf "Hinzuf√ºgen", um Multiplikatoren festzulegen.'}),e.jsx(d,{container:!0,spacing:2,sx:{mb:4},children:s.selectedModules.filter(t=>!s.geplantModule.some(b=>b.modul_id===t.id)).map(t=>e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ue,{variant:"outlined",sx:{borderColor:"success.main",borderWidth:2},children:e.jsx(de,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{sx:{flex:1},children:[e.jsx(r,{variant:"h6",color:"success.main",children:t.kuerzel}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.bezeichnung_de}),e.jsxs(l,{sx:{display:"flex",gap:.5},children:[t.leistungspunkte&&e.jsx(M,{size:"small",label:`${t.leistungspunkte} ECTS`}),t.sws_gesamt&&t.sws_gesamt>0&&e.jsx(M,{size:"small",label:`${t.sws_gesamt} SWS`,color:"secondary"})]})]}),e.jsx(P,{variant:"contained",color:"success",size:"small",startIcon:e.jsx(We,{}),onClick:()=>$(t),children:"Hinzuf√ºgen"})]})})})},t.id))}),e.jsx(xe,{sx:{my:3}})]}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Weitere Module √ºber Suche hinzuf√ºgen"}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Suchen Sie nach weiteren Modulen, die Sie zur Planung hinzuf√ºgen m√∂chten."}),e.jsx(G,{fullWidth:!0,size:"small",placeholder:"Modul suchen (K√ºrzel oder Bezeichnung)...",value:a,onChange:t=>S(t.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(Ae,{position:"start",children:e.jsx(wn,{})})}}),e.jsx(d,{container:!0,spacing:2,sx:{mb:3,maxHeight:"400px",overflowY:"auto"},children:V.filter(t=>{if(s.geplantModule.some(z=>z.modul_id===t.id))return!1;if(a){const z=a.toLowerCase();return t.kuerzel?.toLowerCase().includes(z)||t.bezeichnung_de?.toLowerCase().includes(z)}return!0}).slice(0,pr.maxModuleSuggestions).map(t=>e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(ue,{variant:"outlined",children:e.jsx(de,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{sx:{flex:1},children:[e.jsx(r,{variant:"h6",children:t.kuerzel}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.bezeichnung_de}),e.jsxs(l,{sx:{display:"flex",gap:.5},children:[t.leistungspunkte&&e.jsx(M,{size:"small",label:`${t.leistungspunkte} ECTS`}),t.sws_gesamt&&t.sws_gesamt>0&&e.jsx(M,{size:"small",label:`${t.sws_gesamt} SWS`,color:"secondary"})]})]}),e.jsx(P,{variant:"contained",size:"small",startIcon:e.jsx(We,{}),onClick:()=>$(t),children:"Hinzuf√ºgen"})]})})})},t.id))}),s.geplantModule.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:["Geplante Module (",s.geplantModule.length,")"]}),e.jsx(Wn,{component:N,variant:"outlined",sx:{mb:3},children:e.jsxs(Tn,{size:"small",children:[e.jsx(Pn,{children:e.jsxs(Ee,{children:[e.jsx(H,{children:e.jsx("strong",{children:"Modul"})}),e.jsx(H,{children:e.jsx("strong",{children:"Bezeichnung"})}),e.jsx(H,{align:"center",children:e.jsx("strong",{children:"Lehrformen"})}),e.jsx(H,{align:"center",children:e.jsx("strong",{children:"SWS"})}),e.jsx(H,{align:"right",children:e.jsx("strong",{children:"Aktionen"})})]})}),e.jsx(Dn,{children:s.geplantModule.map(t=>e.jsxs(Ee,{children:[e.jsx(H,{children:e.jsx(r,{variant:"body2",fontWeight:600,children:t.modul?.kuerzel})}),e.jsx(H,{children:e.jsx(r,{variant:"body2",children:t.modul?.bezeichnung_de})}),e.jsx(H,{align:"center",children:e.jsx(M,{size:"small",label:v(t),color:"primary",variant:"outlined"})}),e.jsx(H,{align:"center",children:e.jsx(r,{variant:"body2",fontWeight:600,children:t.sws_gesamt?.toFixed(1)||"0.0"})}),e.jsxs(H,{align:"right",children:[e.jsx(Te,{size:"small",onClick:()=>ne(t),color:"primary",children:e.jsx(un,{fontSize:"small"})}),e.jsx(Te,{size:"small",onClick:()=>te(t),color:"error",children:e.jsx(dn,{fontSize:"small"})})]})]},t.id||t.modul_id))})]})})]}),!B&&e.jsx(W,{severity:"warning",sx:{mb:3},children:e.jsx(r,{variant:"body2",children:"Bitte f√ºgen Sie mindestens ein Modul hinzu."})}),e.jsx(Be,{open:D,onClose:()=>O(!1),maxWidth:"md",fullWidth:!0,children:n&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h6",children:y?"Modul bearbeiten":"Modul hinzuf√ºgen"}),e.jsx(Te,{onClick:()=>O(!1),children:e.jsx(Hn,{})})]})}),e.jsxs(Fe,{children:[e.jsxs(N,{variant:"outlined",sx:{p:2,mb:3,bgcolor:"background.default"},children:[e.jsx(r,{variant:"subtitle1",fontWeight:600,children:n.modul.kuerzel}),e.jsx(r,{variant:"body2",color:"text.secondary",children:n.modul.bezeichnung_de}),e.jsxs(l,{sx:{display:"flex",gap:1,mt:1},children:[n.modul.leistungspunkte&&e.jsx(M,{size:"small",icon:e.jsx(le,{}),label:`${n.modul.leistungspunkte} ECTS`}),n.modul.sws_gesamt&&n.modul.sws_gesamt>0&&e.jsx(M,{size:"small",icon:e.jsx(ve,{}),label:`${n.modul.sws_gesamt} SWS (Basis)`,color:"secondary"})]}),n.modul.lehrformen&&n.modul.lehrformen.length>0&&e.jsxs(l,{sx:{mt:2},children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Verf√ºgbare Lehrformen:"}),e.jsx(l,{sx:{display:"flex",gap:.5,mt:.5},children:n.modul.lehrformen.map(t=>e.jsx(M,{size:"small",label:`${t.kuerzel}: ${t.sws} SWS`,variant:"outlined"},t.id))})]})]}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Lehrformen & Multiplikatoren"}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Geben Sie an, wie oft jede Lehrform stattfinden soll (z.B. 2 = Lehrform in 2 Gruppen)."}),e.jsxs(d,{container:!0,spacing:2,children:[Z(n.modul,"V")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"Vorlesungen",value:n.anzahl_vorlesungen,onChange:t=>C({...n,anzahl_vorlesungen:Math.max(0,parseInt(t.target.value)||0)}),InputProps:{endAdornment:e.jsx(Ae,{position:"end",children:e.jsx(M,{size:"small",label:`${n.modul.lehrformen?.find(t=>t.kuerzel==="V")?.sws||0} SWS`})})},inputProps:{min:0,max:Me.maxInput}})}),Z(n.modul,"√ú")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"√úbungen",value:n.anzahl_uebungen,onChange:t=>C({...n,anzahl_uebungen:Math.max(0,parseInt(t.target.value)||0)}),InputProps:{endAdornment:e.jsx(Ae,{position:"end",children:e.jsx(M,{size:"small",label:`${n.modul.lehrformen?.find(t=>t.kuerzel==="√ú")?.sws||0} SWS`})})},inputProps:{min:0,max:Me.maxInput}})}),Z(n.modul,"P")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"Praktika",value:n.anzahl_praktika,onChange:t=>C({...n,anzahl_praktika:Math.max(0,parseInt(t.target.value)||0)}),InputProps:{endAdornment:e.jsx(Ae,{position:"end",children:e.jsx(M,{size:"small",label:`${n.modul.lehrformen?.find(t=>t.kuerzel==="P")?.sws||0} SWS`})})},inputProps:{min:0,max:Me.maxInput}})}),Z(n.modul,"S")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"Seminare",value:n.anzahl_seminare,onChange:t=>C({...n,anzahl_seminare:Math.max(0,parseInt(t.target.value)||0)}),InputProps:{endAdornment:e.jsx(Ae,{position:"end",children:e.jsx(M,{size:"small",label:`${n.modul.lehrformen?.find(t=>t.kuerzel==="S")?.sws||0} SWS`})})},inputProps:{min:0,max:Me.maxInput}})}),(!n.modul.lehrformen||n.modul.lehrformen.length===0)&&e.jsxs(d,{item:!0,xs:12,children:[e.jsx(W,{severity:"warning",children:e.jsx(r,{variant:"body2",children:"F√ºr dieses Modul sind keine Lehrformen definiert. Bitte setzen Sie mindestens einen Multiplikator."})}),e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"Vorlesungen",value:n.anzahl_vorlesungen,onChange:t=>C({...n,anzahl_vorlesungen:Math.max(0,parseInt(t.target.value)||0)}),inputProps:{min:0,max:Me.maxInput}})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(G,{fullWidth:!0,type:"number",label:"√úbungen",value:n.anzahl_uebungen,onChange:t=>C({...n,anzahl_uebungen:Math.max(0,parseInt(t.target.value)||0)}),inputProps:{min:0,max:Me.maxInput}})})]})]})]}),e.jsxs(N,{variant:"outlined",sx:{p:2,mt:2,bgcolor:"primary.50"},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Berechnete Gesamt-SWS f√ºr dieses Modul:"}),e.jsxs(r,{variant:"h5",color:"primary",fontWeight:600,children:[o().toFixed(1)," SWS"]}),n.modul.lehrformen&&n.modul.lehrformen.length>0&&e.jsxs(r,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Berechnung: ",[n.anzahl_vorlesungen>0&&`${n.anzahl_vorlesungen}√ó${n.modul.lehrformen.find(t=>t.kuerzel==="V")?.sws||0}V`,n.anzahl_uebungen>0&&`${n.anzahl_uebungen}√ó${n.modul.lehrformen.find(t=>t.kuerzel==="√ú")?.sws||0}√ú`,n.anzahl_praktika>0&&`${n.anzahl_praktika}√ó${n.modul.lehrformen.find(t=>t.kuerzel==="P")?.sws||0}P`,n.anzahl_seminare>0&&`${n.anzahl_seminare}√ó${n.modul.lehrformen.find(t=>t.kuerzel==="S")?.sws||0}S`].filter(Boolean).join(" + ")||"Keine Berechnung"]})]}),n.anzahl_vorlesungen+n.anzahl_uebungen+n.anzahl_praktika+n.anzahl_seminare===0&&e.jsx(W,{severity:"warning",sx:{mt:2},children:e.jsx(r,{variant:"body2",children:"Bitte setzen Sie mindestens eine Lehrform auf einen Wert gr√∂√üer als 0."})}),e.jsx(xe,{sx:{my:3}}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Raumplanung pro Veranstaltung"}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Geben Sie an, welche R√§ume und Kapazit√§ten Sie f√ºr jede Lehrform ben√∂tigen."}),e.jsxs(d,{container:!0,spacing:2,children:[n.anzahl_vorlesungen>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(W,{severity:"info",icon:e.jsx(le,{}),sx:{py:.5},children:e.jsxs(r,{variant:"subtitle2",children:["Vorlesung (",n.anzahl_vorlesungen,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(G,{fullWidth:!0,size:"small",label:"Raumwunsch Vorlesung",placeholder:"z.B. H√∂rsaal, gro√üer Raum, Geb√§ude B...",value:n.raum_vorlesung,onChange:t=>C({...n,raum_vorlesung:t.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Kapazit√§t",value:n.kapazitaet_vorlesung,onChange:t=>C({...n,kapazitaet_vorlesung:parseInt(t.target.value)||0}),inputProps:{min:0}})})]}),n.anzahl_uebungen>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(W,{severity:"info",icon:e.jsx(le,{}),sx:{py:.5},children:e.jsxs(r,{variant:"subtitle2",children:["√úbung (",n.anzahl_uebungen,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(G,{fullWidth:!0,size:"small",label:"Raumwunsch √úbung",placeholder:"z.B. Seminarraum, Computerraum...",value:n.raum_uebung,onChange:t=>C({...n,raum_uebung:t.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Kapazit√§t",value:n.kapazitaet_uebung,onChange:t=>C({...n,kapazitaet_uebung:parseInt(t.target.value)||0}),inputProps:{min:0}})})]}),n.anzahl_praktika>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(W,{severity:"info",icon:e.jsx(le,{}),sx:{py:.5},children:e.jsxs(r,{variant:"subtitle2",children:["Praktikum (",n.anzahl_praktika,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(G,{fullWidth:!0,size:"small",label:"Raumwunsch Praktikum",placeholder:"z.B. Labor, Computerraum, Werkstatt...",value:n.raum_praktikum,onChange:t=>C({...n,raum_praktikum:t.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Kapazit√§t",value:n.kapazitaet_praktikum,onChange:t=>C({...n,kapazitaet_praktikum:parseInt(t.target.value)||0}),inputProps:{min:0}})})]}),n.anzahl_seminare>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(W,{severity:"info",icon:e.jsx(le,{}),sx:{py:.5},children:e.jsxs(r,{variant:"subtitle2",children:["Seminar (",n.anzahl_seminare,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(G,{fullWidth:!0,size:"small",label:"Raumwunsch Seminar",placeholder:"z.B. Seminarraum...",value:n.raum_seminar,onChange:t=>C({...n,raum_seminar:t.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(G,{fullWidth:!0,size:"small",type:"number",label:"Kapazit√§t",value:n.kapazitaet_seminar,onChange:t=>C({...n,kapazitaet_seminar:parseInt(t.target.value)||0}),inputProps:{min:0}})})]})]}),e.jsx(xe,{sx:{my:3}}),e.jsx(G,{fullWidth:!0,multiline:!0,rows:3,label:"Anmerkungen (optional)",value:n.anmerkungen,onChange:t=>C({...n,anmerkungen:t.target.value}),sx:{mt:2}})]}),e.jsxs($e,{children:[e.jsx(P,{onClick:()=>O(!1),children:"Abbrechen"}),e.jsx(P,{variant:"contained",startIcon:e.jsx(qn,{}),onClick:J,disabled:L||n.anzahl_vorlesungen+n.anzahl_uebungen+n.anzahl_praktika+n.anzahl_seminare===0,children:L?"Speichert...":"Speichern"})]})]})}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:g,children:"Zur√ºck"}),e.jsx(P,{variant:"contained",endIcon:e.jsx(Pe,{}),onClick:i,disabled:!B,children:"Weiter"})]})]})},ln=Ve("StepMitarbeiterZuordnen"),zr=48,yr=8,_r={PaperProps:{style:{maxHeight:zr*4.5+yr,width:250}}},wr=({data:s,onUpdate:k,onNext:i,onBack:g})=>{const[p,x]=m.useState(!0),[D,O]=m.useState([]),[y,T]=m.useState(null),[n,C]=m.useState(new Map);m.useEffect(()=>{L()},[]),m.useEffect(()=>{s.mitarbeiterZuordnung&&C(new Map(s.mitarbeiterZuordnung))},[s.mitarbeiterZuordnung]);const L=async()=>{try{x(!0);const a=await Ge.get("/auth/me");a.data.success&&T(a.data.data);const S=await Ge.get("/dozenten?aktiv=true");if(S.data.success&&O(S.data.data||[]),a.data.success&&a.data.data.dozent_id){const E=a.data.data.dozent_id,R=new Map(s.mitarbeiterZuordnung||new Map);s.geplantModule.forEach($=>{(!R.has($.modul_id)||R.get($.modul_id)?.length===0)&&(ln.debug(" üë§ Auto-assigning professor to module:",$.modul?.kuerzel),R.set($.modul_id,[E]))}),C(R),k({mitarbeiterZuordnung:R})}}catch(a){ln.error(" Error loading data:",a)}finally{x(!1)}},q=(a,S)=>{ln.debug(" üìù Updating assignment for module:",a,"Dozenten:",S);const E=new Map(n);E.set(a,S),C(E),k({mitarbeiterZuordnung:E})},V=a=>y?.dozent_id?(n.get(a)||[]).includes(y.dozent_id):!1,j=()=>s.geplantModule.every(a=>{const S=n.get(a.modul_id);return S&&S.length>0});return p?e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(he,{})}):e.jsxs(l,{children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Mitarbeiter zuordnen"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Ordnen Sie jedem Modul die verantwortlichen Mitarbeiter zu. Sie wurden automatisch als Verantwortlicher eingetragen."})]}),e.jsx(W,{severity:"info",sx:{mb:3},icon:e.jsx(Xe,{}),children:e.jsxs(r,{variant:"body2",children:["Sie k√∂nnen f√ºr jedes Modul mehrere Mitarbeiter ausw√§hlen. Die Auswahl kann sp√§ter noch ge√§ndert werden.",y?.dozent_id&&e.jsx("strong",{children:" Sie wurden automatisch als Verantwortlicher f√ºr alle Module eingetragen."})]})}),s.geplantModule.length>0&&e.jsx(N,{sx:{p:2,mb:3,bgcolor:"background.default"},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{color:"primary"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Geplante Module"}),e.jsx(r,{variant:"h6",children:s.geplantModule.length})]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:j()?"success":"disabled"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Zugeordnet"}),e.jsxs(r,{variant:"h6",children:[Array.from(n.values()).filter(a=>a.length>0).length," / ",s.geplantModule.length]})]})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{color:"action"}),e.jsxs(l,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Verf√ºgbare Dozenten"}),e.jsx(r,{variant:"h6",children:D.length})]})]})})]})}),s.geplantModule.length===0?e.jsx(W,{severity:"warning",children:e.jsx(r,{variant:"body2",children:"Keine Module vorhanden. Bitte gehen Sie zur√ºck und f√ºgen Sie Module hinzu."})}):e.jsx(d,{container:!0,spacing:2,children:s.geplantModule.map(a=>e.jsx(d,{item:!0,xs:12,children:e.jsx(ue,{variant:"outlined",children:e.jsx(de,{children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsxs(d,{item:!0,xs:12,md:4,children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(le,{color:"primary"}),e.jsx(r,{variant:"h6",children:a.modul?.kuerzel}),V(a.modul_id)&&e.jsx(M,{size:"small",label:"Sie",color:"primary",icon:e.jsx(Le,{})})]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:a.modul?.bezeichnung_de}),e.jsxs(l,{sx:{display:"flex",gap:.5,mt:1},children:[a.modul?.leistungspunkte&&e.jsx(M,{size:"small",label:`${a.modul.leistungspunkte} ECTS`}),a.sws_gesamt&&e.jsx(M,{size:"small",label:`${a.sws_gesamt.toFixed(1)} SWS`,color:"secondary"})]})]}),e.jsx(xe,{orientation:"vertical",flexItem:!0,sx:{display:{xs:"none",md:"block"}}}),e.jsxs(d,{item:!0,xs:12,md:7,children:[e.jsxs(Mn,{fullWidth:!0,children:[e.jsx(Cn,{id:`dozenten-label-${a.modul_id}`,children:"Mitarbeiter ausw√§hlen"}),e.jsx(In,{labelId:`dozenten-label-${a.modul_id}`,multiple:!0,value:n.get(a.modul_id)||[],onChange:S=>q(a.modul_id,S.target.value),input:e.jsx(Un,{label:"Mitarbeiter ausw√§hlen"}),renderValue:S=>e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:S.map(E=>{const R=D.find($=>$.id===E);return R?e.jsx(M,{label:R.name_kurz,size:"small",icon:E===y?.dozent_id?e.jsx(Le,{}):void 0,color:E===y?.dozent_id?"primary":"default"},E):e.jsx(M,{label:`Unbekannt (ID: ${E})`,size:"small",color:"error",title:"Dieser Dozent ist nicht mehr verf√ºgbar. Bitte entfernen und neu zuweisen."},E)})}),MenuProps:_r,children:D.map(S=>e.jsxs(De,{value:S.id,children:[e.jsx(An,{checked:(n.get(a.modul_id)||[]).includes(S.id)}),e.jsx(Ke,{primary:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[S.name_komplett,S.id===y?.dozent_id&&e.jsx(M,{size:"small",label:"Sie",color:"primary"})]}),secondary:S.email})]},S.id))})]}),e.jsx(l,{sx:{mt:1,display:"flex",alignItems:"center",gap:1},children:(n.get(a.modul_id)||[]).length>0?e.jsxs(e.Fragment,{children:[e.jsx(Q,{fontSize:"small",color:"success"}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:[(n.get(a.modul_id)||[]).length," Mitarbeiter zugeordnet"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Jn,{fontSize:"small",color:"disabled"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"Keine Mitarbeiter zugeordnet"})]})})]})]})})})},a.modul_id))}),!j()&&s.geplantModule.length>0&&e.jsx(W,{severity:"warning",sx:{mt:3},children:e.jsx(r,{variant:"body2",children:"Bitte ordnen Sie allen Modulen mindestens einen Mitarbeiter zu, um fortzufahren."})}),j()&&s.geplantModule.length>0&&e.jsx(W,{severity:"success",sx:{mt:3},children:e.jsx(r,{variant:"body2",children:"‚úì Alle Module haben zugeordnete Mitarbeiter. Sie k√∂nnen fortfahren."})}),e.jsxs(W,{severity:"info",sx:{mt:3},children:[e.jsx(r,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Optionaler Schritt"}),e.jsx(r,{variant:"body2",children:"Die Mitarbeiter-Zuordnung ist optional. Sie k√∂nnen auch ohne Zuordnung fortfahren und diese sp√§ter vornehmen."})]}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:g,children:"Zur√ºck"}),e.jsx(P,{variant:"contained",endIcon:e.jsx(Pe,{}),onClick:i,children:"Weiter"})]})]})},Ce=Ve("StepSemesterauftraege"),Mr=({data:s,onNext:k,onBack:i})=>{const{triggerRefresh:g}=br(),[p,x]=m.useState(!0),[D,O]=m.useState([]),[y,T]=m.useState([]),[n,C]=m.useState(!1),[L,q]=m.useState(null),[V,j]=m.useState(0),[a,S]=m.useState(""),[E,R]=m.useState(null),[$,ne]=m.useState(!1);m.useEffect(()=>{J()},[s.semesterId]);const J=async()=>{if(!s.semesterId){x(!1);return}try{x(!0),R(null);const h=await Ue.getAlleAuftraege(!0);O(h);const f=await Ue.getMeineAuftraege(s.semesterId);T(f),Ce.debug(" Loaded:",h.length,"auftr√§ge,",f.length,"meine")}catch(h){Ce.error(" Error loading data:",h),R(oe(h,"Fehler beim Laden der Auftr√§ge"))}finally{x(!1)}},te=h=>{q(h),j(h.standard_sws),S(""),C(!0)},X=()=>{C(!1),q(null),j(0),S("")},o=async()=>{if(!(!L||!s.semesterId))try{ne(!0),R(null);const h=await Ue.beantrageAuftrag(s.semesterId,{auftrag_id:L.id,anmerkung:a||void 0});T([...y,h]),s.semesterId&&await g(s.semesterId),X(),Ce.debug(" ‚úÖ Auftrag beantragt:",h)}catch(h){Ce.error(" Error beantragen:",h),R(oe(h,"Fehler beim Beantragen"))}finally{ne(!1)}},v=async h=>{if(window.confirm("M√∂chten Sie diesen Auftrag wirklich zur√ºckziehen?"))try{R(null),await Ue.deleteSemesterAuftrag(h),T(y.filter(u=>u.id!==h)),s.semesterId&&await g(s.semesterId),Ce.debug(" ‚úÖ Auftrag zur√ºckgezogen:",h)}catch(u){Ce.error(" Error deleting:",u),R(oe(u,"Fehler beim L√∂schen"))}},A=h=>y.some(f=>f.auftrag_id===h),B=h=>{switch(h){case"genehmigt":return"success";case"abgelehnt":return"error";case"beantragt":return"warning";default:return"default"}},Z=h=>{switch(h){case"genehmigt":return e.jsx(Q,{fontSize:"small"});case"abgelehnt":return e.jsx(Qn,{fontSize:"small"});case"beantragt":return e.jsx(ve,{fontSize:"small"});default:return}},t=()=>y.filter(h=>h.status==="genehmigt").reduce((h,f)=>h+f.sws,0),b=()=>s.geplantModule?.reduce((h,f)=>h+(f.sws_gesamt||0),0)||0,z=()=>b()+t();if(p)return e.jsxs(l,{sx:{display:"flex",justifyContent:"center",py:4},children:[e.jsx(he,{}),e.jsx(r,{sx:{ml:2},children:"Lade Auftr√§ge..."})]});if(!s.semesterId)return e.jsx(W,{severity:"warning",children:e.jsx(r,{variant:"body2",children:"Bitte w√§hlen Sie zuerst ein Semester aus (Schritt 1)."})});const I=b(),ee=t(),se=z(),ge=y.filter(h=>h.status==="beantragt").length,me=y.filter(h=>h.status==="genehmigt").length;return e.jsxs(l,{children:[e.jsx(W,{severity:"info",icon:e.jsx(Xe,{}),sx:{mb:3},children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Semesterauftr√§ge"})," sind administrative T√§tigkeiten wie Dekanin, Prodekan, Studiengangsbeauftragter, etc. Sie k√∂nnen hier Auftr√§ge beantragen. Der Dekan muss diese genehmigen, bevor sie zu Ihrer SWS-Last hinzugef√ºgt werden."]})}),E&&e.jsx(W,{severity:"error",onClose:()=>R(null),sx:{mb:3},children:E}),e.jsx(N,{sx:{p:2,mb:3,bgcolor:"primary.lighter"},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Module SWS"}),e.jsxs(r,{variant:"h6",children:[I.toFixed(1)," SWS"]})]}),e.jsxs(d,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Genehmigte Auftr√§ge"}),e.jsxs(r,{variant:"h6",color:"success.main",children:[ee.toFixed(1)," SWS"]})]}),e.jsxs(d,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Gesamt SWS"}),e.jsx(r,{variant:"h6",color:"primary.main",children:e.jsxs("strong",{children:[se.toFixed(1)," SWS"]})})]}),e.jsxs(d,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Status"}),e.jsxs(r,{variant:"body2",children:[me," genehmigt ‚Ä¢ ",ge," beantragt"]})]})]})}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(N,{sx:{p:2},children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Yn,{}),"Meine Auftr√§ge (",y.length,")"]}),e.jsx(xe,{sx:{my:2}}),y.length===0?e.jsx(W,{severity:"info",children:e.jsx(r,{variant:"body2",children:"Sie haben noch keine Auftr√§ge beantragt."})}):e.jsx(en,{children:y.map(h=>e.jsxs(nn,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,bgcolor:"background.default"},children:[e.jsx(Ke,{primary:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"subtitle2",children:h.auftrag?.name||`Auftrag #${h.auftrag_id}`}),e.jsx(M,{label:h.status,size:"small",color:B(h.status),icon:Z(h.status)})]}),secondary:e.jsxs(l,{children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:[h.sws.toFixed(1)," SWS",h.auftrag&&h.sws!==h.auftrag.standard_sws&&e.jsx(M,{label:`Standard: ${h.auftrag.standard_sws} SWS`,size:"small",sx:{ml:1}})]}),h.anmerkung&&e.jsx(r,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:h.anmerkung})]})}),e.jsx(Ln,{children:h.status==="beantragt"&&e.jsx(En,{title:"Zur√ºckziehen",children:e.jsx(Te,{edge:"end",onClick:()=>v(h.id),size:"small",color:"error",children:e.jsx(dn,{})})})})]},h.id))})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(N,{sx:{p:2},children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{}),"Verf√ºgbare Auftr√§ge (",D.length,")"]}),e.jsx(xe,{sx:{my:2}}),D.length===0?e.jsx(W,{severity:"warning",children:e.jsx(r,{variant:"body2",children:"Keine Auftr√§ge verf√ºgbar."})}):e.jsx(l,{sx:{maxHeight:500,overflowY:"auto"},children:D.map(h=>{const f=A(h.id);return e.jsx(ue,{sx:{mb:1.5,opacity:f?.6:1,border:"1px solid",borderColor:f?"success.main":"divider"},children:e.jsx(de,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{sx:{flex:1},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:h.name}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem",mb:1},children:h.beschreibung}),e.jsx(M,{label:`${h.standard_sws.toFixed(1)} SWS`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(P,{variant:f?"outlined":"contained",size:"small",startIcon:f?e.jsx(Q,{}):e.jsx(We,{}),onClick:()=>te(h),disabled:f,sx:{ml:1},children:f?"Beantragt":"Beantragen"})]})})},h.id)})})]})})]}),e.jsxs(Be,{open:n,onClose:X,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Re,{children:["Auftrag beantragen: ",L?.name]}),e.jsx(Fe,{children:L&&e.jsxs(l,{sx:{pt:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:L.beschreibung}),e.jsx(G,{label:"SWS",type:"number",fullWidth:!0,value:V,disabled:!0,InputProps:{readOnly:!0},helperText:"SWS wird vom Dekan festgelegt und kann hier nicht ge√§ndert werden",sx:{mb:2}}),e.jsx(G,{label:"Anmerkung (optional)",multiline:!0,rows:3,fullWidth:!0,value:a,onChange:h=>S(h.target.value),placeholder:"Zus√§tzliche Informationen oder Begr√ºndung..."}),e.jsx(W,{severity:"info",sx:{mt:2},children:e.jsx(r,{variant:"caption",children:"Der Auftrag wird zur Genehmigung an den Dekan gesendet. Nach Genehmigung wird die SWS zu Ihrer Gesamtlast hinzugef√ºgt."})})]})}),e.jsxs($e,{children:[e.jsx(P,{onClick:X,disabled:$,children:"Abbrechen"}),e.jsx(P,{onClick:o,variant:"contained",disabled:$||V<=0,startIcon:$?e.jsx(he,{size:16}):e.jsx(We,{}),children:$?"Wird beantragt...":"Beantragen"})]})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(P,{onClick:i,startIcon:e.jsx(ke,{}),variant:"outlined",children:"Zur√ºck"}),e.jsx(P,{onClick:k,endIcon:e.jsx(Pe,{}),variant:"contained",children:"Weiter"})]}),e.jsx(l,{sx:{mt:2,textAlign:"center"},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:"üí° Dieser Schritt ist optional. Sie k√∂nnen auch ohne Auftr√§ge fortfahren."})})]})},Cr=({data:s,onUpdate:k,onNext:i,onBack:g})=>{const[p,x]=m.useState(s.anmerkungen||""),[D,O]=m.useState(s.raumbedarf||""),[y,T]=m.useState(s.raum_vorlesung||""),[n,C]=m.useState(s.raum_uebung||""),[L,q]=m.useState(s.raum_praktikum||""),[V,j]=m.useState(s.raum_seminar||""),a=s.modul?.lehrformen?.some(u=>u.kuerzel==="V")||!1,S=s.modul?.lehrformen?.some(u=>u.kuerzel==="√ú")||!1,E=s.modul?.lehrformen?.some(u=>u.kuerzel==="P")||!1,R=s.modul?.lehrformen?.some(u=>u.kuerzel==="S")||!1,[$,ne]=m.useState(s.roomRequirements||[]),[J,te]=m.useState({needsComputerRoom:s.specialRequests?.needsComputerRoom||!1,needsLab:s.specialRequests?.needsLab||!1,needsBeamer:s.specialRequests?.needsBeamer||!0,needsWhiteboard:s.specialRequests?.needsWhiteboard||!0,flexibleScheduling:s.specialRequests?.flexibleScheduling||!1,blockCourse:s.specialRequests?.blockCourse||!1}),[X,o]=m.useState(!1),[v,A]=m.useState(null),[B,Z]=m.useState({id:"",type:"Seminarraum",capacity:ie.vorlesung,equipment:[],notes:""}),t=[{value:"H√∂rsaal",label:"H√∂rsaal",icon:e.jsx(Bn,{})},{value:"Seminarraum",label:"Seminarraum",icon:e.jsx(sn,{})},{value:"Computerraum",label:"Computerraum",icon:e.jsx(er,{})},{value:"Labor",label:"Labor",icon:e.jsx(nr,{})}],b=["Beamer","Whiteboard","Tafel","Flipchart","Videokonferenz","Smartboard","Mikrofonanlage","Computer-Arbeitspl√§tze"],z=()=>{k({anmerkungen:p,raumbedarf:D,roomRequirements:$,specialRequests:J,raum_vorlesung:y,raum_uebung:n,raum_praktikum:L,raum_seminar:V})},I=(u,U)=>{const ae={...J,[u]:U};te(ae),z()},ee=u=>{u?(A(u),Z(u)):(A(null),Z({id:Date.now().toString(),type:"Seminarraum",capacity:ie.vorlesung,equipment:[],notes:""})),o(!0)},se=()=>{o(!1),A(null),Z({id:"",type:"Seminarraum",capacity:ie.vorlesung,equipment:[],notes:""})},ge=()=>{let u;v?u=$.map(U=>U.id===v.id?B:U):u=[...$,{...B,id:Date.now().toString()}],ne(u),k({anmerkungen:p,raumbedarf:D,roomRequirements:u,specialRequests:J}),se()},me=u=>{const U=$.filter(ae=>ae.id!==u);ne(U),k({anmerkungen:p,raumbedarf:D,roomRequirements:U,specialRequests:J})},h=u=>{const U=B.equipment.includes(u)?B.equipment.filter(ae=>ae!==u):[...B.equipment,u];Z({...B,equipment:U})},f=()=>{a&&!y||(z(),i())};return e.jsxs(l,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Zus√§tzliche Informationen und Anforderungen"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Geben Sie spezielle Anforderungen und Hinweise f√ºr Ihre Semesterplanung an."}),e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(r,{variant:"subtitle1",fontWeight:500,gutterBottom:!0,children:"Spezielle Anforderungen"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.needsComputerRoom,onChange:u=>I("needsComputerRoom",u.target.checked)}),label:"Computerraum ben√∂tigt"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.needsLab,onChange:u=>I("needsLab",u.target.checked)}),label:"Labor ben√∂tigt"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.needsBeamer,onChange:u=>I("needsBeamer",u.target.checked)}),label:"Beamer in allen R√§umen"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.needsWhiteboard,onChange:u=>I("needsWhiteboard",u.target.checked)}),label:"Whiteboard/Tafel ben√∂tigt"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.flexibleScheduling,onChange:u=>I("flexibleScheduling",u.target.checked)}),label:"Flexible Terminplanung m√∂glich"})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(fe,{control:e.jsx(we,{checked:J.blockCourse,onChange:u=>I("blockCourse",u.target.checked)}),label:"Blockveranstaltung geplant"})})]})]}),e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(r,{variant:"subtitle1",fontWeight:500,children:"Raumanforderungen"}),e.jsx(P,{size:"small",startIcon:e.jsx(We,{}),onClick:()=>ee(),children:"Raum hinzuf√ºgen"})]}),$.length>0?e.jsx(en,{children:$.map((u,U)=>e.jsxs(dr.Fragment,{children:[U>0&&e.jsx(xe,{}),e.jsxs(nn,{children:[e.jsx(Ke,{primary:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.find(ae=>ae.value===u.type)?.icon,e.jsxs(r,{variant:"subtitle2",children:[u.type," (Kapazit√§t: ",u.capacity," Personen)"]})]}),secondary:e.jsxs(l,{sx:{mt:.5},children:[u.equipment.length>0&&e.jsx(l,{sx:{display:"flex",gap:.5,flexWrap:"wrap",mb:.5},children:u.equipment.map(ae=>e.jsx(M,{label:ae,size:"small",variant:"outlined"},ae))}),u.notes&&e.jsx(r,{variant:"caption",color:"text.secondary",children:u.notes})]})}),e.jsxs(Ln,{children:[e.jsx(Te,{edge:"end",size:"small",onClick:()=>ee(u),sx:{mr:1},children:e.jsx(un,{})}),e.jsx(Te,{edge:"end",size:"small",onClick:()=>me(u.id),children:e.jsx(dn,{})})]})]})]},u.id))}):e.jsx(W,{severity:"info",children:"Keine speziellen Raumanforderungen angegeben. Standardr√§ume werden zugeteilt."})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(N,{sx:{p:3,height:"100%"},children:[e.jsxs(r,{variant:"subtitle1",fontWeight:500,gutterBottom:!0,children:[e.jsx(Xn,{sx:{mr:1,verticalAlign:"middle"}}),"Allgemeine Anmerkungen"]}),e.jsx(G,{fullWidth:!0,multiline:!0,rows:6,placeholder:"Hier k√∂nnen Sie allgemeine Hinweise und Anmerkungen zur Planung eingeben...",value:p,onChange:u=>x(u.target.value),onBlur:z}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"z.B. Pr√§ferenzen, Hinweise f√ºr die Stundenplanung, etc."})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(N,{sx:{p:3,height:"100%"},children:[e.jsxs(r,{variant:"subtitle1",fontWeight:500,gutterBottom:!0,children:[e.jsx(sn,{sx:{mr:1,verticalAlign:"middle"}}),"Raumbedarf Details"]}),e.jsx(G,{fullWidth:!0,multiline:!0,rows:6,placeholder:"Spezielle Anforderungen an R√§ume und Ausstattung...",value:D,onChange:u=>O(u.target.value),onBlur:z}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"z.B. barrierefreier Zugang, spezielle Laborausstattung, etc."})]})})]}),s.modul&&(a||S||E||R)&&e.jsxs(N,{sx:{p:3,mt:3},children:[e.jsxs(r,{variant:"subtitle1",fontWeight:500,gutterBottom:!0,children:[e.jsx(sn,{sx:{mr:1,verticalAlign:"middle"}}),"Raumplanung pro Lehrform"]}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Geben Sie f√ºr jede Lehrform den gew√ºnschten Raum an"}),e.jsxs(d,{container:!0,spacing:2,children:[a&&e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(G,{fullWidth:!0,label:"Raum f√ºr Vorlesung",required:!0,placeholder:"z.B. HS 101, A-Geb√§ude H√∂rsaal 3",value:y,onChange:u=>T(u.target.value),onBlur:z,helperText:"Pflichtfeld - Raum f√ºr die Vorlesung",error:!y})}),S&&e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(G,{fullWidth:!0,label:"Raum f√ºr √úbung",placeholder:"z.B. SR 201, B-Geb√§ude Seminarraum 5",value:n,onChange:u=>C(u.target.value),onBlur:z,helperText:"Optional - Raum f√ºr die √úbung"})}),E&&e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(G,{fullWidth:!0,label:"Raum f√ºr Praktikum",placeholder:"z.B. Labor 301, C-Geb√§ude PC-Pool 1",value:L,onChange:u=>q(u.target.value),onBlur:z,helperText:"Optional - Raum f√ºr das Praktikum"})}),R&&e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(G,{fullWidth:!0,label:"Raum f√ºr Seminar",placeholder:"z.B. SR 102, D-Geb√§ude Seminarraum 2",value:V,onChange:u=>j(u.target.value),onBlur:z,helperText:"Optional - Raum f√ºr das Seminar"})})]})]}),e.jsxs(W,{severity:"info",sx:{mt:3},children:[e.jsx(Ye,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xe,{}),e.jsx("span",{children:"Hinweis zur Raumplanung"})]})}),"Die Raumzuteilung erfolgt nach Verf√ºgbarkeit. Ihre Anforderungen werden bei der Planung ber√ºcksichtigt, k√∂nnen aber nicht garantiert werden. Bei speziellen Anforderungen kontaktieren Sie bitte fr√ºhzeitig die Raumverwaltung."]}),e.jsxs(Be,{open:X,onClose:se,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Re,{children:v?"Raumanforderung bearbeiten":"Neue Raumanforderung"}),e.jsx(Fe,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(G,{select:!0,fullWidth:!0,label:"Raumtyp",value:B.type,onChange:u=>Z({...B,type:u.target.value}),SelectProps:{native:!0},children:t.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,type:"number",label:"Kapazit√§t (Personen)",value:B.capacity,onChange:u=>Z({...B,capacity:parseInt(u.target.value)||0}),inputProps:{min:1,max:500}})}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Ben√∂tigte Ausstattung"}),e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:b.map(u=>e.jsx(M,{label:u,onClick:()=>h(u),color:B.equipment.includes(u)?"primary":"default",variant:B.equipment.includes(u)?"filled":"outlined"},u))})]}),e.jsx(d,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,multiline:!0,rows:2,label:"Zus√§tzliche Hinweise",value:B.notes,onChange:u=>Z({...B,notes:u.target.value})})})]})}),e.jsxs($e,{children:[e.jsx(P,{onClick:se,children:"Abbrechen"}),e.jsx(P,{variant:"contained",onClick:ge,children:v?"Speichern":"Hinzuf√ºgen"})]})]}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:g,children:"Zur√ºck"}),e.jsx(P,{variant:"contained",endIcon:e.jsx(Pe,{}),onClick:f,children:"Weiter"})]})]})},Ir=({data:s,onUpdate:k,onNext:i,onBack:g})=>{const[p,x]=m.useState(s.wunschFreieTage||[]);m.useEffect(()=>{s.wunschFreieTage&&x(s.wunschFreieTage)},[s.wunschFreieTage]);const D=O=>{x(O),k({wunschFreieTage:O})};return e.jsxs(l,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Wunsch-freie Tage f√ºr die Stundenplanung"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Geben Sie an, an welchen Tagen Sie bevorzugt keine Lehrveranstaltungen haben m√∂chten."}),e.jsx(jr,{wunschFreieTage:p,onChange:D}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:g,children:"Zur√ºck"}),e.jsx(P,{variant:"contained",endIcon:e.jsx(Pe,{}),onClick:i,children:"Weiter zur Zusammenfassung"})]})]})},Ar=({data:s,onBack:k,onSubmit:i,planungId:g,onGoToStep:p})=>{const[x,D]=m.useState(!1),O=async()=>{D(!0);try{await i()}finally{D(!1)}},y=j=>{p&&p(j)},T=()=>s.geplantModule?.reduce((j,a)=>{const E=a.sws_gesamt||(a.sws_vorlesung||0)+(a.sws_uebung||0)+(a.sws_praktikum||0)+(a.sws_seminar||0)||(a.anzahl_vorlesungen||0)*2+(a.anzahl_uebungen||0)*2+(a.anzahl_praktika||0)*2+(a.anzahl_seminare||0)*2;return j+E},0)||0,n=()=>s.geplantModule?.reduce((j,a)=>j+(a.modul?.leistungspunkte||0),0)||0,C=j=>{const a=[];return j.anzahl_vorlesungen>0&&a.push(`${j.anzahl_vorlesungen}V`),j.anzahl_uebungen>0&&a.push(`${j.anzahl_uebungen}√ú`),j.anzahl_praktika>0&&a.push(`${j.anzahl_praktika}P`),j.anzahl_seminare>0&&a.push(`${j.anzahl_seminare}S`),a.join(" + ")||"Keine Lehrformen"},L=()=>{if(!s.mitarbeiterZuordnung)return 0;if(s.mitarbeiterZuordnung instanceof Map){let j=0;return s.mitarbeiterZuordnung.forEach(a=>{j+=a.length}),j}return Object.values(s.mitarbeiterZuordnung).reduce((j,a)=>j+(Array.isArray(a)?a.length:0),0)},q=()=>s.semesterId&&s.geplantModule&&s.geplantModule.length>0&&T()>0,V=({icon:j,title:a,count:S,editStep:E})=>e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[j,e.jsxs(r,{variant:"h6",children:[a,S!==void 0&&S>0&&e.jsx(M,{label:S,size:"small",sx:{ml:1}})]})]}),E!==void 0&&p&&e.jsx(En,{title:`${a} bearbeiten`,children:e.jsx(P,{size:"small",variant:"outlined",startIcon:e.jsx(un,{}),onClick:()=>y(E),children:"Bearbeiten"})})]});return e.jsxs(l,{children:[e.jsxs(l,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Zusammenfassung Ihrer Planung"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"√úberpr√ºfen Sie alle Angaben vor dem Einreichen. Nach dem Einreichen k√∂nnen keine √Ñnderungen mehr vorgenommen werden."})]}),!q()&&e.jsxs(W,{severity:"error",sx:{mb:3},icon:e.jsx(Qe,{}),children:[e.jsx(r,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Ihre Planung ist unvollst√§ndig"}),e.jsx(r,{variant:"body2",children:!s.semesterId&&"‚Ä¢ Kein Semester ausgew√§hlt"}),e.jsx(r,{variant:"body2",children:(!s.geplantModule||s.geplantModule.length===0)&&"‚Ä¢ Keine Module hinzugef√ºgt"}),e.jsx(r,{variant:"body2",children:T()===0&&"‚Ä¢ Gesamt-SWS ist 0"})]}),s.semester&&e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(V,{icon:e.jsx(_n,{color:"primary"}),title:"Semester",editStep:0}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Bezeichnung"}),e.jsx(r,{variant:"body1",fontWeight:500,children:s.semester.bezeichnung})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"K√ºrzel"}),e.jsx(r,{variant:"body1",fontWeight:500,children:s.semester.kuerzel})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Zeitraum"}),e.jsxs(r,{variant:"body1",fontWeight:500,children:[new Date(s.semester.start_datum).toLocaleDateString("de-DE")," - ",new Date(s.semester.ende_datum).toLocaleDateString("de-DE")]})]}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(l,{sx:{display:"flex",gap:1},children:[s.semester.ist_aktiv&&e.jsx(M,{label:"Aktiv",size:"small",color:"success"}),s.semester.ist_planungsphase&&e.jsx(M,{label:"Planungsphase",size:"small",color:"primary"})]})})]})]}),s.geplantModule&&s.geplantModule.length>0&&e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(V,{icon:e.jsx(le,{color:"primary"}),title:"Geplante Module",count:s.geplantModule.length,editStep:2}),e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ue,{variant:"outlined",children:e.jsxs(de,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(le,{color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Anzahl Module"})]}),e.jsx(r,{variant:"h4",children:s.geplantModule.length})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ue,{variant:"outlined",children:e.jsxs(de,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(ve,{color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Gesamt SWS"})]}),e.jsx(r,{variant:"h4",children:T().toFixed(1)})]})})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(ue,{variant:"outlined",children:e.jsxs(de,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Q,{color:"action"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Gesamt ECTS"})]}),e.jsx(r,{variant:"h4",children:n()})]})})})]}),e.jsx(Wn,{children:e.jsxs(Tn,{size:"small",children:[e.jsx(Pn,{children:e.jsxs(Ee,{children:[e.jsx(H,{children:e.jsx("strong",{children:"K√ºrzel"})}),e.jsx(H,{children:e.jsx("strong",{children:"Bezeichnung"})}),e.jsx(H,{align:"center",children:e.jsx("strong",{children:"Lehrformen"})}),e.jsx(H,{align:"center",children:e.jsx("strong",{children:"SWS"})}),e.jsx(H,{align:"center",children:e.jsx("strong",{children:"ECTS"})})]})}),e.jsxs(Dn,{children:[s.geplantModule.map((j,a)=>e.jsxs(Ee,{children:[e.jsx(H,{children:e.jsx(r,{variant:"body2",fontWeight:600,children:j.modul?.kuerzel})}),e.jsx(H,{children:e.jsx(r,{variant:"body2",children:j.modul?.bezeichnung_de})}),e.jsx(H,{align:"center",children:e.jsx(M,{label:C(j),size:"small",color:"primary",variant:"outlined"})}),e.jsx(H,{align:"center",children:e.jsx(r,{variant:"body2",fontWeight:600,children:j.sws_gesamt?.toFixed(1)})}),e.jsx(H,{align:"center",children:e.jsx(r,{variant:"body2",children:j.modul?.leistungspunkte})})]},j.id||a)),e.jsxs(Ee,{sx:{bgcolor:"background.default"},children:[e.jsx(H,{colSpan:3,children:e.jsx(r,{variant:"subtitle2",fontWeight:600,children:"Gesamt"})}),e.jsx(H,{align:"center",children:e.jsxs(r,{variant:"subtitle2",fontWeight:600,children:[T().toFixed(1)," SWS"]})}),e.jsx(H,{align:"center",children:e.jsxs(r,{variant:"subtitle2",fontWeight:600,children:[n()," ECTS"]})})]})]})]})})]}),L()>0&&e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(V,{icon:e.jsx(Bn,{color:"primary"}),title:"Mitarbeiter-Zuordnung",count:L(),editStep:3}),e.jsx(W,{severity:"info",icon:e.jsx(Q,{}),children:e.jsxs(r,{variant:"body2",children:[L()," Mitarbeiter-Zuordnung(en) wurden vorgenommen."]})})]}),(s.anmerkungen||s.raumbedarf||s.wunschFreieTage&&s.wunschFreieTage.length>0)&&e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(V,{icon:e.jsx(Xe,{color:"primary"}),title:"Zus√§tzliche Informationen",editStep:5}),s.anmerkungen&&e.jsxs(l,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Anmerkungen"}),e.jsx(N,{variant:"outlined",sx:{p:2,bgcolor:"background.default"},children:e.jsx(r,{variant:"body2",children:s.anmerkungen})})]}),s.raumbedarf&&e.jsxs(l,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Raumbedarf"}),e.jsx(N,{variant:"outlined",sx:{p:2,bgcolor:"background.default"},children:e.jsx(r,{variant:"body2",children:s.raumbedarf})})]})]}),s.wunschFreieTage&&s.wunschFreieTage.length>0&&e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsx(V,{icon:e.jsx(rr,{color:"primary"}),title:"Wunsch-freie Tage",count:s.wunschFreieTage.length,editStep:6}),e.jsx(N,{variant:"outlined",sx:{p:2,bgcolor:"background.default"},children:e.jsx(en,{dense:!0,children:s.wunschFreieTage.map((j,a)=>{let S="Datum nicht angegeben";if(j.datum){const E=new Date(j.datum);isNaN(E.getTime())||(S=E.toLocaleDateString("de-DE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}else j.wochentag&&(S=j.wochentag+(j.zeitraum?` (${j.zeitraum})`:""));return e.jsx(nn,{children:e.jsx(Ke,{primary:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",fontWeight:500,children:S}),j.prioritaet&&e.jsx(M,{label:j.prioritaet,size:"small",color:j.prioritaet==="hoch"?"error":j.prioritaet==="mittel"?"warning":"default"})]}),secondary:j.grund||"Kein Grund angegeben"})},a)})})})]}),g&&e.jsx(W,{severity:"info",sx:{mb:3},children:e.jsxs(r,{variant:"body2",children:["Planung ID: ",e.jsx("strong",{children:g})]})}),e.jsxs(W,{severity:"warning",sx:{mb:3},icon:e.jsx(Qe,{}),children:[e.jsx(r,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Wichtiger Hinweis"}),e.jsx(r,{variant:"body2",children:"Nach dem Einreichen k√∂nnen keine √Ñnderungen mehr vorgenommen werden. Die Planung wird an den Dekan zur Pr√ºfung weitergeleitet."})]}),e.jsxs(l,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(P,{startIcon:e.jsx(ke,{}),onClick:k,disabled:x,children:"Zur√ºck"}),e.jsx(P,{variant:"contained",color:"success",size:"large",endIcon:x?e.jsx(he,{size:20,color:"inherit"}):e.jsx(tr,{}),onClick:O,disabled:!q()||x,children:x?"Wird eingereicht...":"Planung jetzt einreichen"})]}),e.jsx(l,{sx:{mt:3,textAlign:"center"},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:"Bei Fragen wenden Sie sich bitte an den Dekan oder die Verwaltung."})})]})},F=Ve("PlanungStore");let Je=null;const re=(s,k=300)=>{Je&&clearTimeout(Je),Je=setTimeout(()=>{s(),Je=null},k)},on=()=>{const s=Ze.getState().user;return!s||!s.id?(F.warn(" ‚ö† No user logged in, using fallback key"),"planung_wizard_backup_anonymous"):`planung_wizard_backup_user_${s.id}`},yn={semesterId:null,semester:null,selectedModules:[],geplantModule:[],mitarbeiterZuordnung:new Map,anmerkungen:"",raumbedarf:"",wunschFreieTage:[],planungId:null,currentStep:0,isLoading:!1,error:null,lastSaved:null,isDirty:!1},Wr=xr()(gr((s,k)=>({...yn,setWizardData:i=>{F.debug(" üíæ Updating wizard data:",Object.keys(i)),s(g=>{let p={...i};i.mitarbeiterZuordnung!==void 0&&!(i.mitarbeiterZuordnung instanceof Map)&&(Array.isArray(i.mitarbeiterZuordnung)?(p.mitarbeiterZuordnung=new Map(i.mitarbeiterZuordnung),F.debug(" üîÑ Converted mitarbeiterZuordnung from Array to Map")):typeof i.mitarbeiterZuordnung=="object"&&i.mitarbeiterZuordnung!==null&&(p.mitarbeiterZuordnung=new Map(Object.entries(i.mitarbeiterZuordnung).map(([D,O])=>[Number(D),O])),F.debug(" üîÑ Converted mitarbeiterZuordnung from Object to Map")));const x={...g,...p,isDirty:!0};return re(()=>k().saveToLocalStorage()),x})},setSemester:i=>{F.debug(" üìÖ Setting semester:",i.bezeichnung),s({semester:i,semesterId:i.id,isDirty:!0}),re(()=>k().saveToLocalStorage())},setSelectedModules:i=>{F.debug(" üìö Setting selected modules:",i.length),s({selectedModules:i,isDirty:!0}),re(()=>k().saveToLocalStorage())},addSelectedModule:i=>{F.debug(" ‚ûï Adding module:",i.kuerzel),s(g=>({selectedModules:[...g.selectedModules,i],isDirty:!0})),re(()=>k().saveToLocalStorage())},removeSelectedModule:i=>{F.debug(" ‚ûñ Removing module:",i),s(g=>({selectedModules:g.selectedModules.filter(p=>p.id!==i),isDirty:!0})),re(()=>k().saveToLocalStorage())},setGeplantModule:i=>{F.debug(" üìã Setting geplant module:",i.length),s({geplantModule:i,isDirty:!0}),re(()=>k().saveToLocalStorage())},addGeplantesModul:i=>{F.debug(" ‚ûï Adding geplantes modul:",i.modul_id),s(g=>({geplantModule:[...g.geplantModule,i],isDirty:!0})),re(()=>k().saveToLocalStorage())},updateGeplantesModul:i=>{F.debug(" ‚úèÔ∏è Updating geplantes modul:",i.id),s(g=>({geplantModule:g.geplantModule.map(p=>p.id===i.id?i:p),isDirty:!0})),re(()=>k().saveToLocalStorage())},removeGeplantesModul:i=>{F.debug(" üóëÔ∏è Removing geplantes modul:",i),s(g=>({geplantModule:g.geplantModule.filter(p=>p.modul_id!==i),isDirty:!0})),re(()=>k().saveToLocalStorage())},setMitarbeiterZuordnung:i=>{F.debug(" üë• Setting mitarbeiter zuordnung"),s({mitarbeiterZuordnung:i,isDirty:!0}),re(()=>k().saveToLocalStorage())},setAnmerkungen:i=>{s({anmerkungen:i,isDirty:!0}),re(()=>k().saveToLocalStorage())},setRaumbedarf:i=>{s({raumbedarf:i,isDirty:!0}),re(()=>k().saveToLocalStorage())},addWunschTag:i=>{F.debug(" üìÜ Adding wunsch tag"),s(g=>({wunschFreieTage:[...g.wunschFreieTage,i],isDirty:!0})),re(()=>k().saveToLocalStorage())},removeWunschTag:i=>{F.debug(" üóëÔ∏è Removing wunsch tag:",i),s(g=>({wunschFreieTage:g.wunschFreieTage.filter(p=>p.id!==i),isDirty:!0})),re(()=>k().saveToLocalStorage())},setPlanungId:i=>{F.debug(" üÜî Setting planung ID:",i),s({planungId:i})},setCurrentStep:i=>{F.debug(" üìç Setting current step:",i),s({currentStep:i})},nextStep:()=>{s(i=>({currentStep:i.currentStep+1}))},previousStep:()=>{s(i=>({currentStep:Math.max(0,i.currentStep-1)}))},setLoading:i=>{s({isLoading:i})},setError:i=>{F.error(" ‚ùå Error:",i),s({error:i})},saveToLocalStorage:()=>{try{const i=k();if(!i.isDirty)return;const g=Ze.getState().user;if(!g||!g.id){F.warn(" ‚ö† Cannot save - no user logged in");return}const p={userId:g.id,semesterId:i.semesterId,semester:i.semester,selectedModules:i.selectedModules,geplantModule:i.geplantModule,mitarbeiterZuordnung:Array.from(i.mitarbeiterZuordnung.entries()),anmerkungen:i.anmerkungen,raumbedarf:i.raumbedarf,wunschFreieTage:i.wunschFreieTage,planungId:i.planungId,currentStep:i.currentStep,savedAt:new Date().toISOString()},x=on();localStorage.setItem(x,JSON.stringify(p)),s({lastSaved:new Date,isDirty:!1}),F.debug(` üíæ Auto-saved to LocalStorage for user ${g.id}`)}catch(i){F.error(" ‚ùå Error saving to LocalStorage:",i)}},loadFromLocalStorage:()=>{try{const i=Ze.getState().user;if(!i||!i.id)return F.warn(" ‚ö† Cannot load - no user logged in"),!1;const g=on(),p=localStorage.getItem(g);if(!p)return F.debug(` ‚ÑπÔ∏è No saved data found for user ${i.id}`),!1;const x=JSON.parse(p);return x.userId&&x.userId!==i.id?(F.warn(` ‚ö† Data belongs to different user (${x.userId}), clearing...`),localStorage.removeItem(g),!1):(F.debug(` üìÇ Loading from LocalStorage for user ${i.id}...`),F.debug(" Saved at:",x.savedAt),s({semesterId:x.semesterId,semester:x.semester,selectedModules:x.selectedModules||[],geplantModule:x.geplantModule||[],mitarbeiterZuordnung:new Map(x.mitarbeiterZuordnung||[]),anmerkungen:x.anmerkungen||"",raumbedarf:x.raumbedarf||"",wunschFreieTage:x.wunschFreieTage||[],planungId:x.planungId,currentStep:x.currentStep||0,lastSaved:x.savedAt?new Date(x.savedAt):null,isDirty:!1}),F.debug("Data restored from LocalStorage"),!0)}catch(i){return F.error(" ‚ùå Error loading from LocalStorage:",i),!1}},clearLocalStorage:()=>{try{const i=on();localStorage.removeItem(i),F.debug(" üóëÔ∏è LocalStorage cleared for current user")}catch(i){F.error(" ‚ùå Error clearing LocalStorage:",i)}},markAsSaved:()=>{s({lastSaved:new Date,isDirty:!1})},markAsDirty:()=>{s({isDirty:!0})},resetWizard:()=>{F.debug(" üîÑ Resetting wizard"),k().clearLocalStorage(),s(yn)},getTotalSWS:()=>{const{geplantModule:i}=k();return i.reduce((g,p)=>{const D=p.sws_gesamt||(p.sws_vorlesung||0)+(p.sws_uebung||0)+(p.sws_praktikum||0)+(p.sws_seminar||0)||(p.anzahl_vorlesungen||0)*2+(p.anzahl_uebungen||0)*2+(p.anzahl_praktika||0)*2+(p.anzahl_seminare||0)*2;return g+D},0)},isStepValid:i=>{const g=k();switch(i){case 0:return g.semesterId!==null;case 1:return g.selectedModules.length>0;case 2:return g.geplantModule.length>0;case 3:return!0;case 4:return g.geplantModule.every(p=>p.sws_gesamt>0);case 5:return!0;case 6:return!0;case 7:return g.geplantModule.length>0&&g.getTotalSWS()>0;default:return!1}}}),{name:"PlanungStore"})),Y=Ve("WizardView"),Ie=[{label:"Semester ausw√§hlen",icon:"üìÖ",description:"W√§hlen Sie das Semester f√ºr Ihre Planung"},{label:"Module ausw√§hlen",icon:"üìö",description:"W√§hlen Sie die Module aus dem Katalog"},{label:"Module hinzuf√ºgen",icon:"‚ûï",description:"Konfigurieren Sie die Lehrformen und Multiplikatoren"},{label:"Mitarbeiter zuordnen",icon:"üë•",description:"Optional: Ordnen Sie Mitarbeiter zu"},{label:"Semesterauftr√§ge",icon:"üíº",description:"Optional: Auftr√§ge beantragen (z.B. Dekanin, Prodekan)"},{label:"Zus√§tzliche Infos",icon:"üìù",description:"Anmerkungen und Raumbedarf"},{label:"Wunsch-freie Tage",icon:"üìÜ",description:"Optional: W√ºnsche f√ºr freie Tage"},{label:"Zusammenfassung",icon:"‚úÖ",description:"√úberpr√ºfen und einreichen"}],Kr=()=>{const s=cr(),{id:k}=hr(),{user:i}=Ze(),g=cn(c=>c.showToast),{activePhase:p,submissionStatus:x,checkSubmissionStatus:D,canSubmit:O,recordNewSubmission:y}=fr(),{currentStep:T,planungId:n,semesterId:C,semester:L,selectedModules:q,geplantModule:V,mitarbeiterZuordnung:j,anmerkungen:a,raumbedarf:S,wunschFreieTage:E,isLoading:R,error:$,lastSaved:ne,setCurrentStep:J,nextStep:te,previousStep:X,setPlanungId:o,setLoading:v,setError:A,setWizardData:B,resetWizard:Z,getTotalSWS:t,loadFromLocalStorage:b,clearLocalStorage:z}=Wr(),[I,ee]=m.useState(!1),[se,ge]=m.useState([]),[me,h]=m.useState(!1),[f,u]=m.useState(null),[U,ae]=m.useState(!1),[ze,Rn]=m.useState(!1),[hn,Fn]=m.useState(!1);m.useEffect(()=>($n(),k?Zn(parseInt(k)):(Y.debug(" Starting new wizard"),b()&&g("Daten wiederhergestellt","info")),()=>{}),[k]);const $n=async()=>{try{if(await D(i?.id),!k&&!O()){let c=`Sie k√∂nnen derzeit keine neue Planung erstellen.
`;x?.grund==="keine_aktive_phase"?c+="Es ist keine aktive Planungsphase vorhanden.":x?.grund==="bereits_genehmigt"?c+="Sie haben bereits eine genehmigte Planung in dieser Phase.":x?.grund==="phase_abgelaufen"&&(c+="Die Deadline f√ºr diese Phase ist abgelaufen."),g(c,"warning")}}catch(c){Y.error("Error checking phase status:",c)}},Zn=async c=>{v(!0);try{Y.debug(" üì• Loading planung:",c);const w=await Se.getPlanung(c);if(w.success&&w.data){const K=w.data;Y.debug(" ‚úÖ Planung loaded:",K),B({planungId:K.id,semesterId:K.semester_id,semester:K.semester,geplantModule:K.geplante_module||[],wunschFreieTage:K.wunsch_freie_tage||[],anmerkungen:K.notizen||""}),o(K.id)}}catch(w){Y.error(" ‚ùå Error loading planung:",w),g(oe(w,"Fehler beim Laden der Planung"),"error"),A(oe(w))}finally{v(!1)}},rn=()=>{if(!L?.kuerzel)return"winter";const c=L.kuerzel.toLowerCase();return c.includes("ws")||c.includes("winter")?"winter":"sommer"},Gn=async()=>{if(L)try{const c=rn();Y.debug(" Loading template for:",c);const w=await an.getTemplateForSemester(c);w.success&&w.data?(u(w.data),Y.debug(" Template found:",w.data.name,"with",w.data.anzahl_module,"modules")):(u(null),Y.debug(" No template found for",c))}catch(c){Y.error(" Error loading template:",c),u(null)}};m.useEffect(()=>{L&&n&&!ze&&Gn()},[L,n]),m.useEffect(()=>{const c=V?.length||0;f&&!ze&&!hn&&c===0&&n&&(Y.debug("Showing template dialog immediately after phase load"),h(!0),Fn(!0))},[f,ze,hn,V,n]);const gn=c=>{const w=new Map;return c.forEach(K=>{K.mitarbeiter_ids&&K.mitarbeiter_ids.length>0&&w.set(K.modul_id,K.mitarbeiter_ids)}),w},tn=async(c=!1,w=!1)=>{if(!(!f||!n)){ae(!0);try{Y.debug(" Applying template:",f.id,"to planung:",n,"goToSummary:",w);const K=await an.applyToPlanung(f.id,n,c);if(K.success){const{hinzugefuegt:_e,uebersprungen:Oe}=K.data,ce=await Se.getPlanung(n);if(ce.success&&ce.data){const Ne=ce.data.geplante_module||[];B({geplantModule:Ne,wunschFreieTage:ce.data.wunsch_freie_tage||[],anmerkungen:ce.data.anmerkungen||ce.data.notizen||"",raumbedarf:ce.data.raumbedarf||"",mitarbeiterZuordnung:gn(Ne)}),Y.debug(" Template data loaded:",{moduleCount:Ne.length,wunschTageCount:ce.data.wunsch_freie_tage?.length||0,hasAnmerkungen:!!ce.data.anmerkungen,mitarbeiterCount:gn(Ne).size})}Rn(!0),h(!1);const pn=`${_e} Module`,jn=Oe>0?`, ${Oe} √ºbersprungen`:"",bn=f.wunsch_freie_tage?.length?`, ${f.wunsch_freie_tage.length} Wunsch-Tage`:"",fn=f.anmerkungen||f.raumbedarf?", Zusatzinfos":"";w?(J(7),g(`Schnellstart: ${pn}${jn}${bn}${fn} geladen. Pr√ºfen & einreichen!`,"success")):(te(),g(`Template angewendet: ${pn}${jn}${bn}${fn}`,"success"))}}catch(K){Y.error(" Error applying template:",K),g(oe(K,"Fehler beim Anwenden des Templates"),"error")}finally{ae(!1)}}},Kn=()=>{const c=[];return O()||(x?.grund==="keine_aktive_phase"?c.push("Es ist keine aktive Planungsphase vorhanden. Die Einreichung ist nicht m√∂glich."):x?.grund==="bereits_genehmigt"?c.push("Sie haben bereits eine genehmigte Planung in dieser Phase eingereicht."):x?.grund==="phase_abgelaufen"?c.push("Die Deadline f√ºr Einreichungen in dieser Phase ist abgelaufen."):c.push("Die Einreichung ist derzeit nicht m√∂glich.")),n||c.push("Planung wurde noch nicht erstellt. Bitte gehen Sie zur√ºck zu Schritt 1."),C||c.push("Kein Semester ausgew√§hlt."),(!V||V.length===0)&&c.push("Mindestens ein Modul muss zur Planung hinzugef√ºgt werden."),t()===0&&c.push("Die Gesamt-SWS muss gr√∂√üer als 0 sein."),{valid:c.length===0,errors:c}},Vn=async()=>{const c=Kn();if(!c.valid){ge(c.errors),ee(!0);return}if(window.confirm(`M√∂chten Sie die Planung wirklich einreichen?

Nach dem Einreichen k√∂nnen keine √Ñnderungen mehr vorgenommen werden.
Die Planung wird an den Dekan zur Pr√ºfung weitergeleitet.`)){v(!0);try{Y.debug(" üì§ Submitting planung:",n);const K=await Se.submitPlanung(n);if(K.success){if(p)try{await y(n),Y.debug(" üìä Submission recorded in phase system")}catch(_e){Y.error(" Error recording submission in phase:",_e)}g("Planung erfolgreich eingereicht","success"),z(),Y.debug(" üóëÔ∏è LocalStorage cleared after successful submit"),Z(),s("/semesterplanung")}else g(K.message||"Fehler beim Einreichen","error"),A(K.message||"Fehler beim Einreichen")}catch(K){Y.error(" ‚ùå Error submitting planung:",K),g(oe(K,"Fehler beim Einreichen der Planung"),"error"),A(oe(K))}finally{v(!1)}}},pe=c=>{Y.debug(" üíæ Step update:",Object.keys(c)),B(c)},je=()=>{Y.debug(" ‚û°Ô∏è Next step"),te()},On=c=>{const w={semesterId:C,semester:L,selectedModules:q,geplantModule:V,mitarbeiterZuordnung:j,anmerkungen:a,raumbedarf:S,wunschFreieTage:E,planungId:n};switch(c){case 0:return e.jsx(Sr,{data:w,onUpdate:pe,onNext:je,planungId:n??void 0,setPlanungId:o});case 1:return e.jsx(vr,{data:w,onUpdate:pe,onNext:je,onBack:X});case 2:return e.jsx(kr,{data:w,onUpdate:pe,onNext:je,onBack:X,planungId:n??void 0});case 3:return e.jsx(wr,{data:w,onUpdate:pe,onNext:je,onBack:X});case 4:return e.jsx(Mr,{data:w,onUpdate:pe,onNext:je,onBack:X,planungId:n??void 0});case 5:return e.jsx(Cr,{data:w,onUpdate:pe,onNext:je,onBack:X});case 6:return e.jsx(Ir,{data:w,onUpdate:pe,onNext:je,onBack:X,planungId:n??void 0});case 7:return e.jsx(Ar,{data:w,onBack:X,onSubmit:Vn,planungId:n??void 0,onGoToStep:J});default:return null}};if(R)return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:4,gap:2},children:[e.jsx(he,{size:48}),e.jsx(r,{children:"Lade Planung..."})]});const mn=(T+1)/Ie.length*100,xn=t(),ye=V?.length||0;return e.jsxs(sr,{maxWidth:"lg",children:[e.jsxs(N,{sx:{p:3,mb:3},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(l,{children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:k?"Semesterplanung bearbeiten":"Neue Semesterplanung"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[i?.name_komplett||i?.username," ‚Ä¢ ",Ie[T].description]})]}),n&&e.jsx(W,{severity:"success",sx:{py:.5,px:2},children:e.jsxs(r,{variant:"caption",children:["‚úÖ Planung ID: ",e.jsx("strong",{children:n})]})})]}),e.jsxs(l,{sx:{mt:2},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Schritt ",T+1," von ",Ie.length]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[mn.toFixed(0),"% abgeschlossen"]})]}),e.jsx(ar,{variant:"determinate",value:mn,sx:{height:8,borderRadius:1}})]}),e.jsxs(l,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1,display:"flex",gap:3,alignItems:"center",flexWrap:"wrap"},children:[(xn>0||ye>0)&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Module:"})," ",ye]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Gesamt SWS:"})," ",xn.toFixed(1)," SWS"]})]}),f&&n&&!ze&&T>=1&&e.jsx(l,{sx:{ml:"auto"},children:e.jsxs(P,{variant:"contained",color:"secondary",size:"medium",startIcon:rn()==="winter"?e.jsx(kn,{}):e.jsx(zn,{}),endIcon:e.jsx(vn,{}),onClick:()=>h(!0),disabled:U,sx:{animation:T===1?"pulse 2s infinite":"none","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(156, 39, 176, 0.4)"},"70%":{boxShadow:"0 0 0 10px rgba(156, 39, 176, 0)"},"100%":{boxShadow:"0 0 0 0 rgba(156, 39, 176, 0)"}}},children:["Schnellstart: ",f.anzahl_module," Module laden"]})}),ze&&e.jsxs(l,{sx:{ml:"auto",display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(M,{icon:e.jsx(Q,{}),label:"Template geladen",color:"success",size:"small",variant:"outlined"}),T<7&&e.jsx(P,{size:"small",variant:"contained",color:"success",onClick:()=>J(7),startIcon:e.jsx(Q,{}),children:"Direkt zur Zusammenfassung"}),e.jsx(P,{size:"small",variant:"text",onClick:()=>s("/templates"),children:"Templates verwalten"})]})]}),ze&&T>=1&&e.jsx(W,{severity:"success",sx:{mt:2},icon:e.jsx(Q,{}),children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Template-Daten geladen!"})," Alle importierten Daten (Module, Wunsch-Tage, Anmerkungen) k√∂nnen Sie in den folgenden Schritten frei bearbeiten, erg√§nzen oder l√∂schen."]})}),n&&ye===0&&T>=2&&e.jsx(W,{severity:"warning",sx:{mt:2},icon:e.jsx(Qe,{}),children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Achtung:"})," Sie haben noch keine Module zur Planung hinzugef√ºgt. Mindestens ein Modul ist erforderlich, um die Planung einzureichen."]})}),$&&e.jsx(W,{severity:"error",sx:{mt:2},onClose:()=>A(null),children:$}),ne&&e.jsx(W,{severity:"info",sx:{mt:2},children:e.jsxs(r,{variant:"caption",children:["üíæ Letzte Sicherung: ",new Date(ne).toLocaleTimeString("de-DE")]})})]}),e.jsxs(N,{sx:{p:3},children:[e.jsx(ir,{activeStep:T,orientation:"vertical",children:Ie.map((c,w)=>e.jsxs(lr,{children:[e.jsx(or,{optional:w===Ie.length-1?e.jsx(r,{variant:"caption",children:"Letzter Schritt"}):void 0,children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:c.icon}),e.jsx(r,{variant:"subtitle1",children:c.label})]})}),e.jsx(ur,{children:e.jsx(l,{sx:{my:2},children:On(w)})})]},c.label))}),T===Ie.length&&e.jsxs(N,{square:!0,elevation:0,sx:{p:3,bgcolor:"success.lighter"},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Q,{color:"success",sx:{fontSize:48}}),e.jsxs(l,{children:[e.jsx(r,{variant:"h6",children:"Planung erfolgreich eingereicht!"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Ihre Semesterplanung wurde zur Pr√ºfung an den Dekan weitergeleitet."})]})]}),e.jsx(P,{variant:"contained",onClick:()=>s("/semesterplanung"),sx:{mt:2},children:"Zur √úbersicht"})]})]}),e.jsxs(Be,{open:I,onClose:()=>ee(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Re,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qe,{color:"warning"}),e.jsx(r,{variant:"h6",children:"Planung kann nicht eingereicht werden"})]})}),e.jsxs(Fe,{children:[e.jsx(r,{variant:"body2",paragraph:!0,children:"Bitte beheben Sie folgende Probleme, bevor Sie die Planung einreichen:"}),e.jsx(en,{dense:!0,children:se.map((c,w)=>e.jsx(nn,{sx:{pl:0},children:e.jsx(Ke,{primary:`${w+1}. ${c}`,primaryTypographyProps:{variant:"body2",color:"error"}})},w))})]}),e.jsx($e,{children:e.jsx(P,{onClick:()=>ee(!1),color:"primary",children:"Verstanden"})})]}),e.jsxs(Be,{open:me,onClose:()=>h(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Re,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[rn()==="winter"?e.jsx(kn,{color:"primary"}):e.jsx(zn,{sx:{color:"orange"}}),e.jsx(r,{variant:"h6",children:"Template laden - Schnellstart"})]})}),e.jsx(Fe,{children:f&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{severity:"success",sx:{mb:2},children:[e.jsx(r,{variant:"body2",children:e.jsx("strong",{children:f.name||an.formatSemesterTyp(f.semester_typ)})}),e.jsx(r,{variant:"body2",children:"Mit einem Klick werden alle gespeicherten Einstellungen geladen. Sie koennen danach alles noch anpassen."})]}),f.beschreibung&&e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:f.beschreibung}),e.jsxs(l,{sx:{bgcolor:"background.default",p:2,borderRadius:1,mb:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Template enthaelt:"}),e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsx(M,{icon:e.jsx(Q,{}),label:`${f.anzahl_module} Module`,color:"primary",variant:"outlined"}),f.wunsch_freie_tage&&f.wunsch_freie_tage.length>0&&e.jsx(M,{icon:e.jsx(Q,{}),label:`${f.wunsch_freie_tage.length} Wunsch-Tage`,color:"primary",variant:"outlined"}),f.anmerkungen&&e.jsx(M,{icon:e.jsx(Q,{}),label:"Anmerkungen",color:"primary",variant:"outlined"}),f.raumbedarf&&e.jsx(M,{icon:e.jsx(Q,{}),label:"Raumbedarf",color:"primary",variant:"outlined"})]})]}),f.template_module&&f.template_module.length>0&&e.jsxs(l,{sx:{mb:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Module mit Konfiguration:"}),e.jsx(l,{sx:{maxHeight:200,overflowY:"auto",bgcolor:"grey.50",p:1,borderRadius:1},children:f.template_module.map(c=>{const w=[];c.anzahl_vorlesungen>0&&w.push(`${c.anzahl_vorlesungen}V`),c.anzahl_uebungen>0&&w.push(`${c.anzahl_uebungen}Ue`),c.anzahl_praktika>0&&w.push(`${c.anzahl_praktika}P`),c.anzahl_seminare>0&&w.push(`${c.anzahl_seminare}S`);const K=w.join("+")||"-",_e=c.mitarbeiter_ids?.length||0,Oe=c.raum_vorlesung||c.raum_uebung||c.raum_praktikum||c.raum_seminar;return e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,py:.5,borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"}},children:[e.jsx(M,{label:c.modul?.kuerzel||`Modul ${c.modul_id}`,size:"small",color:"primary"}),e.jsx(r,{variant:"body2",sx:{flex:1},children:c.modul?.bezeichnung_de||""}),e.jsx(r,{variant:"caption",color:"text.secondary",children:K}),_e>0&&e.jsx(M,{label:`${_e} MA`,size:"small",variant:"outlined"}),Oe&&e.jsx(M,{label:"Raum",size:"small",variant:"outlined",color:"success"})]},c.id)})})]}),f.wunsch_freie_tage&&f.wunsch_freie_tage.length>0&&e.jsxs(l,{sx:{mb:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Wunsch-freie Tage:"}),e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.wunsch_freie_tage.map((c,w)=>e.jsx(M,{label:`${c.wochentag} (${c.zeitraum})`,size:"small",variant:"outlined",color:c.prioritaet==="hoch"?"error":c.prioritaet==="mittel"?"warning":"default"},w))})]}),ye>0&&e.jsx(W,{severity:"warning",sx:{mb:2},children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Hinweis:"})," Sie haben bereits ",ye," Module in der Planung. Bestehende Module werden nicht geloescht, nur neue werden hinzugefuegt."]})})]})}),e.jsxs($e,{sx:{p:2,gap:1,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx(P,{onClick:()=>h(!1),disabled:U,children:"Manuell eingeben"}),e.jsxs(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[ye>0&&e.jsx(P,{variant:"outlined",color:"warning",onClick:()=>tn(!0,!1),disabled:U,size:"small",children:"Alles ersetzen"}),e.jsx(P,{variant:"outlined",onClick:()=>tn(!1,!1),disabled:U,startIcon:U?e.jsx(he,{size:16}):e.jsx(vn,{}),children:U?"Lade...":"Laden & Bearbeiten"}),e.jsx(P,{variant:"contained",color:"success",size:"large",onClick:()=>tn(!1,!0),disabled:U,startIcon:U?e.jsx(he,{size:16}):e.jsx(Q,{}),children:U?"Lade...":"Schnellstart"})]})]})]}),e.jsx(l,{sx:{mt:2,textAlign:"center"},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:"üíæ Ihre √Ñnderungen werden automatisch gespeichert"})})]})};export{Kr as default};
