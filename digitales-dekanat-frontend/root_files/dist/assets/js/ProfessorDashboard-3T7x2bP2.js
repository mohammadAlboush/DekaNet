import{j as e,aD as te,aE as ae,B as t,f as r,aF as ie,z as le,H as u,P as g,$ as a,aT as ce,L as Z,g as X,a4 as z,am as K,D as Y,aH as oe,K as j,ab as c,aU as q,aV as de,a2 as D,N as he,aW as N,a6 as xe,a0 as W,a1 as B,aX as ue,av as L,s as F,aY as G,ak as A,R as U,aR as ge,k as me,aZ as je,I as pe,ap as be}from"./vendor-mui-BiVZR0IW.js";import{r as m,b as J,u as fe}from"./vendor-react-CBtCGaWm.js";import{a as ye,c as O,g as ve,l as p,u as Se}from"./index-BXi_OX1m.js";import{p as V}from"./planungService-BVn8qP8e.js";import{s as Pe}from"./semesterService-CD_2IOE9.js";import{u as we}from"./planungPhaseStore-CqQvbFGd.js";import{c as b}from"./vendor-utils-DTv3oRQQ.js";import"./planungPhaseService-BG7zO8Dx.js";const ke=O("ProfessorPhasenHistorie"),ze=({open:h,onClose:S})=>{const[o,d]=m.useState(!1),[C,P]=m.useState(null),[l,w]=m.useState(null);m.useEffect(()=>{h&&E()},[h]);const E=async()=>{d(!0),P(null);try{const s=await ye.get("/planung/professor/phasen-historie");s.data?.success?w(s.data.data):P("Fehler beim Laden der Historie")}catch(s){ke.error(" Fehler:",{err:s}),P(ve(s,"Fehler beim Laden der Historie"))}finally{d(!1)}},M=s=>{if(!s.hat_planung)return e.jsx(c,{label:"Keine Einreichung",size:"small",icon:e.jsx(q,{})});switch(s.status){case"freigegeben":return e.jsx(c,{label:"Freigegeben",size:"small",color:"success",icon:e.jsx(z,{})});case"abgelehnt":return e.jsx(c,{label:"Abgelehnt",size:"small",color:"error",icon:e.jsx(K,{})});case"eingereicht":return e.jsx(c,{label:"Eingereicht",size:"small",color:"warning",icon:e.jsx(D,{})});case"entwurf":return e.jsx(c,{label:"Entwurf",size:"small",color:"default",icon:e.jsx(de,{})});default:return e.jsx(c,{label:"Unbekannt",size:"small"})}},f=s=>s.ist_aktiv?e.jsx(c,{label:"Aktiv",color:"primary",size:"small"}):s.geschlossen_am?e.jsx(c,{label:"Geschlossen",color:"default",size:"small"}):null;return e.jsxs(te,{open:h,onClose:S,maxWidth:"lg",fullWidth:!0,children:[e.jsx(ae,{children:e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",children:"Meine Planungshistorie"}),l&&e.jsxs(r,{variant:"caption",color:"textSecondary",children:[l.semester.bezeichnung," • ",l.phasen_mit_planung," von ",l.gesamt_phasen," Phasen mit Planung"]})]})}),e.jsx(ie,{dividers:!0,children:o?e.jsx(t,{display:"flex",justifyContent:"center",p:3,children:e.jsx(le,{})}):C?e.jsx(u,{severity:"error",children:C}):!l||l.phasen.length===0?e.jsx(u,{severity:"info",children:"Keine Planungshistorie verfügbar"}):e.jsxs(t,{children:[e.jsx(g,{sx:{p:2,mb:3,bgcolor:"primary.50"},children:e.jsxs(a,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(a,{item:!0,children:e.jsx(ce,{color:"primary"})}),e.jsxs(a,{item:!0,xs:!0,children:[e.jsx(r,{variant:"h6",children:l.semester.bezeichnung}),e.jsx(r,{variant:"caption",color:"textSecondary",children:l.semester.kuerzel})]}),e.jsx(a,{item:!0,children:e.jsxs(t,{textAlign:"center",children:[e.jsxs(r,{variant:"h4",color:"primary",children:[l.phasen_mit_planung,"/",l.gesamt_phasen]}),e.jsx(r,{variant:"caption",color:"textSecondary",children:"Eingereicht"})]})})]})}),e.jsx(Z,{children:l.phasen.map((s,y)=>e.jsxs(J.Fragment,{children:[e.jsxs(X,{sx:{flexDirection:"column",alignItems:"stretch",py:2,bgcolor:s.phase.ist_aktiv?"action.selected":"transparent",borderLeft:s.phase.ist_aktiv?4:0,borderColor:"primary.main"},children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(r,{variant:"h6",children:s.phase.name}),f(s.phase)]}),M(s)]}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,md:4,children:e.jsxs(g,{variant:"outlined",sx:{p:1.5},children:[e.jsx(r,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:"Zeitraum"}),e.jsxs(r,{variant:"body2",children:[s.phase.startdatum?b(new Date(s.phase.startdatum),"dd.MM.yyyy",{locale:p}):"-"," - ",s.phase.enddatum?b(new Date(s.phase.enddatum),"dd.MM.yyyy",{locale:p}):"-"]})]})}),s.hat_planung&&s.planung&&e.jsxs(e.Fragment,{children:[e.jsx(a,{item:!0,xs:12,md:4,children:e.jsxs(g,{variant:"outlined",sx:{p:1.5},children:[e.jsx(r,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:"Eingereicht"}),e.jsx(r,{variant:"body2",children:s.eingereicht_am?b(new Date(s.eingereicht_am),"dd.MM.yyyy HH:mm",{locale:p}):"Nicht eingereicht"})]})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsxs(g,{variant:"outlined",sx:{p:1.5},children:[e.jsx(r,{variant:"caption",color:"textSecondary",display:"block",gutterBottom:!0,children:"Module / SWS"}),e.jsxs(r,{variant:"body2",children:[s.module_anzahl," Module • ",s.planung.gesamt_sws," SWS"]})]})})]})]}),s.hat_planung&&s.planung&&e.jsxs(t,{mt:2,children:[s.planung.freigegeben_am&&e.jsxs(u,{severity:"success",icon:e.jsx(z,{}),sx:{mb:1},children:["Freigegeben am"," ",b(new Date(s.planung.freigegeben_am),"dd.MM.yyyy HH:mm",{locale:p})]}),s.planung.abgelehnt_am&&e.jsxs(u,{severity:"error",icon:e.jsx(K,{}),children:[e.jsxs(r,{variant:"body2",gutterBottom:!0,children:["Abgelehnt am"," ",b(new Date(s.planung.abgelehnt_am),"dd.MM.yyyy HH:mm",{locale:p})]}),s.planung.ablehnungsgrund&&e.jsxs(r,{variant:"caption",color:"textSecondary",children:["Grund: ",s.planung.ablehnungsgrund]})]})]}),!s.hat_planung&&e.jsx(u,{severity:"info",sx:{mt:2},children:"Keine Planung für diese Phase eingereicht"})]}),y<l.phasen.length-1&&e.jsx(Y,{})]},s.phase.id))})]})}),e.jsx(oe,{children:e.jsx(j,{onClick:S,children:"Schließen"})})]})},_=O("ProfessorDashboard"),We=()=>{const h=fe(),{user:S}=Se(),{activePhase:o,submissionStatus:d,fetchActivePhase:C,checkSubmissionStatus:P,canSubmit:l,getTimeRemaining:w,hasSubmittedInCurrentPhase:E}=we(),[M,f]=m.useState(!1),[s,y]=m.useState([]),[v,Q]=m.useState(null),[ee,H]=m.useState(!1);m.useEffect(()=>{ne(),se()},[]);const se=async()=>{try{await C(),await P()}catch(n){_.error("Error loading phase data:",n)}},ne=async()=>{f(!0);try{const n=await Pe.getPlanningSemester();n.success&&n.data&&Q(n.data);const x=await V.getMeinePlanungen();x.success&&x.data?Array.isArray(x.data)?y(x.data):(_.warn("API returned non-array data for planungen:",x.data),y([])):y([])}catch(n){_.error("Error loading dashboard:",n),y([])}finally{f(!1)}},$=async()=>{if(!v){alert("Keine Planungsphase aktiv!");return}if(!l()){let n="Sie können derzeit keine neue Planung erstellen. ";d?.grund==="keine_aktive_phase"?n+="Es ist keine aktive Planungsphase vorhanden.":d?.grund==="bereits_genehmigt"?n+="Sie haben bereits eine genehmigte Planung in dieser Phase.":d?.grund==="phase_abgelaufen"&&(n+="Die Deadline für diese Phase ist abgelaufen."),alert(n);return}try{f(!0);const n=await V.createPlanung({semester_id:v.id,notizen:""});n.success&&n.data?h(`/semesterplanung/${n.data.id}/edit`):alert("Fehler beim Erstellen der Planung")}catch(n){_.error("Error creating planung:",n),alert("Fehler beim Erstellen der Planung")}finally{f(!1)}},re=n=>{if(!n)return"Keine Deadline";const x=Math.floor(n/1440),k=Math.floor(n%1440/60);return x>0?`${x} Tage, ${k} Stunden`:k>0?`${k} Stunden verbleibend`:`${n} Minuten verbleibend`},R=n=>{switch(n){case"freigegeben":return"success";case"eingereicht":return"warning";case"abgelehnt":return"error";default:return"default"}},T=n=>{switch(n){case"freigegeben":return e.jsx(z,{fontSize:"small"});case"eingereicht":return e.jsx(D,{fontSize:"small"});case"abgelehnt":return e.jsx(be,{fontSize:"small"});default:return e.jsx(A,{fontSize:"small"})}},I={gesamt:Array.isArray(s)?s.length:0,entwurf:Array.isArray(s)?s.filter(n=>n.status==="entwurf").length:0,eingereicht:Array.isArray(s)?s.filter(n=>n.status==="eingereicht").length:0,freigegeben:Array.isArray(s)?s.filter(n=>n.status==="freigegeben").length:0,abgelehnt:Array.isArray(s)?s.filter(n=>n.status==="abgelehnt").length:0},i=Array.isArray(s)&&o?s.find(n=>n.planungsphase_id===o.id):void 0;return e.jsxs(he,{maxWidth:"xl",children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:4},children:[e.jsxs(t,{children:[e.jsxs(r,{variant:"h4",fontWeight:600,gutterBottom:!0,children:["Willkommen zurück, ",S?.vorname||S?.username,"!"]}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Hier ist eine Übersicht Ihrer Semesterplanungen"})]}),e.jsx(j,{variant:"outlined",size:"large",startIcon:e.jsx(N,{}),onClick:()=>H(!0),sx:{minWidth:180},children:"Phasen-Historie"})]}),M&&e.jsx(xe,{sx:{mb:3}}),o?e.jsx(W,{sx:{mb:3,bgcolor:"background.paper",border:1,borderColor:"primary.main"},children:e.jsxs(B,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(D,{color:"primary"}),e.jsxs(r,{variant:"h6",children:["Aktuelle Planungsphase: ",o.name]})]}),e.jsx(j,{variant:"outlined",size:"small",startIcon:e.jsx(N,{}),onClick:()=>H(!0),children:"Historie"})]}),e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Phase gestartet"}),e.jsx(r,{variant:"body2",children:o.startdatum?b(new Date(o.startdatum),"dd.MM.yyyy",{locale:p}):"-"})]}),o.enddatum&&e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Deadline"}),e.jsx(r,{variant:"body2",children:o.enddatum?b(new Date(o.enddatum),"dd.MM.yyyy HH:mm",{locale:p}):"-"})]}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Verbleibende Zeit"}),e.jsxs(r,{variant:"body2",color:w()&&w()<1440?"error":"textPrimary",children:[e.jsx(ue,{sx:{fontSize:16,mr:.5,verticalAlign:"middle"}}),re(w())]})]}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Ihr Status"}),e.jsx(t,{children:E()?e.jsx(c,{label:"Bereits eingereicht",color:"success",size:"small",icon:e.jsx(z,{})}):l()?e.jsx(c,{label:"Einreichung möglich",color:"primary",size:"small"}):e.jsx(c,{label:"Einreichung nicht möglich",color:"error",size:"small",icon:e.jsx(q,{})})})]})]}),d&&e.jsx(t,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:d.kann_einreichen?e.jsxs(u,{severity:"success",children:[e.jsx(L,{children:"Sie können eine Planung einreichen"}),i?e.jsxs(r,{variant:"body2",children:["Sie haben eine Planung mit Status: ",i.status]}):e.jsx(r,{variant:"body2",children:"Erstellen Sie jetzt Ihre Semesterplanung"})]}):e.jsxs(u,{severity:"warning",children:[e.jsx(L,{children:"Einreichung nicht möglich"}),e.jsxs(r,{variant:"body2",children:[d.grund==="bereits_genehmigt"&&"Sie haben bereits eine genehmigte Planung in dieser Phase.",d.grund==="phase_abgelaufen"&&"Die Deadline für Einreichungen ist abgelaufen.",d.grund==="keine_aktive_phase"&&"Es ist keine aktive Phase vorhanden."]})]})})]})}):e.jsxs(u,{severity:"warning",sx:{mb:3},children:[e.jsx(L,{children:"Keine aktive Planungsphase"}),e.jsx(r,{variant:"body2",children:"Derzeit ist keine Planungsphase aktiv. Bitte warten Sie, bis der Dekan die nächste Phase startet."})]}),v&&!i&&e.jsx(W,{sx:{mb:3,bgcolor:"primary.lighter",borderLeft:4,borderColor:"primary.main"},children:e.jsx(B,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(F,{color:"primary",sx:{fontSize:48}}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Erstellen Sie Ihre Semesterplanung"}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Die Planungsphase für ",v.bezeichnung," ist geöffnet. Erstellen Sie jetzt Ihre Planung in 8 einfachen Schritten."]})]}),e.jsx(j,{variant:"contained",size:"large",startIcon:e.jsx(G,{}),onClick:$,sx:{minWidth:180},children:"Neue Planung"})]})})}),i&&e.jsx(W,{sx:{mb:3,borderLeft:4,borderColor:"primary.main"},children:e.jsxs(B,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:2},children:[e.jsxs(t,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Aktuelle Planung: ",v?.bezeichnung]}),e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(c,{label:i.status,color:R(i.status),size:"small",icon:T(i.status)}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["• ",i.gesamt_sws||0," SWS geplant"]})]})]}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[i.status==="entwurf"&&e.jsx(j,{variant:"contained",startIcon:e.jsx(A,{}),onClick:()=>h(`/semesterplanung/${i.id}/edit`),children:"Bearbeiten"}),i.status!=="entwurf"&&e.jsx(j,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:()=>h(`/semesterplanung/${i.id}`),children:"Ansehen"})]})]}),i.notizen&&e.jsx(t,{sx:{mt:2,p:2,bgcolor:"background.default",borderRadius:1},children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Notizen: ",i.notizen]})}),i.status==="abgelehnt"&&i.ablehnungsgrund&&e.jsxs(u,{severity:"error",sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Ablehnungsgrund:"}),e.jsx(r,{variant:"body2",children:i.ablehnungsgrund})]})]})}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{sx:{p:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(r,{variant:"h4",fontWeight:600,children:I.gesamt}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Gesamt"})]}),e.jsx(F,{color:"primary",sx:{fontSize:40}})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{sx:{p:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(r,{variant:"h4",fontWeight:600,children:I.entwurf}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Entwürfe"})]}),e.jsx(A,{color:"action",sx:{fontSize:40}})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{sx:{p:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(r,{variant:"h4",fontWeight:600,color:"warning.main",children:I.eingereicht}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Eingereicht"})]}),e.jsx(D,{color:"warning",sx:{fontSize:40}})]})})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{sx:{p:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(r,{variant:"h4",fontWeight:600,color:"success.main",children:I.freigegeben}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Freigegeben"})]}),e.jsx(z,{color:"success",sx:{fontSize:40}})]})})})]}),e.jsxs(g,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(r,{variant:"h6",fontWeight:600,children:"Meine Planungen"}),e.jsx(j,{variant:"outlined",onClick:()=>h("/semesterplanung"),endIcon:e.jsx(ge,{}),children:"Alle anzeigen"})]}),Array.isArray(s)&&s.length>0?e.jsx(Z,{children:s.slice(0,5).map((n,x)=>e.jsxs(J.Fragment,{children:[x>0&&e.jsx(Y,{}),e.jsxs(X,{sx:{"&:hover":{bgcolor:"action.hover"},cursor:"pointer"},onClick:()=>h(`/semesterplanung/${n.id}`),children:[e.jsx(me,{primary:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"subtitle1",children:n.semester?.bezeichnung||"Unbekanntes Semester"}),e.jsx(c,{label:n.status,size:"small",color:R(n.status),icon:T(n.status)})]}),secondary:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[n.gesamt_sws||0," SWS • Erstellt am"," ",n.created_at?new Date(n.created_at).toLocaleDateString("de-DE"):"unbekannt"]})}),e.jsx(je,{children:e.jsx(pe,{edge:"end",onClick:k=>{k.stopPropagation(),h(`/semesterplanung/${n.id}`)},children:n.status==="entwurf"?e.jsx(A,{}):e.jsx(U,{})})})]})]},n.id))}):e.jsxs(t,{sx:{textAlign:"center",py:4},children:[e.jsx(F,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(r,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Noch keine Planungen erstellt"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Erstellen Sie Ihre erste Semesterplanung"}),v&&e.jsx(j,{variant:"contained",startIcon:e.jsx(G,{}),onClick:$,children:"Neue Planung erstellen"})]})]}),e.jsx(ze,{open:ee,onClose:()=>H(!1)})]})};export{We as default};
