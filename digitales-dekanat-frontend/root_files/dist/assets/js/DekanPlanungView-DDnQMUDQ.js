import{j as e,a0 as Ze,bk as _s,B as u,f as r,ab as m,a4 as $e,am as we,a1 as Je,H as C,av as Fe,P as T,$ as x,a6 as Ye,K as y,bl as ds,ak as Ss,bm as ns,a3 as qe,bn as hs,a7 as us,a8 as ae,bo as xs,bp as ws,aW as ms,bq as Qe,z as Xe,L as ze,g as ye,k as _e,aD as Z,aE as J,aF as Y,aw as Le,ax as He,az as Oe,o as ie,Z as Te,br as rs,aH as le,a$ as ks,b7 as Cs,O as es,bs as he,bt as ue,bu as ss,bv as xe,bw as me,c as k,bx as ge,by as je,bz as pe,bA as Ps,G as zs,a5 as Ts,a9 as Ge,aa as Ke,ad as Ue,bB as As,aX as Ds,w as Ae,i as Ms,s as $s,an as De,bC as Rs,a2 as Ws,ay as Es,bD as Fs,Q as Is,aL as is,bE as as,ao as Bs,ac as Ve,ae as gs,af as js,ag as ps,ah as Se,ai as p,aj as fs,l as $,I as q,R as bs,bF as Ie,N as Ns,bj as qs,S as Ls,aM as Hs,bG as ls,a_ as os,b8 as ne,D as Os}from"./vendor-mui-BiVZR0IW.js";import{r as d,u as Gs,j as Ks,b as Us}from"./vendor-react-CBtCGaWm.js";import{p as Be}from"./planungService-CoVGOVAB.js";import{s as Vs}from"./semesterService-CfIHzVdr.js";import{d as Zs}from"./dozentService-DoNU8l0w.js";import{l as A,A as Me,c as Re,u as vs,b as Js,g as cs}from"./index-ChymPdOX.js";import{u as We}from"./planungPhaseStore-D_yYLaUh.js";import{c as G,j as Ys}from"./vendor-utils-DTv3oRQQ.js";import"./planungPhaseService-9n5IcayC.js";const Ne=Re("PlanungsphasenManager");function Pe(t){const{children:i,value:o,index:h,...g}=t;return e.jsx("div",{role:"tabpanel",hidden:o!==h,id:`phase-tabpanel-${h}`,"aria-labelledby":`phase-tab-${h}`,...g,children:o===h&&e.jsx(u,{sx:{p:3},children:i})})}const Qs=()=>{const{activePhase:t,currentPhaseStatistics:i,phaseSubmissions:o,loading:h,error:g,getTimeRemaining:f,fetchActivePhase:j,startNewPhase:b,closeCurrentPhase:w,fetchPhaseSubmissions:P,fetchPhaseStatistics:K,sendRemindersToProfs:R,clearError:Q}=We(),[S,U]=d.useState(0),[W,D]=d.useState(!1),[E,L]=d.useState(!1),[X,l]=d.useState(!1),[M,F]=d.useState(!1),[v,ee]=d.useState(""),[H,V]=d.useState(new Date().getFullYear()),[se,I]=d.useState(new Date),[z,te]=d.useState(null),O=new Date().getFullYear(),ke=()=>{if(!v)return"";const a=v==="wintersemester"?"Wintersemester":"Sommersemester",N=v==="wintersemester"?`${H}/${H+1}`:`${H}`;return`${a} ${N} - Planungsphase`},[fe,be]=d.useState(!1),[ve,ce]=d.useState("");d.useEffect(()=>{let a=!0;return(async()=>{a&&await j()})(),()=>{a=!1}},[]),d.useEffect(()=>{let a=!0;return(async()=>{t&&t.id&&a&&(await P(t.id),await K(t.id))})(),()=>{a=!1}},[t]),d.useEffect(()=>{if(W&&!v){const a=new Date().getMonth(),N=a>=3&&a<=8?"sommersemester":"wintersemester";ee(N)}},[W]);const de=async()=>{if(!v||!H||!se||!z){alert("Bitte füllen Sie alle Pflichtfelder aus.");return}try{await b({semester_typ:v,semester_jahr:H,startdatum:se.toISOString(),enddatum:z.toISOString()}),D(!1),ee(""),V(new Date().getFullYear()),I(new Date),te(null),j()}catch(a){Ne.error("Fehler beim Starten der Phase:",a)}},B=async()=>{if(!t||!t.id){alert("Keine aktive Phase zum Schließen gefunden.");return}try{await w(fe,ve),L(!1),be(!1),ce(""),j()}catch(a){Ne.error("Fehler beim Schließen der Phase:",a),alert("Fehler beim Schließen der Phase. Bitte versuchen Sie es erneut.")}},s=async()=>{if(t)try{await R(t.id),F(!1),alert("Erinnerungen wurden erfolgreich versendet.")}catch(a){Ne.error("Fehler beim Senden der Erinnerungen:",a)}},n=()=>{if(!t||!t.ist_aktiv)return"default";const a=f();return a?a<1440?"error":a<4320?"warning":"success":"success"},c=a=>{if(!a)return"Keine Deadline";const N=Math.floor(a/1440),Ee=Math.floor(a%1440/60),ts=a%60;return N>0?`${N} Tage, ${Ee} Stunden`:Ee>0?`${Ee} Stunden, ${ts} Minuten`:`${ts} Minuten`},_=()=>i?i.professoren_eingereicht/i.professoren_gesamt*100:0;return e.jsxs(Ze,{children:[e.jsx(_s,{title:e.jsxs(u,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(r,{variant:"h5",children:"Planungsphasen-Verwaltung"}),t&&e.jsx(m,{label:t.ist_aktiv?"Phase Aktiv":"Phase Geschlossen",color:t.ist_aktiv?"success":"default",icon:t.ist_aktiv?e.jsx($e,{}):e.jsx(we,{})})]})}),e.jsxs(Je,{children:[g&&e.jsxs(C,{severity:"error",onClose:Q,sx:{mb:2},children:[e.jsx(Fe,{children:"Fehler"}),g]}),t?e.jsxs(T,{elevation:2,sx:{p:3,mb:3},children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Aktuelle Phase: ",t.name]}),e.jsxs(x,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(u,{children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Gestartet am"}),e.jsx(r,{variant:"body2",children:t.startdatum?G(new Date(t.startdatum),"dd.MM.yyyy HH:mm",{locale:A}):"-"})]})}),t.enddatum&&e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(u,{children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Deadline"}),e.jsx(r,{variant:"body2",children:t.enddatum?G(new Date(t.enddatum),"dd.MM.yyyy HH:mm",{locale:A}):"-"})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(u,{children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Verbleibende Zeit"}),e.jsx(r,{variant:"body2",color:n(),children:c(f())})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(u,{children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Status"}),e.jsxs(r,{variant:"body2",children:[t.anzahl_einreichungen," Einreichungen (",t.anzahl_genehmigt," genehmigt, ",t.anzahl_abgelehnt," abgelehnt)"]})]})})]}),i&&e.jsxs(u,{sx:{mt:3},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:["Fortschritt: ",i.professoren_eingereicht," von ",i.professoren_gesamt," Professoren"]}),e.jsx(Ye,{variant:"determinate",value:_(),sx:{mt:1,height:10,borderRadius:1}})]}),e.jsxs(u,{sx:{mt:3,display:"flex",gap:2},children:[e.jsx(y,{variant:"outlined",color:"warning",startIcon:e.jsx(ds,{}),onClick:()=>L(!0),children:"Phase Beenden"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(Ss,{}),onClick:()=>l(!0),children:"Phase Bearbeiten"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(ns,{}),onClick:()=>F(!0),children:"Erinnerungen Senden"}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(qe,{}),onClick:()=>K(t.id),children:"Statistiken Aktualisieren"})]})]}):e.jsxs(C,{severity:"info",sx:{mb:3},children:[e.jsx(Fe,{children:"Keine aktive Planungsphase"}),"Es ist derzeit keine Planungsphase aktiv. Starten Sie eine neue Phase, damit Professoren ihre Planungen einreichen können.",e.jsx(u,{sx:{mt:2},children:e.jsx(y,{variant:"contained",color:"primary",startIcon:e.jsx(hs,{}),onClick:()=>D(!0),children:"Neue Phase Starten"})})]}),e.jsx(u,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(us,{value:S,onChange:(a,N)=>U(N),children:[e.jsx(ae,{label:"Aktuelle Einreichungen",icon:e.jsx(xs,{badgeContent:o.length,color:"primary",children:e.jsx(ws,{})})}),e.jsx(ae,{label:"Statistiken",icon:e.jsx(qe,{})}),e.jsx(ae,{label:"Historie",icon:e.jsx(ms,{})}),e.jsx(ae,{label:"Archiv",icon:e.jsx(Qe,{})})]})}),e.jsx(Pe,{value:S,index:0,children:h?e.jsx(Xe,{}):e.jsxs(ze,{children:[o.map(a=>e.jsx(ye,{children:e.jsx(_e,{primary:`Professor ID: ${a.professor_id}`,secondary:e.jsxs(u,{children:[e.jsxs(r,{variant:"body2",component:"span",children:["Eingereicht: ",a.eingereicht_am?G(new Date(a.eingereicht_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"]}),e.jsx(m,{size:"small",label:a.status,color:a.status==="freigegeben"?"success":a.status==="abgelehnt"?"error":"default",sx:{ml:1}})]})})},a.id||`${a.professor_id}-${a.planung_id}`)),o.length===0&&e.jsx(r,{variant:"body2",color:"textSecondary",align:"center",children:"Noch keine Einreichungen in dieser Phase"})]})}),e.jsx(Pe,{value:S,index:1,children:i?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"h6",children:[(Number(i.einreichungsquote)||0).toFixed(1),"%"]}),e.jsx(r,{variant:"caption",children:"Einreichungsquote"})]})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"h6",children:[(Number(i.genehmigungsquote)||0).toFixed(1),"%"]}),e.jsx(r,{variant:"caption",children:"Genehmigungsquote"})]})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"h6",children:[(Number(i.durchschnittliche_bearbeitungszeit)||0).toFixed(1),"h"]}),e.jsx(r,{variant:"caption",children:"Ø Bearbeitungszeit"})]})}),i.top_module.length>0&&e.jsxs(x,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Top Module"}),e.jsx(ze,{children:i.top_module.map((a,N)=>e.jsx(ye,{children:e.jsx(_e,{primary:a.modul_name,secondary:`${a.anzahl} mal geplant`})},N))})]})]}):e.jsx(r,{variant:"body2",color:"textSecondary",align:"center",children:"Keine Statistiken verfügbar"})}),e.jsx(Pe,{value:S,index:2,children:e.jsx(r,{variant:"body2",color:"textSecondary",align:"center",children:"Phasenhistorie wird geladen..."})}),e.jsx(Pe,{value:S,index:3,children:e.jsx(r,{variant:"body2",color:"textSecondary",align:"center",children:"Archiv wird geladen..."})}),e.jsxs(Z,{open:W,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Neue Planungsphase Starten"}),e.jsx(Y,{children:e.jsxs(u,{sx:{mt:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(Le,{fullWidth:!0,required:!0,children:[e.jsx(He,{children:"Semester-Typ"}),e.jsxs(Oe,{value:v,onChange:a=>ee(a.target.value),label:"Semester-Typ",children:[e.jsx(ie,{value:"wintersemester",children:"Wintersemester"}),e.jsx(ie,{value:"sommersemester",children:"Sommersemester"})]})]}),e.jsxs(Le,{fullWidth:!0,required:!0,children:[e.jsx(He,{children:"Jahr"}),e.jsx(Oe,{value:H,onChange:a=>V(a.target.value),label:"Jahr",children:[O-1,O,O+1,O+2].map(a=>e.jsx(ie,{value:a,children:a},a))})]}),v&&e.jsx(C,{severity:"info",children:e.jsxs(r,{variant:"body2",children:["Phase: ",e.jsx("strong",{children:ke()})]})}),e.jsx(Te,{dateAdapter:Me,adapterLocale:A,children:e.jsx(rs,{label:"Startdatum",value:se,onChange:I,format:"dd.MM.yyyy HH:mm",ampm:!1,slotProps:{textField:{fullWidth:!0,required:!0}}})}),e.jsx(Te,{dateAdapter:Me,adapterLocale:A,children:e.jsx(rs,{label:"Deadline (Pflicht)",value:z,onChange:te,format:"dd.MM.yyyy HH:mm",ampm:!1,minDate:se||new Date,slotProps:{textField:{fullWidth:!0,required:!0,helperText:"Bis wann müssen Professoren ihre Planung einreichen?"}}})})]})}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>D(!1),children:"Abbrechen"}),e.jsx(y,{onClick:de,variant:"contained",disabled:!v||!H||!se||!z,children:"Phase Starten"})]})]}),e.jsxs(Z,{open:E,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Planungsphase Beenden"}),e.jsxs(Y,{children:[e.jsxs(C,{severity:"warning",sx:{mb:2},children:[e.jsx(Fe,{children:"Achtung"}),"Das Beenden der Phase kann nicht rückgängig gemacht werden. Alle aktuellen Planungen werden archiviert."]}),e.jsx(ks,{control:e.jsx(Cs,{checked:fe,onChange:a=>be(a.target.checked)}),label:"Entwürfe archivieren (statt löschen)",sx:{mb:2}}),e.jsx(es,{fullWidth:!0,multiline:!0,rows:3,label:"Grund für Beendigung (optional)",value:ve,onChange:a=>ce(a.target.value),placeholder:"z.B. Planungsphase abgeschlossen, alle Einreichungen bearbeitet"}),i&&e.jsxs(C,{severity:"info",sx:{mt:2},children:["Es werden ",i.professoren_eingereicht," Planungen archiviert.",i.professoren_gesamt-i.professoren_eingereicht," Professoren haben nicht eingereicht."]})]}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>L(!1),children:"Abbrechen"}),e.jsx(y,{onClick:B,variant:"contained",color:"error",children:"Phase Beenden"})]})]}),e.jsxs(Z,{open:X,onClose:()=>l(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Phase Bearbeiten"}),e.jsx(Y,{children:e.jsx(r,{variant:"body2",color:"textSecondary",children:"Bearbeitung der Phase wird implementiert..."})}),e.jsx(le,{children:e.jsx(y,{onClick:()=>l(!1),children:"Schließen"})})]}),e.jsxs(Z,{open:M,onClose:()=>F(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Erinnerungen Senden"}),e.jsxs(Y,{children:[e.jsx(r,{variant:"body1",gutterBottom:!0,children:"Möchten Sie Erinnerungen an alle Professoren senden, die noch keine Planung eingereicht haben?"}),i&&e.jsxs(C,{severity:"info",sx:{mt:2},children:["Es werden Erinnerungen an ",i.professoren_gesamt-i.professoren_eingereicht," Professoren gesendet."]})]}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>F(!1),children:"Abbrechen"}),e.jsx(y,{onClick:s,variant:"contained",color:"primary",startIcon:e.jsx(ns,{}),children:"Erinnerungen Senden"})]})]})]})]})},Ce=d.createContext({});function Xs(t){return he("MuiTimeline",t)}ue("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function oe(t){return t==="alternate-reverse"?"positionAlternateReverse":`position${ss(t)}`}const et=["position","className"],st=t=>{const{position:i,classes:o}=t,h={root:["root",i&&oe(i)]};return pe(h,Xs,o)},tt=ge("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:o}=t;return[i.root,o.position&&i[oe(o.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),nt=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimeline"}),{position:g="right",className:f}=h,j=me(h,et),b=k({},h,{position:g}),w=st(b),P=d.useMemo(()=>({position:g}),[g]);return e.jsx(Ce.Provider,{value:P,children:e.jsx(tt,k({className:je(w.root,f),ownerState:b,ref:o},j))})});function rt(t){return he("MuiTimelineConnector",t)}ue("MuiTimelineConnector",["root"]);const it=["className"],at=t=>{const{classes:i}=t;return pe({root:["root"]},rt,i)},lt=ge("span",{name:"MuiTimelineConnector",slot:"Root",overridesResolver:(t,i)=>i.root})(({theme:t})=>({width:2,backgroundColor:(t.vars||t).palette.grey[400],flexGrow:1})),ot=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineConnector"}),{className:g}=h,f=me(h,it),j=h,b=at(j);return e.jsx(lt,k({className:je(b.root,g),ownerState:j,ref:o},f))});function ct(t){return he("MuiTimelineContent",t)}const dt=ue("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),ht=["className"],ut=t=>{const{position:i,classes:o}=t,h={root:["root",oe(i)]};return pe(h,ct,o)},xt=ge(r,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:o}=t;return[i.root,i[oe(o.position)]]}})(({ownerState:t})=>k({flex:1,padding:"6px 16px",textAlign:"left"},t.position==="left"&&{textAlign:"right"})),mt=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineContent"}),{className:g}=h,f=me(h,ht),{position:j}=d.useContext(Ce),b=k({},h,{position:j||"right"}),w=ut(b);return e.jsx(xt,k({component:"div",className:je(w.root,g),ownerState:b,ref:o},f))});function gt(t){return he("MuiTimelineDot",t)}ue("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const jt=["className","color","variant"],pt=t=>{const{color:i,variant:o,classes:h}=t,g={root:["root",o,i!=="inherit"&&`${o}${ss(i)}`]};return pe(g,gt,h)},ft=ge("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:o}=t;return[i.root,i[o.color!=="inherit"&&`${o.variant}${ss(o.color)}`],i[o.variant]]}})(({ownerState:t,theme:i})=>k({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(i.vars||i).shadows[1],margin:"11.5px 0"},t.variant==="filled"&&k({borderColor:"transparent"},t.color!=="inherit"&&k({},t.color==="grey"?{color:(i.vars||i).palette.grey[50],backgroundColor:(i.vars||i).palette.grey[400]}:{color:(i.vars||i).palette[t.color].contrastText,backgroundColor:(i.vars||i).palette[t.color].main})),t.variant==="outlined"&&k({boxShadow:"none",backgroundColor:"transparent"},t.color!=="inherit"&&k({},t.color==="grey"?{borderColor:(i.vars||i).palette.grey[400]}:{borderColor:(i.vars||i).palette[t.color].main})))),bt=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineDot"}),{className:g,color:f="grey",variant:j="filled"}=h,b=me(h,jt),w=k({},h,{color:f,variant:j}),P=pt(w);return e.jsx(ft,k({className:je(P.root,g),ownerState:w,ref:o},b))});function vt(t){return he("MuiTimelineOppositeContent",t)}const yt=ue("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),_t=["className"],St=t=>{const{position:i,classes:o}=t,h={root:["root",oe(i)]};return pe(h,vt,o)},wt=ge(r,{name:"MuiTimelineOppositeContent",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:o}=t;return[i.root,i[oe(o.position)]]}})(({ownerState:t})=>k({padding:"6px 16px",marginRight:"auto",textAlign:"right",flex:1},t.position==="left"&&{textAlign:"left"})),ys=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineOppositeContent"}),{className:g}=h,f=me(h,_t),{position:j}=d.useContext(Ce),b=k({},h,{position:j||"left"}),w=St(b);return e.jsx(wt,k({component:"div",className:je(w.root,g),ownerState:b,ref:o},f))});ys.muiName="TimelineOppositeContent";function kt(t){return he("MuiTimelineItem",t)}ue("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const Ct=["position","className"],Pt=t=>{const{position:i,classes:o,hasOppositeContent:h}=t,g={root:["root",oe(i),!h&&"missingOppositeContent"]};return pe(g,kt,o)},zt=ge("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:o}=t;return[i.root,i[oe(o.position)]]}})(({ownerState:t})=>k({listStyle:"none",display:"flex",position:"relative",minHeight:70},t.position==="left"&&{flexDirection:"row-reverse"},(t.position==="alternate"||t.position==="alternate-reverse")&&{[`&:nth-of-type(${t.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${dt.root}`]:{textAlign:"right"},[`& .${yt.root}`]:{textAlign:"left"}}},!t.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}})),Tt=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineItem"}),{position:g,className:f}=h,j=me(h,Ct),{position:b}=d.useContext(Ce);let w=!1;d.Children.forEach(h.children,Q=>{Ps(Q,["TimelineOppositeContent"])&&(w=!0)});const P=k({},h,{position:g||b||"right",hasOppositeContent:w}),K=Pt(P),R=d.useMemo(()=>({position:P.position}),[P.position]);return e.jsx(Ce.Provider,{value:R,children:e.jsx(zt,k({className:je(K.root,f),ownerState:P,ref:o},j))})});function At(t){return he("MuiTimelineSeparator",t)}ue("MuiTimelineSeparator",["root"]);const Dt=["className"],Mt=t=>{const{classes:i}=t;return pe({root:["root"]},At,i)},$t=ge("div",{name:"MuiTimelineSeparator",slot:"Root",overridesResolver:(t,i)=>i.root})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),Rt=d.forwardRef(function(i,o){const h=xe({props:i,name:"MuiTimelineSeparator"}),{className:g}=h,f=me(h,Dt),j=h,b=Mt(j);return e.jsx($t,k({className:je(b.root,g),ownerState:j,ref:o},f))}),Wt=Re("PhaseHistoryDialog"),Et=({open:t,onClose:i})=>{const{user:o}=vs(),{phaseHistory:h,loading:g,error:f,fetchPhaseHistory:j,generatePhaseReport:b,clearError:w}=We(),[P,K]=d.useState(null),[R,Q]=d.useState(null),S=o?.rolle==="Dekan",U=o?.rolle==="Professor"||o?.rolle==="Lehrbeauftragter";d.useEffect(()=>{if(t){const l=U?o?.id:void 0;j(l)}},[t]);const W=async l=>{try{await b(l)}catch(M){Wt.error("Fehler beim Generieren des Berichts:",M)}},D=l=>l.phase.ist_aktiv?e.jsx(hs,{}):e.jsx(ds,{}),E=l=>l.phase.ist_aktiv?"primary":l.statistik?l.statistik.genehmigungsquote>=80?"success":l.statistik.genehmigungsquote>=50?"warning":"error":"grey",L=l=>{if(!l.eigene_einreichung)return e.jsx(m,{label:"Nicht eingereicht",size:"small",color:"default"});switch(l.eigene_einreichung.status){case"freigegeben":return e.jsx(m,{label:"Genehmigt",size:"small",color:"success",icon:e.jsx($e,{})});case"abgelehnt":return e.jsx(m,{label:"Abgelehnt",size:"small",color:"error",icon:e.jsx(we,{})});case"eingereicht":return e.jsx(m,{label:"Eingereicht",size:"small",color:"warning",icon:e.jsx(Ws,{})});default:return e.jsx(m,{label:"Unbekannt",size:"small",color:"default"})}},X=(l,M)=>{const F=new Date(l),v=M?new Date(M):new Date;return Ys(v,F)};return e.jsxs(Z,{open:t,onClose:i,maxWidth:"lg",fullWidth:!0,disableRestoreFocus:!0,children:[e.jsx(J,{children:e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",children:"Planungsphasen Historie"}),e.jsxs(r,{variant:"caption",color:"textSecondary",children:[h.length," Phasen gefunden"]})]})}),e.jsxs(Y,{dividers:!0,children:[f&&e.jsx(C,{severity:"error",onClose:w,sx:{mb:2},children:f}),g?e.jsx(u,{display:"flex",justifyContent:"center",p:3,children:e.jsx(Xe,{})}):h.length===0?e.jsx(C,{severity:"info",children:"Keine Phasenhistorie verfügbar"}):e.jsx(nt,{position:"alternate",children:h.map((l,M)=>e.jsxs(Tt,{children:[e.jsxs(ys,{color:"text.secondary",children:[e.jsx(r,{variant:"caption",children:l.phase.startdatum?G(new Date(l.phase.startdatum),"dd.MM.yyyy",{locale:A}):"-"}),e.jsxs(r,{variant:"caption",display:"block",children:[X(l.phase.startdatum,l.phase.geschlossen_am)," Tage"]})]}),e.jsxs(Rt,{children:[e.jsx(bt,{color:E(l),children:D(l)}),M<h.length-1&&e.jsx(ot,{})]}),e.jsx(mt,{children:e.jsx(Ze,{sx:{cursor:"pointer"},onClick:()=>Q(R===l.phase.id?null:l.phase.id),children:e.jsxs(Je,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",component:"div",children:l.phase.name}),l.phase.ist_aktiv&&e.jsx(m,{label:"Aktiv",color:"primary",size:"small"})]}),l.statistik&&e.jsxs(u,{sx:{mt:1},children:[e.jsxs(x,{container:!0,spacing:1,children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(zs,{sx:{fontSize:14,mr:.5}}),l.statistik.professoren_eingereicht," / ",l.statistik.professoren_gesamt," Professoren"]})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(Ts,{sx:{fontSize:14,mr:.5}}),(Number(l.statistik.einreichungsquote)||0).toFixed(0),"% Einreichungsquote"]})})]}),e.jsx(u,{sx:{mt:1},children:e.jsx(Ye,{variant:"determinate",value:l.statistik.einreichungsquote,sx:{height:6,borderRadius:1}})})]}),U&&e.jsx(u,{sx:{mt:1},children:L(l)}),R===l.phase.id&&e.jsxs(Ge,{expanded:!0,sx:{mt:2},children:[e.jsx(Ke,{children:e.jsx(r,{variant:"subtitle2",children:"Details"})}),e.jsx(Ue,{children:e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(As,{sx:{fontSize:14,mr:.5}}),"Zeitraum"]}),e.jsxs(r,{variant:"body2",children:[l.phase.startdatum?G(new Date(l.phase.startdatum),"dd.MM.yyyy",{locale:A}):"-",l.phase.enddatum&&e.jsxs(e.Fragment,{children:[" - ",l.phase.enddatum?G(new Date(l.phase.enddatum),"dd.MM.yyyy",{locale:A}):"-"]})]})]})}),l.statistik&&e.jsxs(e.Fragment,{children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(qe,{sx:{fontSize:14,mr:.5}}),"Genehmigungsquote"]}),e.jsxs(r,{variant:"h6",children:[(Number(l.statistik.genehmigungsquote)||0).toFixed(1),"%"]})]})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(Ds,{sx:{fontSize:14,mr:.5}}),"Ø Bearbeitungszeit"]}),e.jsxs(r,{variant:"h6",children:[(Number(l.statistik.durchschnittliche_bearbeitungszeit)||0).toFixed(1),"h"]})]})})]}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2},children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Statistiken"}),e.jsxs(ze,{dense:!0,children:[e.jsx(ye,{children:e.jsx(_e,{primary:"Einreichungen",secondary:`${l.phase.anzahl_einreichungen} gesamt`})}),e.jsx(ye,{children:e.jsx(_e,{primary:"Genehmigt",secondary:`${l.phase.anzahl_genehmigt} Planungen`})}),e.jsx(ye,{children:e.jsx(_e,{primary:"Abgelehnt",secondary:`${l.phase.anzahl_abgelehnt} Planungen`})})]})]})}),l.statistik?.top_module&&l.statistik.top_module.length>0&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(Ae,{sx:{fontSize:14,mr:.5}}),"Top Module"]}),e.jsx(ze,{dense:!0,children:l.statistik.top_module.slice(0,3).map((F,v)=>e.jsxs(ye,{children:[e.jsx(Ms,{children:e.jsx($s,{fontSize:"small"})}),e.jsx(_e,{primary:F.modul_name,secondary:`${F.anzahl} mal geplant`})]},v))})]})}),U&&l.eigene_einreichung&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(T,{sx:{p:2,bgcolor:"action.hover"},children:[e.jsxs(r,{variant:"caption",color:"textSecondary",children:[e.jsx(De,{sx:{fontSize:14,mr:.5}}),"Ihre Einreichung"]}),e.jsxs(x,{container:!0,spacing:1,sx:{mt:1},children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Eingereicht:"})," ",l.eigene_einreichung.eingereicht_am?G(new Date(l.eigene_einreichung.eingereicht_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"]})}),l.eigene_einreichung.freigegeben_am&&e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Genehmigt:"})," ",l.eigene_einreichung.freigegeben_am?G(new Date(l.eigene_einreichung.freigegeben_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"]})}),l.eigene_einreichung.abgelehnt_am&&e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Abgelehnt:"})," ",l.eigene_einreichung.abgelehnt_am?G(new Date(l.eigene_einreichung.abgelehnt_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"]})})]})]})}),S&&!l.phase.ist_aktiv&&e.jsx(x,{item:!0,xs:12,children:e.jsx(u,{display:"flex",justifyContent:"flex-end",children:e.jsx(y,{variant:"outlined",startIcon:e.jsx(Rs,{}),onClick:()=>W(l.phase.id),children:"Bericht generieren"})})})]})})]})]})})})]},l.phase.id))})]}),e.jsx(le,{children:e.jsx(y,{onClick:i,children:"Schließen"})})]})},Ft=Re("ArchivedPlanungsList"),It=()=>{const{user:t}=vs(),{archivedPlanungen:i,loading:o,fetchArchivedPlanungen:h,restoreFromArchive:g,exportArchive:f}=We(),j=t?.rolle==="Dekan",[b,w]=d.useState(""),[P,K]=d.useState(""),[R,Q]=d.useState(""),[S,U]=d.useState(null),[W,D]=d.useState(null),[E,L]=d.useState(!1),[X,l]=d.useState(0),[M,F]=d.useState(10),[v,ee]=d.useState(null),[H,V]=d.useState(!1),[se,I]=d.useState(!1),[z,te]=d.useState(null);d.useEffect(()=>{O()},[]);const O=()=>{const c={status:P||void 0,planungphase_id:R!==""?R:void 0,von_datum:S?S.toISOString():void 0,bis_datum:W?W.toISOString():void 0,nur_eigene:!j};h(c)},ke=()=>{O()},fe=()=>{w(""),K(""),Q(""),U(null),D(null),O()},be=async()=>{if(!(!z||!j))try{const c=await g(z.id);I(!1),te(null),alert(`Planung wurde erfolgreich wiederhergestellt (ID: ${c})`),O()}catch(c){Ft.error("Fehler beim Wiederherstellen:",c)}},ve=()=>{const c={status:P||void 0,planungphase_id:R!==""?R:void 0,von_datum:S?S.toISOString():void 0,bis_datum:W?W.toISOString():void 0,nur_eigene:!j};f(c)},ce=c=>{switch(c){case"freigegeben":return"success";case"abgelehnt":return"error";case"eingereicht":return"warning";case"entwurf":return"default";default:return"default"}},de=c=>{switch(c){case"phase_geschlossen":return"Phase beendet";case"manuell":return"Manuell archiviert";case"system":return"System-Archivierung";default:return c}},B=i.filter(c=>{if(!b)return!0;const _=b.toLowerCase();return c.professor_name.toLowerCase().includes(_)||c.semester_name.toLowerCase().includes(_)||c.phase_name.toLowerCase().includes(_)}),s=B.reduce((c,_)=>{const a=`${_.planungphase_id}-${_.phase_name}`;return c[a]||(c[a]={phase_key:a,phase_id:_.planungphase_id,phase_name:_.phase_name,planungen:[]}),c[a].planungen.push(_),c},{}),n=Object.values(s).sort((c,_)=>_.phase_id-c.phase_id);return e.jsxs(u,{children:[e.jsx(Ze,{sx:{mb:3},children:e.jsxs(Je,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(r,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsx(Qe,{sx:{mr:1}}),"Archivierte Planungen"]}),e.jsxs(u,{children:[e.jsxs(y,{startIcon:e.jsx(Es,{}),onClick:()=>L(!E),variant:"outlined",sx:{mr:1},children:["Filter ",E?"ausblenden":"anzeigen"]}),e.jsx(y,{startIcon:e.jsx(Fs,{}),onClick:ve,variant:"contained",color:"primary",children:"Excel Export"})]})]}),e.jsx(es,{fullWidth:!0,placeholder:"Suche nach Professor, Semester oder Phase...",value:b,onChange:c=>w(c.target.value),InputProps:{startAdornment:e.jsx(Is,{position:"start",children:e.jsx(is,{})})},sx:{mb:2}}),E&&e.jsx(T,{elevation:1,sx:{p:2,mb:2},children:e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(Le,{fullWidth:!0,children:[e.jsx(He,{children:"Status"}),e.jsxs(Oe,{value:P,onChange:c=>K(c.target.value),label:"Status",children:[e.jsx(ie,{value:"",children:"Alle"}),e.jsx(ie,{value:"entwurf",children:"Entwurf"}),e.jsx(ie,{value:"eingereicht",children:"Eingereicht"}),e.jsx(ie,{value:"freigegeben",children:"Freigegeben"}),e.jsx(ie,{value:"abgelehnt",children:"Abgelehnt"})]})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(Te,{dateAdapter:Me,adapterLocale:A,children:e.jsx(as,{label:"Von Datum",value:S,onChange:U,format:"dd.MM.yyyy",slotProps:{textField:{fullWidth:!0}}})})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(Te,{dateAdapter:Me,adapterLocale:A,children:e.jsx(as,{label:"Bis Datum",value:W,onChange:D,format:"dd.MM.yyyy",slotProps:{textField:{fullWidth:!0}}})})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(u,{display:"flex",gap:1,children:[e.jsx(y,{fullWidth:!0,variant:"contained",onClick:ke,startIcon:e.jsx(is,{}),children:"Suchen"}),e.jsx(y,{fullWidth:!0,variant:"outlined",onClick:fe,children:"Zurücksetzen"})]})})]})}),e.jsxs(r,{variant:"body2",color:"textSecondary",sx:{mb:2},children:[B.length," archivierte Planungen gefunden",!j&&" (Nur eigene Planungen)"]})]})}),o?e.jsx(u,{display:"flex",justifyContent:"center",p:3,children:e.jsx(Xe,{})}):n.length===0?e.jsx(T,{sx:{p:4,textAlign:"center"},children:e.jsx(r,{variant:"body2",color:"textSecondary",children:"Keine archivierten Planungen gefunden"})}):e.jsx(u,{children:n.map((c,_)=>e.jsxs(Ge,{defaultExpanded:_===0,sx:{mb:2},children:[e.jsx(Ke,{expandIcon:e.jsx(Ve,{}),sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},children:e.jsxs(u,{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between",pr:2,children:[e.jsxs(u,{display:"flex",alignItems:"center",flex:1,children:[e.jsx(Bs,{sx:{mr:1}}),e.jsx(r,{variant:"h6",children:c.phase_name})]}),e.jsxs(u,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(m,{label:`Gesamt: ${c.planungen.length}`,size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.3)",color:"white",fontWeight:"bold"}}),e.jsx(m,{label:`Freigegeben: ${c.planungen.filter(a=>a.status_bei_archivierung==="freigegeben").length}`,size:"small",sx:{backgroundColor:"success.light",color:"white",fontWeight:"bold"}}),e.jsx(m,{label:`Eingereicht: ${c.planungen.filter(a=>a.status_bei_archivierung==="eingereicht").length}`,size:"small",sx:{backgroundColor:"warning.light",color:"white",fontWeight:"bold"}}),c.planungen.filter(a=>a.status_bei_archivierung==="abgelehnt").length>0&&e.jsx(m,{label:`Abgelehnt: ${c.planungen.filter(a=>a.status_bei_archivierung==="abgelehnt").length}`,size:"small",sx:{backgroundColor:"error.light",color:"white",fontWeight:"bold"}})]})]})}),e.jsx(Ue,{sx:{p:0},children:e.jsx(gs,{children:e.jsxs(js,{size:"small",children:[e.jsx(ps,{children:e.jsxs(Se,{children:[e.jsx(p,{children:"Archiviert am"}),e.jsx(p,{children:"Professor"}),e.jsx(p,{children:"Semester"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Grund"}),e.jsx(p,{align:"center",children:"Aktionen"})]})}),e.jsx(fs,{children:c.planungen.map(a=>e.jsxs(Se,{hover:!0,sx:{"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(p,{children:a.archiviert_am?G(new Date(a.archiviert_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"}),e.jsx(p,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(De,{sx:{mr:1,fontSize:18,color:"text.secondary"}}),a.professor_name]})}),e.jsx(p,{children:e.jsxs(u,{display:"flex",alignItems:"center",children:[e.jsx(Ae,{sx:{mr:1,fontSize:18,color:"text.secondary"}}),a.semester_name]})}),e.jsx(p,{children:e.jsx(m,{size:"small",label:a.status_bei_archivierung,color:ce(a.status_bei_archivierung),icon:a.status_bei_archivierung==="freigegeben"?e.jsx($e,{}):a.status_bei_archivierung==="abgelehnt"?e.jsx(we,{}):void 0})}),e.jsx(p,{children:e.jsx(m,{size:"small",label:de(a.archiviert_grund),variant:"outlined"})}),e.jsxs(p,{align:"center",children:[e.jsx($,{title:"Details anzeigen",children:e.jsx(q,{size:"small",onClick:()=>{ee(a),V(!0)},children:e.jsx(bs,{})})}),j&&e.jsx($,{title:"Wiederherstellen",children:e.jsx(q,{size:"small",color:"primary",onClick:()=>{te(a),I(!0)},children:e.jsx(Ie,{})})})]})]},a.id))})]})})})]},c.phase_key))}),e.jsxs(Z,{open:H,onClose:()=>V(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:"Archivierte Planung - Details"}),e.jsx(Y,{children:v&&e.jsxs(u,{children:[e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Professor"}),e.jsx(r,{variant:"body1",children:v.professor_name})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Archiviert am"}),e.jsx(r,{variant:"body1",children:v.archiviert_am?G(new Date(v.archiviert_am),"dd.MM.yyyy HH:mm",{locale:A}):"-"})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Semester"}),e.jsx(r,{variant:"body1",children:v.semester_name})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Planungsphase"}),e.jsx(r,{variant:"body1",children:v.phase_name})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Status bei Archivierung"}),e.jsx(m,{label:v.status_bei_archivierung,color:ce(v.status_bei_archivierung),size:"small"})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"caption",color:"textSecondary",children:"Archivierungsgrund"}),e.jsx(m,{label:de(v.archiviert_grund),variant:"outlined",size:"small"})]})]}),e.jsxs(Ge,{children:[e.jsx(Ke,{expandIcon:e.jsx(Ve,{}),children:e.jsx(r,{children:"Planungsdaten anzeigen"})}),e.jsx(Ue,{children:e.jsx(u,{sx:{maxHeight:400,overflow:"auto"},children:e.jsx("pre",{style:{fontSize:"12px",whiteSpace:"pre-wrap"},children:JSON.stringify(v.planung_daten,null,2)})})})]})]})}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>V(!1),children:"Schließen"}),j&&v&&e.jsx(y,{variant:"contained",color:"primary",startIcon:e.jsx(Ie,{}),onClick:()=>{te(v),V(!1),I(!0)},children:"Wiederherstellen"})]})]}),e.jsxs(Z,{open:se,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Planung wiederherstellen"}),e.jsxs(Y,{children:[e.jsx(C,{severity:"warning",sx:{mb:2},children:"Möchten Sie diese archivierte Planung wirklich wiederherstellen?"}),z&&e.jsxs(u,{children:[e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Professor:"})," ",z.professor_name]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Semester:"})," ",z.semester_name]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Phase:"})," ",z.phase_name]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",z.status_bei_archivierung]})]})]}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>I(!1),children:"Abbrechen"}),e.jsx(y,{onClick:be,variant:"contained",color:"primary",startIcon:e.jsx(Ie,{}),children:"Wiederherstellen"})]})]})]})},re=Re("DekanPlanungView"),Vt=()=>{const t=Gs(),[i]=Ks(),o=Js(s=>s.showToast),[h,g]=d.useState(!1),[f,j]=d.useState(0),[b,w]=d.useState([]),[P,K]=d.useState(null),[R,Q]=d.useState([]),{activePhase:S,fetchActivePhase:U}=We(),[W,D]=d.useState(!1),[E,L]=d.useState(null),[X,l]=d.useState(""),[M,F]=d.useState(new Set),[v,ee]=d.useState(!1),[H,V]=d.useState(!1),[se,I]=d.useState(!1);d.useEffect(()=>{z(),U();const s=i.get("status");j(s==="eingereicht"?0:s==="freigegeben"?1:s==="abgelehnt"?2:3)},[i]);const z=async()=>{g(!0);try{const s=await Zs.getAllDozenten();s.success&&s.data&&(Q(s.data),re.debug(" Dozenten loaded:",s.data.length));const n=await Vs.getPlanningSemester();if(n.success&&n.data){K(n.data);const c=await Be.getAllPlanungenDekan({semester_id:n.data.id,nur_aktive_phase:!0});if(c.success&&c.data)if(w(c.data),re.debug(" Planungen loaded (nur aktive Phase):",c.data.length),S){re.debug(" Active phase:",S.name);const _=c.data.filter(a=>a.planungsphase?.id===S.id).length;re.debug(" Planungen in aktiver Phase:",_)}else re.debug(" WARNUNG: Keine aktive Phase, zeige trotzdem Planungen")}}catch(s){re.error(" Error loading data:",s),o("Fehler beim Laden der Planungen","error")}finally{g(!1)}},te=async s=>{if(window.confirm("Möchten Sie diese Planung wirklich freigeben?"))try{g(!0);const n=await Be.approvePlanung(s);n.success?(o("Planung erfolgreich freigegeben","success"),z()):o(n.message||"Fehler beim Freigeben","error")}catch(n){re.error(" Error approving:",n),o(cs(n,"Fehler beim Freigeben"),"error")}finally{g(!1)}},O=s=>{L(s),l(""),D(!0)},ke=async()=>{if(E){if(!X.trim()){o("Bitte geben Sie einen Ablehnungsgrund an","warning");return}try{g(!0);const s=await Be.rejectPlanung(E.id,X);s.success?(o("Planung abgelehnt","success"),D(!1),L(null),l(""),z()):o(s.message||"Fehler beim Ablehnen","error")}catch(s){re.error(" Error rejecting:",s),o(cs(s,"Fehler beim Ablehnen"),"error")}finally{g(!1)}}},fe=s=>{const n={entwurf:{label:"Entwurf",color:"default"},eingereicht:{label:"Eingereicht",color:"warning"},freigegeben:{label:"Freigegeben",color:"success"},abgelehnt:{label:"Abgelehnt",color:"error"}},{label:c,color:_}=n[s]||n.entwurf;return e.jsx(m,{label:c,color:_,size:"small"})},be=s=>{const n=new Set(M);n.has(s)?n.delete(s):n.add(s),F(n)},ve=s=>s.geplante_module?s.geplante_module.reduce((n,c)=>n+(c.modul?.leistungspunkte||0),0):0,ce=s=>!s||s.length===0?[]:s.map(n=>{const c=R.find(_=>_.id===n);return c?c.name_kurz||c.name_komplett:`ID: ${n}`}).filter(Boolean),de=b.filter(s=>f===0?s.status==="eingereicht":f===1?s.status==="freigegeben":f===2?s.status==="abgelehnt":!0),B={eingereicht:b.filter(s=>s.status==="eingereicht").length,freigegeben:b.filter(s=>s.status==="freigegeben").length,abgelehnt:b.filter(s=>s.status==="abgelehnt").length,gesamt:b.length};return e.jsxs(Ns,{maxWidth:"xl",children:[e.jsxs(u,{sx:{mb:3,display:"flex",alignItems:"center",gap:2},children:[e.jsx(q,{onClick:()=>t("/dashboard"),children:e.jsx(qs,{})}),e.jsxs(u,{sx:{flex:1},children:[e.jsx(r,{variant:"h4",fontWeight:600,children:"Semesterplanungen prüfen"}),P&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(r,{variant:"body1",color:"text.secondary",children:P.bezeichnung}),S&&e.jsx(m,{label:`Phase: ${S.name}`,color:"primary",size:"small"})]})]}),e.jsxs(u,{sx:{display:"flex",gap:1},children:[e.jsx($,{title:"Planungsphasen verwalten",children:e.jsx(q,{onClick:()=>ee(!0),color:"primary",children:e.jsx(xs,{badgeContent:S?"1":"0",color:"error",children:e.jsx(Ls,{})})})}),e.jsx($,{title:"Phasenhistorie",children:e.jsx(q,{onClick:()=>V(!0),children:e.jsx(ms,{})})}),e.jsx($,{title:"Archiv",children:e.jsx(q,{onClick:()=>I(!0),children:e.jsx(Qe,{})})})]})]}),h&&e.jsx(Ye,{sx:{mb:2}}),!S&&e.jsxs(C,{severity:"warning",sx:{mb:3},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"⚠️ Keine aktive Planungsphase"}),e.jsx(r,{variant:"body2",children:"Derzeit ist keine Planungsphase aktiv. Es werden keine Planungen angezeigt. Bitte öffnen Sie eine neue Planungsphase über die Planungsphasen-Verwaltung."})]}),S&&B.eingereicht>0&&e.jsx(C,{severity:"warning",sx:{mb:3},children:e.jsxs(r,{variant:"subtitle2",children:["⚠️ ",B.eingereicht," Planung(en) warten auf Ihre Freigabe"]})}),e.jsx(T,{sx:{mb:3},children:e.jsxs(us,{value:f,onChange:(s,n)=>j(n),variant:"fullWidth",children:[e.jsx(ae,{label:`Eingereicht (${B.eingereicht})`,icon:B.eingereicht>0?e.jsx(C,{severity:"warning",sx:{display:"inline",py:0,px:1},children:"!"}):void 0,iconPosition:"end"}),e.jsx(ae,{label:`Freigegeben (${B.freigegeben})`}),e.jsx(ae,{label:`Abgelehnt (${B.abgelehnt})`}),e.jsx(ae,{label:`Alle (${B.gesamt})`})]})}),e.jsx(gs,{component:T,children:e.jsxs(js,{children:[e.jsx(ps,{children:e.jsxs(Se,{children:[e.jsx(p,{width:40}),e.jsx(p,{children:e.jsx("strong",{children:"Dozent"})}),e.jsx(p,{children:e.jsx("strong",{children:"Status"})}),e.jsx(p,{align:"center",children:e.jsx("strong",{children:"Module"})}),e.jsx(p,{align:"center",children:e.jsx("strong",{children:"ECTS"})}),e.jsx(p,{align:"center",children:e.jsx("strong",{children:"SWS"})}),e.jsx(p,{align:"center",children:e.jsx("strong",{children:"Info"})}),e.jsx(p,{children:e.jsx("strong",{children:"Eingereicht am"})}),e.jsx(p,{align:"center",children:e.jsx("strong",{children:"Aktionen"})})]})}),e.jsx(fs,{children:de.length===0?e.jsx(Se,{children:e.jsx(p,{colSpan:9,align:"center",children:e.jsxs(r,{color:"text.secondary",sx:{py:4},children:[f===0&&"Keine eingereichten Planungen",f===1&&"Keine freigegebenen Planungen",f===2&&"Keine abgelehnten Planungen",f===3&&"Keine Planungen vorhanden"]})})}):de.map(s=>e.jsxs(Us.Fragment,{children:[e.jsxs(Se,{hover:!0,sx:{cursor:"pointer","& > *":{borderBottom:M.has(s.id)?"none !important":void 0}},onClick:()=>t(`/semesterplanung/${s.id}`),children:[e.jsx(p,{onClick:n=>n.stopPropagation(),children:e.jsx(q,{size:"small",onClick:()=>be(s.id),children:M.has(s.id)?e.jsx(Hs,{}):e.jsx(Ve,{})})}),e.jsxs(p,{children:[e.jsx(r,{variant:"body2",fontWeight:500,children:s.benutzer?.name_komplett||"Unbekannt"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:s.benutzer?.email||""})]}),e.jsx(p,{children:fe(s.status)}),e.jsx(p,{align:"center",children:e.jsx(m,{label:s.anzahl_module||0,size:"small",color:"primary",variant:"outlined",icon:e.jsx(Ae,{fontSize:"small"})})}),e.jsx(p,{align:"center",children:e.jsxs(r,{variant:"body2",fontWeight:600,children:[ve(s)," ECTS"]})}),e.jsx(p,{align:"center",children:e.jsxs(r,{variant:"body2",fontWeight:600,children:[s.gesamt_sws?.toFixed(1)||"0.0"," SWS"]})}),e.jsx(p,{align:"center",children:e.jsxs(u,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[s.anmerkungen&&e.jsx($,{title:e.jsx(r,{variant:"caption",children:s.anmerkungen}),children:e.jsx(m,{icon:e.jsx(ls,{fontSize:"small"}),label:"Anmerkungen",size:"small",variant:"outlined"})}),s.wunsch_freie_tage&&s.wunsch_freie_tage.length>0&&e.jsx($,{title:`Wunsch-freie Tage: ${s.wunsch_freie_tage.join(", ")}`,children:e.jsx(m,{icon:e.jsx(os,{fontSize:"small"}),label:`${s.wunsch_freie_tage.length} Tag(e)`,size:"small",variant:"outlined",color:"info"})})]})}),e.jsx(p,{children:s.eingereicht_am?new Date(s.eingereicht_am).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx(p,{align:"center",onClick:n=>n.stopPropagation(),children:e.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx($,{title:"Details anzeigen",children:e.jsx(q,{size:"small",onClick:()=>t(`/semesterplanung/${s.id}`),children:e.jsx(bs,{})})}),s.status==="eingereicht"&&e.jsx($,{title:"Freigeben",children:e.jsx(q,{size:"small",color:"success",onClick:()=>te(s.id),children:e.jsx($e,{})})}),s.status==="eingereicht"&&e.jsx($,{title:"Ablehnen",children:e.jsx(q,{size:"small",color:"error",onClick:()=>O(s),children:e.jsx(we,{})})})]})})]}),M.has(s.id)&&e.jsx(Se,{children:e.jsx(p,{colSpan:9,sx:{bgcolor:"grey.50",py:2},children:e.jsxs(u,{sx:{px:2},children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{fontSize:"small"}),"Geplante Module (",s.anzahl_module||0,")"]}),s.geplante_module&&s.geplante_module.length>0?e.jsx(x,{container:!0,spacing:2,sx:{mt:1},children:s.geplante_module.map((n,c)=>e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(T,{variant:"outlined",sx:{p:2},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,children:n.modul?.kuerzel||"Unbekannt"}),e.jsxs(u,{sx:{display:"flex",gap:.5},children:[n.modul?.leistungspunkte&&e.jsx(m,{label:`${n.modul.leistungspunkte} ECTS`,size:"small",color:"primary"}),n.sws_gesamt&&e.jsx(m,{label:`${n.sws_gesamt.toFixed(1)} SWS`,size:"small",color:"secondary"})]})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:1},children:n.modul?.bezeichnung_de}),(n.sws_vorlesung||n.sws_uebung||n.sws_praktikum||n.sws_seminar)&&e.jsxs(u,{sx:{mt:1},children:[e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:"SWS-Aufteilung:"}),e.jsxs(u,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[n.sws_vorlesung>0&&e.jsx(m,{label:`V: ${n.sws_vorlesung}`,size:"small",variant:"outlined"}),n.sws_uebung>0&&e.jsx(m,{label:`Ü: ${n.sws_uebung}`,size:"small",variant:"outlined"}),n.sws_praktikum>0&&e.jsx(m,{label:`P: ${n.sws_praktikum}`,size:"small",variant:"outlined"}),n.sws_seminar>0&&e.jsx(m,{label:`S: ${n.sws_seminar}`,size:"small",variant:"outlined"})]})]}),n.mitarbeiter_ids&&n.mitarbeiter_ids.length>0&&e.jsxs(u,{sx:{mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:[e.jsx(De,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),"Zugeordnete Mitarbeiter:"]}),e.jsx(u,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:ce(n.mitarbeiter_ids).map((_,a)=>e.jsx(m,{label:_,size:"small",variant:"outlined",icon:e.jsx(De,{fontSize:"small"})},a))})]}),(n.raum_vorlesung||n.raum_uebung||n.raum_praktikum||n.raum_seminar)&&e.jsxs(u,{sx:{mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:[e.jsx(ne,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),"Raumplanung pro Lehrform:"]}),e.jsxs(u,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[n.raum_vorlesung&&e.jsx($,{title:n.kapazitaet_vorlesung?`Kapazität: ${n.kapazitaet_vorlesung}`:"",children:e.jsx(m,{label:`V: ${n.raum_vorlesung}${n.kapazitaet_vorlesung?` (${n.kapazitaet_vorlesung})`:""}`,size:"small",variant:"outlined",color:"primary",icon:e.jsx(ne,{fontSize:"small"})})}),n.raum_uebung&&e.jsx($,{title:n.kapazitaet_uebung?`Kapazität: ${n.kapazitaet_uebung}`:"",children:e.jsx(m,{label:`Ü: ${n.raum_uebung}${n.kapazitaet_uebung?` (${n.kapazitaet_uebung})`:""}`,size:"small",variant:"outlined",color:"secondary",icon:e.jsx(ne,{fontSize:"small"})})}),n.raum_praktikum&&e.jsx($,{title:n.kapazitaet_praktikum?`Kapazität: ${n.kapazitaet_praktikum}`:"",children:e.jsx(m,{label:`P: ${n.raum_praktikum}${n.kapazitaet_praktikum?` (${n.kapazitaet_praktikum})`:""}`,size:"small",variant:"outlined",color:"warning",icon:e.jsx(ne,{fontSize:"small"})})}),n.raum_seminar&&e.jsx($,{title:n.kapazitaet_seminar?`Kapazität: ${n.kapazitaet_seminar}`:"",children:e.jsx(m,{label:`S: ${n.raum_seminar}${n.kapazitaet_seminar?` (${n.kapazitaet_seminar})`:""}`,size:"small",variant:"outlined",color:"success",icon:e.jsx(ne,{fontSize:"small"})})})]})]}),n.raumbedarf&&e.jsxs(u,{sx:{mt:1},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:[e.jsx(ne,{fontSize:"small",sx:{verticalAlign:"middle",mr:.5}}),"Raumbedarf:"]}),e.jsx(r,{variant:"body2",sx:{pl:2},children:n.raumbedarf})]}),n.anmerkungen&&e.jsx(C,{severity:"info",sx:{mt:1,py:0},children:e.jsxs(r,{variant:"caption",children:[e.jsx("strong",{children:"Anmerkung:"})," ",n.anmerkungen]})})]})},c))}):e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic",mt:1},children:"Keine Module geplant"}),(s.anmerkungen||s.raumbedarf||Array.isArray(s.room_requirements)&&s.room_requirements.length>0||s.special_requests||s.wunsch_freie_tage&&s.wunsch_freie_tage.length>0)&&e.jsxs(u,{sx:{mt:3},children:[e.jsx(Os,{sx:{mb:2}}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Zusätzliche Informationen"}),e.jsxs(x,{container:!0,spacing:2,children:[s.anmerkungen&&e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(C,{severity:"info",icon:e.jsx(ls,{}),children:[e.jsx(r,{variant:"caption",fontWeight:600,display:"block",gutterBottom:!0,children:"Anmerkungen zur Planung"}),e.jsx(r,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:s.anmerkungen})]})}),s.raumbedarf&&e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(C,{severity:"info",icon:e.jsx(ne,{}),children:[e.jsx(r,{variant:"caption",fontWeight:600,display:"block",gutterBottom:!0,children:"Raumbedarf"}),e.jsx(r,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:s.raumbedarf})]})}),s.wunsch_freie_tage&&s.wunsch_freie_tage.length>0&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(C,{severity:"warning",icon:e.jsx(os,{}),children:[e.jsxs(r,{variant:"caption",fontWeight:600,display:"block",gutterBottom:!0,children:["Wunsch-freie Tage (",s.wunsch_freie_tage.length,")"]}),e.jsx(u,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:1},children:s.wunsch_freie_tage.map((n,c)=>e.jsx(m,{label:`${n.wochentag} (${n.zeitraum||"ganztags"})`,size:"small",color:n.prioritaet==="hoch"?"error":n.prioritaet==="mittel"?"warning":"default",title:n.grund||"Kein Grund angegeben"},c))})]})}),Array.isArray(s.room_requirements)&&s.room_requirements.length>0&&e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(C,{severity:"info",icon:e.jsx(ne,{}),children:[e.jsxs(r,{variant:"caption",fontWeight:600,display:"block",gutterBottom:!0,children:["Raumanforderungen (",s.room_requirements.length,")"]}),s.room_requirements.map((n,c)=>e.jsxs(u,{sx:{mt:.5},children:[e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:n.type})," (Kapazität: ",n.capacity,")"]}),n.equipment&&n.equipment.length>0&&e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Ausstattung: ",n.equipment.join(", ")]})]},c))]})}),s.special_requests&&typeof s.special_requests=="object"&&!Array.isArray(s.special_requests)&&Object.keys(s.special_requests).some(n=>s.special_requests[n])&&e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(C,{severity:"info",children:[e.jsx(r,{variant:"caption",fontWeight:600,display:"block",gutterBottom:!0,children:"Spezielle Anforderungen"}),e.jsxs(u,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[s.special_requests.needsComputerRoom&&e.jsx(m,{label:"Computerraum",size:"small"}),s.special_requests.needsLab&&e.jsx(m,{label:"Labor",size:"small"}),s.special_requests.needsBeamer&&e.jsx(m,{label:"Beamer",size:"small"}),s.special_requests.needsWhiteboard&&e.jsx(m,{label:"Whiteboard",size:"small"}),s.special_requests.flexibleScheduling&&e.jsx(m,{label:"Flexible Planung",size:"small"}),s.special_requests.blockCourse&&e.jsx(m,{label:"Blockveranstaltung",size:"small"})]})]})})]})]})]})})})]},s.id))})]})}),e.jsxs(Z,{open:W,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,disableRestoreFocus:!0,children:[e.jsx(J,{children:"Planung ablehnen"}),e.jsxs(Y,{children:[e.jsx(C,{severity:"warning",sx:{mb:2},children:"Die Planung wird abgelehnt und der Dozent kann sie überarbeiten."}),e.jsxs(r,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Dozent:"})," ",E?.benutzer?.name_komplett]}),e.jsxs(r,{variant:"body2",gutterBottom:!0,sx:{mb:2},children:[e.jsx("strong",{children:"Module:"})," ",E?.anzahl_module||0," • ",E?.gesamt_sws?.toFixed(1)||"0.0"," SWS"]}),e.jsx(es,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:4,label:"Ablehnungsgrund *",placeholder:"Bitte geben Sie an, warum die Planung abgelehnt wird...",value:X,onChange:s=>l(s.target.value),helperText:"Der Dozent wird diesen Grund sehen und kann die Planung überarbeiten."})]}),e.jsxs(le,{children:[e.jsx(y,{onClick:()=>D(!1),children:"Abbrechen"}),e.jsx(y,{variant:"contained",color:"error",onClick:ke,disabled:!X.trim()||h,children:"Ablehnen"})]})]}),e.jsxs(Z,{open:v,onClose:()=>ee(!1),maxWidth:"lg",fullWidth:!0,disableRestoreFocus:!0,children:[e.jsx(J,{children:e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",children:"Planungsphasen-Verwaltung"}),e.jsx(q,{onClick:()=>ee(!1),children:e.jsx(we,{})})]})}),e.jsx(Y,{dividers:!0,children:e.jsx(Qs,{})})]}),e.jsx(Et,{open:H,onClose:()=>V(!1)}),e.jsxs(Z,{open:se,onClose:()=>I(!1),maxWidth:"lg",fullWidth:!0,disableRestoreFocus:!0,children:[e.jsx(J,{children:e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",children:"Archivierte Planungen"}),e.jsx(q,{onClick:()=>I(!1),children:e.jsx(we,{})})]})}),e.jsx(Y,{dividers:!0,children:e.jsx(It,{})})]})]})};export{Vt as default};
