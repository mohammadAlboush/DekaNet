import{j as e,aD as We,aE as Ce,B as u,f as t,I as ae,aS as Te,aF as Ie,z as pe,aG as Pe,O as x,Q as q,aL as $e,P as J,ab as f,w as de,a2 as Ae,$ as d,H as M,D as P,G as je,aw as De,ax as Me,az as Le,o as Be,aH as Ee,K as V,b4 as be,aY as Fe,ae as Re,af as Ve,ag as Ke,ah as xe,ai as b,aj as He,l as X,bU as Ze,ak as fe,b3 as _e,N as ge,bj as Ge,bR as Ue,a7 as Ne,a8 as re,a_ as Oe,bG as Je,bV as Qe,a0 as te,a1 as se,bd as Ye,be as qe}from"./vendor-mui-BiVZR0IW.js";import{r as h,u as Xe,i as ea}from"./vendor-react-CBtCGaWm.js";import{t as T}from"./templateService-C2aAXxn3.js";import{b as he,u as aa,c as me,a as ce,g as O}from"./index-BXi_OX1m.js";import{D as L,M as N,W as na}from"./WunschTagEditor-D86ctGzX.js";import"./vendor-utils-DTv3oRQQ.js";const ee=me("TemplateModulDialog"),le={modul:null,anzahl_vorlesungen:0,anzahl_uebungen:0,anzahl_praktika:0,anzahl_seminare:0,anmerkungen:"",mitarbeiter_ids:[],raum_vorlesung:"",raum_uebung:"",raum_praktikum:"",raum_seminar:"",kapazitaet_vorlesung:L.vorlesung,kapazitaet_uebung:L.uebung,kapazitaet_praktikum:L.praktikum,kapazitaet_seminar:L.seminar},ra=({open:_,onClose:p,templateId:g,editingModul:o,onSave:I})=>{const v=he(n=>n.showToast),{user:k}=aa(),[a,c]=h.useState(le),[z,K]=h.useState([]),[$,H]=h.useState([]),[B,E]=h.useState(!1),[S,F]=h.useState(!1),[Z,r]=h.useState(!1);h.useEffect(()=>{_&&(m(),o?W():c(le))},[_,o]);const m=async()=>{E(!0);try{if(k?.dozent_id){ee.debug("Loading own modules for dozent_id:",k.dozent_id);const l=await ce.get(`/dozenten/${k.dozent_id}/module`);if(l.data.success){const y=l.data.data||[];ee.debug("Loaded",y.length,"own modules"),K(y)}}else{ee.debug("No dozent_id, loading all modules");const l=await ce.get("/module");l.data.success&&K(l.data.data||[])}const n=await ce.get("/dozenten");n.data.success&&H(n.data.data||[])}catch(n){ee.error("Error loading data:",n),v("Fehler beim Laden der Daten","error")}finally{E(!1)}},W=async()=>{if(!o)return;const n=z.find(l=>l.id===o.modul_id);c({modul:n||{id:o.modul_id,kuerzel:o.modul?.kuerzel||"",bezeichnung_de:o.modul?.bezeichnung_de||"",bezeichnung_en:"",leistungspunkte:o.modul?.leistungspunkte||0,sws_gesamt:0,po_id:o.po_id,lehrformen:[]},anzahl_vorlesungen:o.anzahl_vorlesungen||0,anzahl_uebungen:o.anzahl_uebungen||0,anzahl_praktika:o.anzahl_praktika||0,anzahl_seminare:o.anzahl_seminare||0,anmerkungen:o.anmerkungen||"",mitarbeiter_ids:o.mitarbeiter_ids||[],raum_vorlesung:o.raum_vorlesung||"",raum_uebung:o.raum_uebung||"",raum_praktikum:o.raum_praktikum||"",raum_seminar:o.raum_seminar||"",kapazitaet_vorlesung:o.kapazitaet_vorlesung||L.vorlesung,kapazitaet_uebung:o.kapazitaet_uebung||L.uebung,kapazitaet_praktikum:o.kapazitaet_praktikum||L.praktikum,kapazitaet_seminar:o.kapazitaet_seminar||L.seminar})};h.useEffect(()=>{if(o&&z.length>0&&a.modul){const n=z.find(l=>l.id===o.modul_id);n&&n.id!==a.modul.id&&c(l=>({...l,modul:n}))}},[z,o]);const C=n=>{if(!n){c(le);return}let l=0,y=0,D=0,ne=0;if(n.lehrformen&&n.lehrformen.length>0){const U=n.lehrformen.some(j=>j.kuerzel==="V"),s=n.lehrformen.some(j=>j.kuerzel==="Ü"),i=n.lehrformen.some(j=>j.kuerzel==="P"),Y=n.lehrformen.some(j=>j.kuerzel==="S");l=U?1:0,y=s?1:0,D=i?1:0,ne=Y?1:0}else l=1;c({...le,modul:n,anzahl_vorlesungen:l,anzahl_uebungen:y,anzahl_praktika:D,anzahl_seminare:ne})},R=async()=>{if(!a.modul){v("Bitte wählen Sie ein Modul aus","warning");return}if(a.anzahl_vorlesungen+a.anzahl_uebungen+a.anzahl_praktika+a.anzahl_seminare===0){v("Mindestens eine Lehrform muss > 0 sein","warning");return}F(!0);try{const l={modul_id:a.modul.id,po_id:a.modul.po_id||1,anzahl_vorlesungen:a.anzahl_vorlesungen,anzahl_uebungen:a.anzahl_uebungen,anzahl_praktika:a.anzahl_praktika,anzahl_seminare:a.anzahl_seminare,mitarbeiter_ids:a.mitarbeiter_ids.length>0?a.mitarbeiter_ids:void 0,anmerkungen:a.anmerkungen||void 0,raum_vorlesung:a.raum_vorlesung||void 0,raum_uebung:a.raum_uebung||void 0,raum_praktikum:a.raum_praktikum||void 0,raum_seminar:a.raum_seminar||void 0,kapazitaet_vorlesung:a.kapazitaet_vorlesung||void 0,kapazitaet_uebung:a.kapazitaet_uebung||void 0,kapazitaet_praktikum:a.kapazitaet_praktikum||void 0,kapazitaet_seminar:a.kapazitaet_seminar||void 0};o?(await T.updateModul(g,o.id,l),v("Modul aktualisiert","success")):(await T.addModul(g,l),v("Modul hinzugefügt","success")),I(),p()}catch(l){ee.error("Error saving module:",{error:l}),v(O(l,"Fehler beim Speichern"),"error")}finally{F(!1)}},w=n=>a.modul?.lehrformen?a.modul.lehrformen.some(l=>l.kuerzel===n):!1,A=n=>a.modul?.lehrformen&&a.modul.lehrformen.find(y=>y.kuerzel===n)?.sws||0,G=()=>{if(!a.modul?.lehrformen)return 0;let n=0;return a.modul.lehrformen.forEach(l=>{switch(l.kuerzel){case"V":n+=a.anzahl_vorlesungen*l.sws;break;case"Ü":n+=a.anzahl_uebungen*l.sws;break;case"P":n+=a.anzahl_praktika*l.sws;break;case"S":n+=a.anzahl_seminare*l.sws;break}}),n},Q=()=>{const n=[];return a.anzahl_vorlesungen>0&&n.push(`${a.anzahl_vorlesungen}V`),a.anzahl_uebungen>0&&n.push(`${a.anzahl_uebungen}Ü`),a.anzahl_praktika>0&&n.push(`${a.anzahl_praktika}P`),a.anzahl_seminare>0&&n.push(`${a.anzahl_seminare}S`),n.join(" + ")||"Keine"};return e.jsxs(We,{open:_,onClose:p,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ce,{children:e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(t,{variant:"h6",children:o?"Modul bearbeiten":"Modul hinzufügen"}),e.jsx(ae,{onClick:p,size:"small",children:e.jsx(Te,{})})]})}),e.jsx(Ie,{children:B?e.jsx(u,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(pe,{})}):e.jsxs(e.Fragment,{children:[!o&&e.jsxs(u,{sx:{mb:3},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Modul auswählen"}),e.jsx(Pe,{open:Z,onOpen:()=>r(!0),onClose:()=>r(!1),options:z,getOptionLabel:n=>`${n.kuerzel} - ${n.bezeichnung_de}`,value:a.modul,onChange:(n,l)=>C(l),renderInput:n=>e.jsx(x,{...n,placeholder:"Modul suchen...",InputProps:{...n.InputProps,startAdornment:e.jsxs(e.Fragment,{children:[e.jsx(q,{position:"start",children:e.jsx($e,{})}),n.InputProps.startAdornment]})}}),renderOption:(n,l)=>{const{key:y,...D}=n;return e.jsx("li",{...D,children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",fontWeight:600,children:l.kuerzel}),e.jsx(t,{variant:"caption",color:"text.secondary",children:l.bezeichnung_de})]})},l.id)}})]}),a.modul&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{variant:"outlined",sx:{p:2,mb:3,bgcolor:"background.default"},children:[e.jsx(t,{variant:"subtitle1",fontWeight:600,children:a.modul.kuerzel}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a.modul.bezeichnung_de}),e.jsxs(u,{sx:{display:"flex",gap:1,mt:1},children:[a.modul.leistungspunkte&&e.jsx(f,{size:"small",icon:e.jsx(de,{}),label:`${a.modul.leistungspunkte} ECTS`}),a.modul.sws_gesamt&&a.modul.sws_gesamt>0&&e.jsx(f,{size:"small",icon:e.jsx(Ae,{}),label:`${a.modul.sws_gesamt} SWS (Basis)`,color:"secondary"})]}),a.modul.lehrformen&&a.modul.lehrformen.length>0&&e.jsxs(u,{sx:{mt:2},children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Verfügbare Lehrformen:"}),e.jsx(u,{sx:{display:"flex",gap:.5,mt:.5},children:a.modul.lehrformen.map(n=>e.jsx(f,{size:"small",label:`${n.kuerzel}: ${n.sws} SWS`,variant:"outlined"},n.id))})]})]}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Lehrformen & Multiplikatoren"}),e.jsx(t,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Geben Sie an, wie oft jede Lehrform stattfinden soll."}),e.jsxs(d,{container:!0,spacing:2,children:[w("V")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Vorlesungen",value:a.anzahl_vorlesungen,onChange:n=>c({...a,anzahl_vorlesungen:Math.max(0,parseInt(n.target.value)||0)}),InputProps:{endAdornment:e.jsx(q,{position:"end",children:e.jsx(f,{size:"small",label:`${A("V")} SWS`})})},inputProps:{min:0,max:N.maxInput}})}),w("Ü")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Übungen",value:a.anzahl_uebungen,onChange:n=>c({...a,anzahl_uebungen:Math.max(0,parseInt(n.target.value)||0)}),InputProps:{endAdornment:e.jsx(q,{position:"end",children:e.jsx(f,{size:"small",label:`${A("Ü")} SWS`})})},inputProps:{min:0,max:N.maxInput}})}),w("P")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Praktika",value:a.anzahl_praktika,onChange:n=>c({...a,anzahl_praktika:Math.max(0,parseInt(n.target.value)||0)}),InputProps:{endAdornment:e.jsx(q,{position:"end",children:e.jsx(f,{size:"small",label:`${A("P")} SWS`})})},inputProps:{min:0,max:N.maxInput}})}),w("S")&&e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Seminare",value:a.anzahl_seminare,onChange:n=>c({...a,anzahl_seminare:Math.max(0,parseInt(n.target.value)||0)}),InputProps:{endAdornment:e.jsx(q,{position:"end",children:e.jsx(f,{size:"small",label:`${A("S")} SWS`})})},inputProps:{min:0,max:N.maxInput}})}),(!a.modul.lehrformen||a.modul.lehrformen.length===0)&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Vorlesungen",value:a.anzahl_vorlesungen,onChange:n=>c({...a,anzahl_vorlesungen:Math.max(0,parseInt(n.target.value)||0)}),inputProps:{min:0,max:N.maxInput}})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,type:"number",label:"Übungen",value:a.anzahl_uebungen,onChange:n=>c({...a,anzahl_uebungen:Math.max(0,parseInt(n.target.value)||0)}),inputProps:{min:0,max:N.maxInput}})})]})]}),e.jsxs(J,{variant:"outlined",sx:{p:2,mt:2,bgcolor:"primary.50"},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Konfiguration: ",Q()]}),e.jsxs(t,{variant:"h5",color:"primary",fontWeight:600,children:[G().toFixed(1)," SWS"]})]}),a.anzahl_vorlesungen+a.anzahl_uebungen+a.anzahl_praktika+a.anzahl_seminare===0&&e.jsx(M,{severity:"warning",sx:{mt:2},children:"Bitte setzen Sie mindestens eine Lehrform auf einen Wert größer als 0."}),e.jsx(P,{sx:{my:3}}),e.jsxs(t,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle",fontSize:18}}),"Mitarbeiter-Zuordnung (optional)"]}),e.jsxs(De,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Me,{children:"Mitarbeiter"}),e.jsx(Le,{multiple:!0,value:a.mitarbeiter_ids,onChange:n=>c({...a,mitarbeiter_ids:n.target.value}),label:"Mitarbeiter",renderValue:n=>e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(l=>{const y=$.find(D=>D.id===l);return e.jsx(f,{label:y?.name_komplett||`ID: ${l}`,size:"small"},l)})}),children:$.map(n=>e.jsx(Be,{value:n.id,children:n.name_komplett},n.id))})]}),e.jsx(P,{sx:{my:3}}),e.jsx(t,{variant:"subtitle2",gutterBottom:!0,fontWeight:600,children:"Raumplanung pro Lehrform (optional)"}),e.jsxs(d,{container:!0,spacing:2,children:[a.anzahl_vorlesungen>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{severity:"info",sx:{py:.5},children:e.jsxs(t,{variant:"subtitle2",children:["Vorlesung (",a.anzahl_vorlesungen,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,size:"small",label:"Raumwunsch Vorlesung",placeholder:"z.B. Hörsaal, großer Raum...",value:a.raum_vorlesung,onChange:n=>c({...a,raum_vorlesung:n.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,size:"small",type:"number",label:"Kapazität",value:a.kapazitaet_vorlesung,onChange:n=>c({...a,kapazitaet_vorlesung:parseInt(n.target.value)||0}),inputProps:{min:0}})})]}),a.anzahl_uebungen>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{severity:"info",sx:{py:.5},children:e.jsxs(t,{variant:"subtitle2",children:["Übung (",a.anzahl_uebungen,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,size:"small",label:"Raumwunsch Übung",placeholder:"z.B. Seminarraum...",value:a.raum_uebung,onChange:n=>c({...a,raum_uebung:n.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,size:"small",type:"number",label:"Kapazität",value:a.kapazitaet_uebung,onChange:n=>c({...a,kapazitaet_uebung:parseInt(n.target.value)||0}),inputProps:{min:0}})})]}),a.anzahl_praktika>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{severity:"info",sx:{py:.5},children:e.jsxs(t,{variant:"subtitle2",children:["Praktikum (",a.anzahl_praktika,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,size:"small",label:"Raumwunsch Praktikum",placeholder:"z.B. Labor, Computerraum...",value:a.raum_praktikum,onChange:n=>c({...a,raum_praktikum:n.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,size:"small",type:"number",label:"Kapazität",value:a.kapazitaet_praktikum,onChange:n=>c({...a,kapazitaet_praktikum:parseInt(n.target.value)||0}),inputProps:{min:0}})})]}),a.anzahl_seminare>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{severity:"info",sx:{py:.5},children:e.jsxs(t,{variant:"subtitle2",children:["Seminar (",a.anzahl_seminare,"x)"]})})}),e.jsx(d,{item:!0,xs:8,children:e.jsx(x,{fullWidth:!0,size:"small",label:"Raumwunsch Seminar",placeholder:"z.B. Seminarraum...",value:a.raum_seminar,onChange:n=>c({...a,raum_seminar:n.target.value})})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(x,{fullWidth:!0,size:"small",type:"number",label:"Kapazität",value:a.kapazitaet_seminar,onChange:n=>c({...a,kapazitaet_seminar:parseInt(n.target.value)||0}),inputProps:{min:0}})})]})]}),e.jsx(P,{sx:{my:3}}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:3,label:"Anmerkungen (optional)",value:a.anmerkungen,onChange:n=>c({...a,anmerkungen:n.target.value}),placeholder:"Zusätzliche Hinweise zum Modul..."})]})]})}),e.jsxs(Ee,{children:[e.jsx(V,{onClick:p,children:"Abbrechen"}),e.jsx(V,{variant:"contained",startIcon:e.jsx(be,{}),onClick:R,disabled:S||!a.modul||a.anzahl_vorlesungen+a.anzahl_uebungen+a.anzahl_praktika+a.anzahl_seminare===0,children:S?"Speichert...":"Speichern"})]})]})},ta=me("TemplateModulList"),sa=({templateId:_,module:p,onModuleChange:g,readOnly:o=!1})=>{const I=he(r=>r.showToast),[v,k]=h.useState(!1),[a,c]=h.useState(null),z=()=>{c(null),k(!0)},K=r=>{c(r),k(!0)},$=async r=>{if(window.confirm(`Modul "${r.modul?.kuerzel||r.modul_id}" wirklich entfernen?`))try{await T.removeModul(_,r.id),I("Modul entfernt","success"),g()}catch(m){ta.error("Error removing module:",{error:m}),I(O(m,"Fehler beim Entfernen"),"error")}},H=()=>{k(!1),c(null)},B=()=>{g()},E=r=>{const m=[];return r.anzahl_vorlesungen>0&&m.push(`${r.anzahl_vorlesungen}V`),r.anzahl_uebungen>0&&m.push(`${r.anzahl_uebungen}Ü`),r.anzahl_praktika>0&&m.push(`${r.anzahl_praktika}P`),r.anzahl_seminare>0&&m.push(`${r.anzahl_seminare}S`),m.join("+")||"-"},S=r=>{const m=r.modul?.lehrformen||[],W=Q=>m.find(l=>l.kuerzel===Q)?.sws||0,C=r.anzahl_vorlesungen*W("V"),R=r.anzahl_uebungen*W("Ü"),w=r.anzahl_praktika*W("P"),A=r.anzahl_seminare*W("S"),G=C+R+w+A;return G===0&&r.modul?.sws_gesamt?r.modul.sws_gesamt:G},F=r=>!!(r.raum_vorlesung||r.raum_uebung||r.raum_praktikum||r.raum_seminar),Z=r=>{const m=[];return r.raum_vorlesung&&m.push(`V: ${r.raum_vorlesung}`),r.raum_uebung&&m.push(`Ü: ${r.raum_uebung}`),r.raum_praktikum&&m.push(`P: ${r.raum_praktikum}`),r.raum_seminar&&m.push(`S: ${r.raum_seminar}`),m.join(", ")||"Keine Raumwünsche"};return e.jsxs(u,{children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(t,{variant:"subtitle1",fontWeight:600,children:[e.jsx(de,{sx:{mr:1,verticalAlign:"middle",fontSize:20}}),"Module im Template (",p.length,")"]}),!o&&e.jsx(V,{variant:"contained",size:"small",startIcon:e.jsx(Fe,{}),onClick:z,children:"Modul hinzufügen"})]}),p.length>0?e.jsx(Re,{component:J,variant:"outlined",children:e.jsxs(Ve,{size:"small",children:[e.jsx(Ke,{children:e.jsxs(xe,{sx:{bgcolor:"grey.50"},children:[e.jsx(b,{children:e.jsx("strong",{children:"Modul"})}),e.jsx(b,{children:e.jsx("strong",{children:"Bezeichnung"})}),e.jsx(b,{align:"center",children:e.jsx("strong",{children:"Lehrformen"})}),e.jsx(b,{align:"center",children:e.jsx("strong",{children:"SWS"})}),e.jsx(b,{align:"center",children:e.jsx("strong",{children:"Mitarbeiter"})}),e.jsx(b,{align:"center",children:e.jsx("strong",{children:"Räume"})}),!o&&e.jsx(b,{align:"right",children:e.jsx("strong",{children:"Aktionen"})})]})}),e.jsx(He,{children:p.map(r=>e.jsxs(xe,{hover:!0,children:[e.jsx(b,{children:e.jsx(t,{variant:"body2",fontWeight:600,color:"primary",children:r.modul?.kuerzel||`ID: ${r.modul_id}`})}),e.jsxs(b,{children:[e.jsx(t,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:r.modul?.bezeichnung_de||"-"}),r.anmerkungen&&e.jsx(t,{variant:"caption",color:"text.secondary",display:"block",children:r.anmerkungen})]}),e.jsx(b,{align:"center",children:e.jsx(f,{size:"small",label:E(r),color:"primary",variant:"outlined"})}),e.jsx(b,{align:"center",children:e.jsx(X,{title:"Semesterwochenstunden (berechnet aus Lehrformen × Multiplikatoren)",children:e.jsx(t,{variant:"body2",fontWeight:600,color:"primary.main",children:S(r).toFixed(1)})})}),e.jsx(b,{align:"center",children:r.mitarbeiter_ids&&r.mitarbeiter_ids.length>0?e.jsx(X,{title:`${r.mitarbeiter_ids.length} Mitarbeiter zugeordnet`,children:e.jsx(f,{size:"small",icon:e.jsx(je,{}),label:r.mitarbeiter_ids.length,color:"secondary",variant:"outlined"})}):e.jsx(t,{variant:"caption",color:"text.secondary",children:"-"})}),e.jsx(b,{align:"center",children:F(r)?e.jsx(X,{title:Z(r),children:e.jsx(f,{size:"small",icon:e.jsx(Ze,{}),label:"Ja",color:"success",variant:"outlined"})}):e.jsx(t,{variant:"caption",color:"text.secondary",children:"-"})}),!o&&e.jsxs(b,{align:"right",children:[e.jsx(X,{title:"Bearbeiten",children:e.jsx(ae,{size:"small",onClick:()=>K(r),color:"primary",children:e.jsx(fe,{fontSize:"small"})})}),e.jsx(X,{title:"Entfernen",children:e.jsx(ae,{size:"small",onClick:()=>$(r),color:"error",children:e.jsx(_e,{fontSize:"small"})})})]})]},r.id))})]})}):e.jsx(M,{severity:"info",children:o?"Keine Module im Template definiert.":'Noch keine Module hinzugefügt. Klicken Sie auf "Modul hinzufügen", um Module zu konfigurieren.'}),e.jsx(ra,{open:v,onClose:H,templateId:_,editingModul:a,onSave:B})]})},ie=me("TemplateDetail");function oe(_){const{children:p,value:g,index:o,...I}=_;return e.jsx("div",{role:"tabpanel",hidden:g!==o,id:`template-tabpanel-${o}`,"aria-labelledby":`template-tab-${o}`,...I,children:g===o&&e.jsx(u,{sx:{py:3},children:p})})}const ma=()=>{const _=Xe(),{id:p}=ea(),g=he(s=>s.showToast),[o,I]=h.useState(!0),[v,k]=h.useState(!1),[a,c]=h.useState(null),[z,K]=h.useState(0),[$,H]=h.useState(""),[B,E]=h.useState(""),[S,F]=h.useState([]),[Z,r]=h.useState(!1),[m,W]=h.useState(!1),[C,R]=h.useState({name:"",beschreibung:""});h.useEffect(()=>{p&&w(parseInt(p))},[p]);const w=async s=>{I(!0);try{const i=await T.getTemplate(s);i.success&&i.data?(c(i.data),H(i.data.anmerkungen||""),E(i.data.raumbedarf||""),F((i.data.wunsch_freie_tage||[]).map((Y,j)=>({...Y,id:`wt-${j}`}))),R({name:i.data.name||"",beschreibung:i.data.beschreibung||""}),r(!1)):(g("Template nicht gefunden","error"),_("/templates"))}catch(i){ie.error("Error loading template:",i),g(O(i,"Fehler beim Laden"),"error"),_("/templates")}finally{I(!1)}},A=async()=>{if(a){k(!0);try{const s={anmerkungen:$,raumbedarf:B,wunsch_freie_tage:S.map(i=>({wochentag:i.wochentag,zeitraum:i.zeitraum,prioritaet:i.prioritaet,grund:i.grund}))};await T.updateTemplate(a.id,s),g("Änderungen gespeichert","success"),r(!1),w(a.id)}catch(s){ie.error("Error saving:",s),g(O(s,"Fehler beim Speichern"),"error")}finally{k(!1)}}},G=async()=>{if(a){k(!0);try{await T.updateTemplate(a.id,{name:C.name||void 0,beschreibung:C.beschreibung||void 0}),g("Änderungen gespeichert","success"),W(!1),w(a.id)}catch(s){ie.error("Error saving header:",s),g(O(s,"Fehler beim Speichern"),"error")}finally{k(!1)}}},Q=async()=>{if(a&&window.confirm(`Template "${a.name||T.formatSemesterTyp(a.semester_typ)}" wirklich löschen?`))try{await T.deleteTemplate(a.id),g("Template gelöscht","success"),_("/templates")}catch(s){ie.error("Error deleting:",s),g(O(s,"Fehler beim Löschen"),"error")}},n=s=>{F(s),r(!0)},l=(s,i)=>{s==="anmerkungen"?H(i):E(i),r(!0)},y=()=>a?a.semester_typ==="winter"?e.jsx(Ye,{color:"primary",sx:{fontSize:28}}):e.jsx(qe,{sx:{color:"orange",fontSize:28}}):null,D=()=>a?.template_module?a.template_module.reduce((s,i)=>({v:s.v+(i.anzahl_vorlesungen||0),u:s.u+(i.anzahl_uebungen||0),p:s.p+(i.anzahl_praktika||0),s:s.s+(i.anzahl_seminare||0)}),{v:0,u:0,p:0,s:0}):{v:0,u:0,p:0,s:0},ne=()=>a?.template_module?a.template_module.reduce((s,i)=>{const Y=i.modul?.lehrformen||[],j=Se=>Y.find(we=>we.kuerzel===Se)?.sws||0,ze=(i.anzahl_vorlesungen||0)*j("V"),ve=(i.anzahl_uebungen||0)*j("Ü"),ke=(i.anzahl_praktika||0)*j("P"),ye=(i.anzahl_seminare||0)*j("S");let ue=ze+ve+ke+ye;return ue===0&&i.modul?.sws_gesamt&&(ue=i.modul.sws_gesamt),s+ue},0):0;if(o)return e.jsx(ge,{maxWidth:"lg",sx:{mt:4},children:e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(pe,{})})});if(!a)return null;const U=D();return e.jsxs(ge,{maxWidth:"lg",sx:{mt:3,mb:4},children:[e.jsx(J,{sx:{p:3,mb:3},children:e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2,children:[e.jsxs(u,{display:"flex",alignItems:"flex-start",gap:2,children:[e.jsx(ae,{onClick:()=>_("/templates"),sx:{mt:.5},children:e.jsx(Ge,{})}),e.jsx(u,{children:m?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(x,{size:"small",label:"Name",value:C.name,onChange:s=>R({...C,name:s.target.value}),placeholder:T.formatSemesterTyp(a.semester_typ)}),e.jsx(x,{size:"small",label:"Beschreibung",value:C.beschreibung,onChange:s=>R({...C,beschreibung:s.target.value}),multiline:!0,rows:2}),e.jsxs(u,{sx:{display:"flex",gap:1},children:[e.jsx(V,{size:"small",variant:"contained",startIcon:e.jsx(Ue,{}),onClick:G,disabled:v,children:"Speichern"}),e.jsx(V,{size:"small",onClick:()=>W(!1),children:"Abbrechen"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{display:"flex",alignItems:"center",gap:1,children:[y(),e.jsx(t,{variant:"h5",fontWeight:600,children:a.name||T.formatSemesterTyp(a.semester_typ)}),a.ist_aktiv&&e.jsx(f,{label:"Aktiv",color:"success",size:"small"}),e.jsx(ae,{size:"small",onClick:()=>W(!0),children:e.jsx(fe,{fontSize:"small"})})]}),a.beschreibung&&e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:a.beschreibung})]})})]}),e.jsxs(u,{display:"flex",gap:1,children:[Z&&e.jsx(V,{variant:"contained",color:"primary",startIcon:e.jsx(be,{}),onClick:A,disabled:v,children:v?"Speichert...":"Änderungen speichern"}),e.jsx(V,{variant:"outlined",color:"error",startIcon:e.jsx(_e,{}),onClick:Q,children:"Löschen"})]})]})}),Z&&e.jsx(M,{severity:"warning",sx:{mb:3},children:'Sie haben ungespeicherte Änderungen. Klicken Sie auf "Änderungen speichern", um diese zu übernehmen.'}),e.jsx(J,{sx:{mb:3},children:e.jsxs(Ne,{value:z,onChange:(s,i)=>K(i),variant:"fullWidth",children:[e.jsx(re,{icon:e.jsx(de,{}),label:`Module (${a.anzahl_module})`,iconPosition:"start"}),e.jsx(re,{icon:e.jsx(Oe,{}),label:`Wunsch-Tage (${S.length})`,iconPosition:"start"}),e.jsx(re,{icon:e.jsx(Je,{}),label:"Zusatzinfos",iconPosition:"start"}),e.jsx(re,{icon:e.jsx(Qe,{}),label:"Übersicht",iconPosition:"start"})]})}),e.jsxs(J,{sx:{p:3},children:[e.jsx(oe,{value:z,index:0,children:e.jsx(sa,{templateId:a.id,module:a.template_module||[],onModuleChange:()=>w(a.id)})}),e.jsxs(oe,{value:z,index:1,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Wunsch-freie Tage"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Definieren Sie Ihre bevorzugten freien Tage für die Stundenplanung. Diese werden bei jeder neuen Planung automatisch übernommen."}),e.jsx(na,{wunschFreieTage:S,onChange:n})]}),e.jsxs(oe,{value:z,index:2,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Zusätzliche Informationen"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Allgemeine Anmerkungen und Raumbedarf, die für alle Planungen gelten."}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,label:"Anmerkungen",value:$,onChange:s=>l("anmerkungen",s.target.value),sx:{mb:3},placeholder:"Allgemeine Hinweise zur Planung, besondere Anforderungen, etc."}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,label:"Raumbedarf",value:B,onChange:s=>l("raumbedarf",s.target.value),placeholder:"Allgemeine Raumanforderungen, spezielle Ausstattung, etc."})]}),e.jsxs(oe,{value:z,index:3,children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Template-Übersicht"}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(te,{variant:"outlined",children:e.jsxs(se,{children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Statistiken"}),e.jsx(P,{sx:{my:1}}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Module:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:a.anzahl_module})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",bgcolor:"primary.50",p:.5,borderRadius:1},children:[e.jsx(t,{variant:"body2",fontWeight:600,color:"primary.main",children:"Gesamt-SWS:"}),e.jsx(t,{variant:"body2",fontWeight:700,color:"primary.main",children:ne().toFixed(1)})]}),e.jsx(P,{sx:{my:.5}}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Vorlesungen:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:U.v})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Übungen:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:U.u})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Praktika:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:U.p})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Seminare:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:U.s})]}),e.jsx(P,{sx:{my:1}}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{variant:"body2",children:"Wunsch-freie Tage:"}),e.jsx(t,{variant:"body2",fontWeight:600,children:S.length})]})]})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(te,{variant:"outlined",children:e.jsxs(se,{children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Module"}),e.jsx(P,{sx:{my:1}}),a.template_module&&a.template_module.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.template_module.map(s=>{const i=[];return s.anzahl_vorlesungen>0&&i.push(`${s.anzahl_vorlesungen}V`),s.anzahl_uebungen>0&&i.push(`${s.anzahl_uebungen}Ü`),s.anzahl_praktika>0&&i.push(`${s.anzahl_praktika}P`),s.anzahl_seminare>0&&i.push(`${s.anzahl_seminare}S`),e.jsx(f,{label:`${s.modul?.kuerzel||s.modul_id} (${i.join("+")})`,size:"small",variant:"outlined",color:"primary"},s.id)})}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"Keine Module definiert"})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(te,{variant:"outlined",children:e.jsxs(se,{children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Wunsch-freie Tage"}),e.jsx(P,{sx:{my:1}}),S.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:S.map((s,i)=>e.jsx(f,{label:`${s.wochentag} (${s.zeitraum})`,size:"small",variant:"outlined",color:s.prioritaet==="hoch"?"error":s.prioritaet==="mittel"?"warning":"default"},i))}):e.jsx(t,{variant:"body2",color:"text.secondary",children:"Keine Wunsch-freien Tage definiert"})]})})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(te,{variant:"outlined",children:e.jsxs(se,{children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Zusatzinfos"}),e.jsx(P,{sx:{my:1}}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(u,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Anmerkungen:"}),e.jsx(t,{variant:"body2",children:$||"-"})]}),e.jsxs(u,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Raumbedarf:"}),e.jsx(t,{variant:"body2",children:B||"-"})]})]})]})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(M,{severity:"info",icon:!1,children:e.jsxs(t,{variant:"caption",color:"text.secondary",children:["Erstellt: ",a.created_at?new Date(a.created_at).toLocaleString("de-DE"):"-"," | ","Zuletzt geändert: ",a.updated_at?new Date(a.updated_at).toLocaleString("de-DE"):"-"]})})})]})]})]})]})};export{ma as default};
