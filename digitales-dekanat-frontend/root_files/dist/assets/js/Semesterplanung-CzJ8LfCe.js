import{j as e,N as R,B as p,f as P,H as v,av as w,a6 as I,K as V,aY as K,P as k,a7 as N,a8 as d,ae as W,af as G,ag as H,ah as y,ai as a,aj as M,l as u,I as g,R as O,ak as Y,al as q,a4 as J,ab as Q}from"./vendor-mui-BiVZR0IW.js";import{u as U,r}from"./vendor-react-CBtCGaWm.js";import{u as X,c as Z}from"./index-ChymPdOX.js";import{u as ee}from"./planungPhaseStore-D_yYLaUh.js";import{p as h}from"./planungService-CoVGOVAB.js";import{s as C}from"./semesterService-CfIHzVdr.js";import"./vendor-utils-DTv3oRQQ.js";import"./planungPhaseService-9n5IcayC.js";const j=Z("Semesterplanung"),me=()=>{const m=U(),{user:o}=X(),{activePhase:i,fetchActivePhase:D}=ee(),[E,f]=r.useState(!1),[l,A]=r.useState(0),[c,b]=r.useState([]),[te,T]=r.useState(null),[S,z]=r.useState(null),[se,ae]=r.useState(null),[ne,re]=r.useState(!1);r.useEffect(()=>{x(),D()},[]);const x=async()=>{f(!0);try{const[t,s]=await Promise.all([C.getActiveSemester(),C.getPlanningSemester()]);if(t.success&&t.data&&T(t.data),s.success&&s.data&&z(s.data),o?.rolle==="dekan"){const n=await h.getAllPlanungen();n.success&&b(n.data||[])}else{const n=await h.getMeinePlanungen();n.success&&b(n.data||[])}}catch(t){j.error("Error loading data:",t)}finally{f(!1)}},_=()=>{if(!i){alert("Keine Planungsphase aktiv!");return}m("/semesterplanung/neu")},B=async t=>{try{(await h.submitPlanung(t)).success&&x()}catch(s){j.error("Error submitting planung:",s)}},$=async t=>{try{(await h.approvePlanung(t)).success&&x()}catch(s){j.error("Error approving planung:",s)}},L=t=>{const s={entwurf:{label:"Entwurf",color:"default"},eingereicht:{label:"Eingereicht",color:"warning"},freigegeben:{label:"Freigegeben",color:"success"},abgelehnt:{label:"Abgelehnt",color:"error"}},n=s[t]||s.entwurf;return e.jsx(Q,{label:n.label,color:n.color,size:"small"})},F=c.filter(t=>l===0?!0:l===1?t.status==="entwurf":l===2?t.status==="eingereicht":l===3?t.status==="freigegeben":!0);return e.jsxs(R,{maxWidth:"xl",children:[e.jsxs(p,{sx:{mb:4},children:[e.jsx(P,{variant:"h4",fontWeight:600,gutterBottom:!0,children:"Semesterplanung"}),e.jsx(P,{variant:"body1",color:"text.secondary",children:"Verwalten Sie Ihre Lehrveranstaltungen für das kommende Semester"})]}),i?e.jsxs(v,{severity:"success",sx:{mb:3},children:[e.jsxs(w,{children:['Planungsphase "',i.name,'" ist geöffnet']}),S&&`Für ${S.bezeichnung} | `,"Gestartet am: ",new Date(i.startdatum).toLocaleDateString("de-DE"),i.enddatum&&` | Deadline: ${new Date(i.enddatum).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}`]}):e.jsxs(v,{severity:"warning",sx:{mb:3},children:[e.jsx(w,{children:"Keine aktive Planungsphase"}),"Derzeit ist keine Planungsphase aktiv. Bitte warten Sie, bis der Dekan die nächste Phase startet."]}),E&&e.jsx(I,{sx:{mb:2}}),e.jsx(p,{sx:{mb:3},children:e.jsx(V,{variant:"contained",startIcon:e.jsx(K,{}),onClick:_,disabled:!i,children:"Neue Planung erstellen"})}),e.jsx(k,{sx:{mb:3},children:e.jsxs(N,{value:l,onChange:(t,s)=>A(s),children:[e.jsx(d,{label:`Alle (${c.length})`}),e.jsx(d,{label:`Entwurf (${c.filter(t=>t.status==="entwurf").length})`}),e.jsx(d,{label:`Eingereicht (${c.filter(t=>t.status==="eingereicht").length})`}),e.jsx(d,{label:`Freigegeben (${c.filter(t=>t.status==="freigegeben").length})`})]})}),e.jsx(W,{component:k,children:e.jsxs(G,{children:[e.jsx(H,{children:e.jsxs(y,{children:[e.jsx(a,{children:"Semester"}),o?.rolle==="dekan"&&e.jsx(a,{children:"Dozent"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Module"}),e.jsx(a,{align:"right",children:"Gesamt SWS"}),e.jsx(a,{children:"Eingereicht am"}),e.jsx(a,{align:"center",children:"Aktionen"})]})}),e.jsx(M,{children:F.map(t=>e.jsxs(y,{children:[e.jsx(a,{children:t.semester?.kuerzel||"-"}),o?.rolle==="dekan"&&e.jsx(a,{children:t.benutzer?.name_komplett||"-"}),e.jsx(a,{children:L(t.status)}),e.jsx(a,{children:t.geplante_module?.length||0}),e.jsx(a,{align:"right",children:t.gesamt_sws.toFixed(1)}),e.jsx(a,{children:t.eingereicht_am?new Date(t.eingereicht_am).toLocaleDateString("de-DE"):"-"}),e.jsxs(a,{align:"center",children:[e.jsx(u,{title:"Anzeigen",children:e.jsx(g,{size:"small",onClick:()=>m(`/semesterplanung/${t.id}`),children:e.jsx(O,{})})}),t.status==="entwurf"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{title:"Bearbeiten",children:e.jsx(g,{size:"small",onClick:()=>m(`/semesterplanung/${t.id}/edit`),children:e.jsx(Y,{})})}),e.jsx(u,{title:"Einreichen",children:e.jsx(g,{size:"small",color:"primary",onClick:()=>B(t.id),children:e.jsx(q,{})})})]}),o?.rolle==="dekan"&&t.status==="eingereicht"&&e.jsx(u,{title:"Freigeben",children:e.jsx(g,{size:"small",color:"success",onClick:()=>$(t.id),children:e.jsx(J,{})})})]})]},t.id))})]})})]})};export{me as default};
