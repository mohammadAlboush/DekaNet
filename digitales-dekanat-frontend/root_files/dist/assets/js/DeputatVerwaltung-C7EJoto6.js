import{j as e,N as X,B as i,z as F,I as D,bj as we,f as n,aw as Y,ax as ee,az as se,o as f,K as h,S as Se,bI as ye,$ as t,a0 as w,a1 as S,P as ke,a7 as Ce,a8 as ne,H as te,a9 as We,aa as De,ab as j,ac as Ae,ad as ze,bR as re,aS as le,R as ae,bQ as R,ae as Pe,af as Ee,ag as Fe,ah as M,ai as u,aj as Te,aD as N,aE as U,aF as H,D as Be,aH as K,O as g}from"./vendor-mui-BiVZR0IW.js";import{u as Ie,r as a}from"./vendor-react-CBtCGaWm.js";import{d,a as $e,D as Le}from"./deputat.types-C0Ojutn8.js";import{p as Ge}from"./planungPhaseService-BG7zO8Dx.js";import{b as Ve,c as Re,g as T}from"./index-BXi_OX1m.js";import"./vendor-utils-DTv3oRQQ.js";const ie=Re("DeputatVerwaltung");function ue(B){const{children:x,value:A,index:y,...k}=B;return e.jsx("div",{role:"tabpanel",hidden:A!==y,...k,children:A===y&&e.jsx(i,{sx:{pt:3},children:x})})}const Qe=()=>{const B=Ie(),x=Ve(s=>s.showToast),[A,y]=a.useState(!0),[k,ce]=a.useState(0),[oe,he]=a.useState([]),[v,O]=a.useState(null),[I,de]=a.useState(""),[$,xe]=a.useState([]),[L,me]=a.useState([]),[p,ge]=a.useState(null),[c,je]=a.useState(null),[r,z]=a.useState(null),[P,C]=a.useState(null),[Q,Z]=a.useState(""),[pe,E]=a.useState(!1),[l,m]=a.useState({}),[b,q]=a.useState(null);a.useEffect(()=>{(async()=>{try{const o=await Ge.getAllPhases(),_=o.phasen||[];if(he(_),_.length>0){const V=o.aktive_phase||_.find(fe=>fe.ist_aktiv);O(V?.id||_[0].id)}}catch(o){ie.error("Error loading planungsphasen:",o)}})()},[]),a.useEffect(()=>{v&&W()},[v,I]);const W=async()=>{try{y(!0);const[s,o,_,V]=await Promise.all([d.getAlleAbrechnungen(v||void 0,I||void 0),d.getEingereichte(v||void 0),d.getStatistik(v||void 0),d.getEinstellungen()]);xe(s),me(o),ge(_),je(V)}catch(s){ie.error("Error loading data:",s),x("Fehler beim Laden der Daten","error")}finally{y(!1)}},J=async s=>{if(confirm("Abrechnung wirklich genehmigen?"))try{await d.genehmigen(s.id),await W(),x("Abrechnung genehmigt","success")}catch(o){x(T(o,"Fehler beim Genehmigen"),"error")}},be=async()=>{if(P)try{await d.ablehnen(P.id,Q),C(null),Z(""),await W(),x("Abrechnung abgelehnt","success")}catch(s){x(T(s,"Fehler beim Ablehnen"),"error")}},_e=async()=>{try{await d.updateEinstellungen({...l,beschreibung:`Geändert am ${new Date().toLocaleDateString("de-DE")}`}),E(!1),await W(),x("Einstellungen gespeichert","success")}catch(s){x(T(s,"Fehler beim Speichern"),"error")}},ve=()=>{c&&m({sws_bachelor_arbeit:c.sws_bachelor_arbeit,sws_master_arbeit:c.sws_master_arbeit,sws_doktorarbeit:c.sws_doktorarbeit,sws_seminar_ba:c.sws_seminar_ba,sws_seminar_ma:c.sws_seminar_ma,sws_projekt_ba:c.sws_projekt_ba,sws_projekt_ma:c.sws_projekt_ma,max_sws_praxisseminar:c.max_sws_praxisseminar,max_sws_projektveranstaltung:c.max_sws_projektveranstaltung,max_sws_seminar_master:c.max_sws_seminar_master,max_sws_betreuung:c.max_sws_betreuung,warn_ermaessigung_ueber:c.warn_ermaessigung_ueber,default_netto_lehrverpflichtung:c.default_netto_lehrverpflichtung}),E(!0)},G=async s=>{try{q(s.id),await d.downloadPdf(s.id),x("PDF wurde heruntergeladen","success")}catch(o){x(T(o,"Fehler beim PDF-Export"),"error")}finally{q(null)}};return A&&!p?e.jsx(X,{maxWidth:"lg",sx:{mt:4},children:e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(F,{})})}):e.jsxs(X,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(i,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(D,{onClick:()=>B(-1),children:e.jsx(we,{})}),e.jsx(n,{variant:"h4",children:"Deputat-Verwaltung"})]}),e.jsxs(i,{display:"flex",gap:2,children:[e.jsxs(Y,{sx:{minWidth:200},children:[e.jsx(ee,{children:"Planungsphase"}),e.jsx(se,{value:v||"",label:"Planungsphase",onChange:s=>O(Number(s.target.value)),size:"small",children:oe.map(s=>e.jsx(f,{value:s.id,children:s.name},s.id))})]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(Se,{}),onClick:ve,children:"Einstellungen"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(ye,{}),onClick:W,children:"Aktualisieren"})]})]}),p&&e.jsxs(t,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",children:p.gesamt}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Gesamt"})]})})}),e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",children:p.entwurf}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Entwurf"})]})})}),e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{sx:{bgcolor:"info.light"},children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",children:p.eingereicht}),e.jsx(n,{variant:"body2",children:"Eingereicht"})]})})}),e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{sx:{bgcolor:"success.light"},children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",children:p.genehmigt}),e.jsx(n,{variant:"body2",children:"Genehmigt"})]})})}),e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{sx:{bgcolor:"error.light"},children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsx(n,{variant:"h4",children:p.abgelehnt}),e.jsx(n,{variant:"body2",children:"Abgelehnt"})]})})}),e.jsx(t,{item:!0,xs:6,sm:4,md:2,children:e.jsx(w,{children:e.jsxs(S,{sx:{textAlign:"center"},children:[e.jsxs(n,{variant:"h4",children:[p.quote_genehmigt,"%"]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Quote"})]})})})]}),e.jsxs(ke,{children:[e.jsxs(Ce,{value:k,onChange:(s,o)=>ce(o),children:[e.jsx(ne,{label:`Zur Genehmigung (${L.length})`}),e.jsx(ne,{label:`Alle Abrechnungen (${$.length})`})]}),e.jsx(ue,{value:k,index:0,children:e.jsx(i,{sx:{p:2},children:L.length===0?e.jsx(te,{severity:"info",children:"Keine eingereichten Abrechnungen vorhanden"}):L.map(s=>e.jsxs(We,{sx:{mb:1},children:[e.jsx(De,{expandIcon:e.jsx(Ae,{}),children:e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",pr:2,children:[e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle1",children:s.benutzer?.name_komplett||"Unbekannt"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[s.planungsphase?.name," | Eingereicht:"," ",s.eingereicht_am?new Date(s.eingereicht_am).toLocaleDateString("de-DE"):"-"]})]}),e.jsx(i,{display:"flex",alignItems:"center",gap:2,children:s.summen&&e.jsx(j,{label:`${s.summen.nettobelastung} / ${s.summen.netto_lehrverpflichtung} SWS`,color:d.getBewertungColor(s.summen.bewertung),variant:"outlined"})})]})}),e.jsx(ze,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,md:8,children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Zusammenfassung"}),s.summen&&e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[e.jsx(j,{size:"small",label:`Lehrtätigkeiten: ${s.summen.sws_lehrtaetigkeiten} SWS`}),e.jsx(j,{size:"small",label:`Lehrexport: ${s.summen.sws_lehrexport} SWS`}),e.jsx(j,{size:"small",label:`Vertretungen: ${s.summen.sws_vertretungen} SWS`}),e.jsx(j,{size:"small",label:`Betreuungen: ${s.summen.sws_betreuungen_angerechnet} SWS`}),e.jsx(j,{size:"small",color:"warning",label:`Ermäßigungen: -${s.summen.sws_ermaessigungen} SWS`})]}),s.summen?.warnungen&&s.summen.warnungen.length>0&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",color:"warning.main",gutterBottom:!0,children:"Warnungen:"}),s.summen.warnungen.map((o,_)=>e.jsx(te,{severity:"warning",sx:{mb:1},children:o},_))]}),s.bemerkungen&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:"Bemerkungen:"}),e.jsx(n,{variant:"body2",children:s.bemerkungen})]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsxs(i,{display:"flex",flexDirection:"column",gap:1,children:[e.jsx(h,{variant:"contained",color:"success",startIcon:e.jsx(re,{}),onClick:()=>J(s),fullWidth:!0,children:"Genehmigen"}),e.jsx(h,{variant:"outlined",color:"error",startIcon:e.jsx(le,{}),onClick:()=>C(s),fullWidth:!0,children:"Ablehnen"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(ae,{}),onClick:()=>z(s),fullWidth:!0,children:"Details anzeigen"}),e.jsx(h,{variant:"outlined",color:"secondary",startIcon:b===s.id?e.jsx(F,{size:20}):e.jsx(R,{}),onClick:()=>G(s),disabled:b===s.id,fullWidth:!0,children:b===s.id?"Wird erstellt...":"PDF Export"})]})})]})})]},s.id))})}),e.jsx(ue,{value:k,index:1,children:e.jsxs(i,{sx:{p:2},children:[e.jsx(i,{sx:{mb:2},children:e.jsxs(Y,{size:"small",sx:{minWidth:150},children:[e.jsx(ee,{children:"Status Filter"}),e.jsxs(se,{value:I,label:"Status Filter",onChange:s=>de(s.target.value),children:[e.jsx(f,{value:"",children:"Alle"}),e.jsx(f,{value:"entwurf",children:"Entwurf"}),e.jsx(f,{value:"eingereicht",children:"Eingereicht"}),e.jsx(f,{value:"genehmigt",children:"Genehmigt"}),e.jsx(f,{value:"abgelehnt",children:"Abgelehnt"})]})]})}),e.jsx(Pe,{children:e.jsxs(Ee,{children:[e.jsx(Fe,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Professor"}),e.jsx(u,{children:"Planungsphase"}),e.jsx(u,{children:"Status"}),e.jsx(u,{align:"right",children:"Deputat"}),e.jsx(u,{align:"right",children:"Differenz"}),e.jsx(u,{children:"Bewertung"}),e.jsx(u,{children:"Aktionen"})]})}),e.jsxs(Te,{children:[$.map(s=>e.jsxs(M,{children:[e.jsx(u,{children:s.benutzer?.name_komplett||"-"}),e.jsx(u,{children:s.planungsphase?.name||"-"}),e.jsx(u,{children:e.jsx(j,{size:"small",label:Le[s.status],color:$e[s.status]})}),e.jsx(u,{align:"right",children:s.summen?`${s.summen.nettobelastung} / ${s.summen.netto_lehrverpflichtung}`:"-"}),e.jsx(u,{align:"right",children:s.summen?`${s.summen.differenz>0?"+":""}${s.summen.differenz}`:"-"}),e.jsx(u,{children:s.summen&&e.jsx(j,{size:"small",color:d.getBewertungColor(s.summen.bewertung),label:d.getBewertungText(s.summen.bewertung)})}),e.jsxs(u,{children:[e.jsx(D,{size:"small",onClick:()=>z(s),children:e.jsx(ae,{fontSize:"small"})}),e.jsx(D,{size:"small",onClick:()=>G(s),disabled:b===s.id,children:b===s.id?e.jsx(F,{size:18}):e.jsx(R,{fontSize:"small"})}),s.status==="eingereicht"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"small",color:"success",onClick:()=>J(s),children:e.jsx(re,{fontSize:"small"})}),e.jsx(D,{size:"small",color:"error",onClick:()=>C(s),children:e.jsx(le,{fontSize:"small"})})]})]})]},s.id)),$.length===0&&e.jsx(M,{children:e.jsx(u,{colSpan:7,align:"center",children:"Keine Abrechnungen gefunden"})})]})]})})]})})]}),e.jsxs(N,{open:!!r,onClose:()=>z(null),maxWidth:"md",fullWidth:!0,children:[e.jsxs(U,{children:["Deputatsabrechnung - ",r?.benutzer?.name_komplett]}),e.jsx(H,{children:r?.summen&&e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",children:"Lehrtätigkeiten"}),e.jsxs(n,{children:["Gesamt: ",r.summen.sws_lehrtaetigkeiten," SWS"]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Praxisseminar: ",r.summen.sws_praxisseminar," (angerechnet:"," ",r.summen.sws_praxisseminar_angerechnet,")"]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Projektveranstaltung: ",r.summen.sws_projektveranstaltung," (angerechnet:"," ",r.summen.sws_projektveranstaltung_angerechnet,")"]})]}),e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"subtitle2",children:"Weitere Kategorien"}),e.jsxs(n,{variant:"body2",children:["Lehrexport: ",r.summen.sws_lehrexport," SWS"]}),e.jsxs(n,{variant:"body2",children:["Vertretungen: ",r.summen.sws_vertretungen," SWS"]}),e.jsxs(n,{variant:"body2",children:["Betreuungen: ",r.summen.sws_betreuungen_angerechnet," SWS (roh:"," ",r.summen.sws_betreuungen_roh,")"]}),e.jsxs(n,{variant:"body2",color:"warning.main",children:["Ermäßigungen: -",r.summen.sws_ermaessigungen," SWS"]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(Be,{sx:{my:2}}),e.jsxs(i,{display:"flex",justifyContent:"space-between",children:[e.jsxs(n,{variant:"h6",children:["Nettobelastung: ",r.summen.nettobelastung," SWS"]}),e.jsxs(n,{variant:"h6",children:["Soll: ",r.summen.netto_lehrverpflichtung," SWS"]}),e.jsx(j,{label:`Differenz: ${r.summen.differenz>0?"+":""}${r.summen.differenz} SWS`,color:d.getBewertungColor(r.summen.bewertung)})]})]})]})}),e.jsxs(K,{children:[e.jsx(h,{onClick:()=>z(null),children:"Schließen"}),r&&e.jsx(h,{variant:"outlined",color:"secondary",startIcon:b===r.id?e.jsx(F,{size:20}):e.jsx(R,{}),onClick:()=>G(r),disabled:b===r.id,children:b===r.id?"Wird erstellt...":"PDF Export"})]})]}),e.jsxs(N,{open:!!P,onClose:()=>C(null),children:[e.jsx(U,{children:"Abrechnung ablehnen"}),e.jsxs(H,{children:[e.jsxs(n,{gutterBottom:!0,children:["Abrechnung von ",P?.benutzer?.name_komplett," ablehnen?"]}),e.jsx(g,{label:"Ablehnungsgrund",multiline:!0,rows:3,fullWidth:!0,value:Q,onChange:s=>Z(s.target.value),sx:{mt:2}})]}),e.jsxs(K,{children:[e.jsx(h,{onClick:()=>C(null),children:"Abbrechen"}),e.jsx(h,{onClick:be,color:"error",variant:"contained",children:"Ablehnen"})]})]}),e.jsxs(N,{open:pe,onClose:()=>E(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(U,{children:"Deputats-Einstellungen"}),e.jsx(H,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"SWS für Betreuungen"})}),e.jsx(t,{item:!0,xs:6,sm:4,children:e.jsx(g,{label:"Bachelorarbeit",type:"number",fullWidth:!0,size:"small",value:l.sws_bachelor_arbeit||"",onChange:s=>m({...l,sws_bachelor_arbeit:parseFloat(s.target.value)}),inputProps:{step:.1}})}),e.jsx(t,{item:!0,xs:6,sm:4,children:e.jsx(g,{label:"Masterarbeit",type:"number",fullWidth:!0,size:"small",value:l.sws_master_arbeit||"",onChange:s=>m({...l,sws_master_arbeit:parseFloat(s.target.value)}),inputProps:{step:.1}})}),e.jsx(t,{item:!0,xs:6,sm:4,children:e.jsx(g,{label:"Doktorarbeit",type:"number",fullWidth:!0,size:"small",value:l.sws_doktorarbeit||"",onChange:s=>m({...l,sws_doktorarbeit:parseFloat(s.target.value)}),inputProps:{step:.1}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(n,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Obergrenzen (max. anrechenbare SWS)"})}),e.jsx(t,{item:!0,xs:6,sm:3,children:e.jsx(g,{label:"Praxisseminar",type:"number",fullWidth:!0,size:"small",value:l.max_sws_praxisseminar||"",onChange:s=>m({...l,max_sws_praxisseminar:parseFloat(s.target.value)}),inputProps:{step:.5}})}),e.jsx(t,{item:!0,xs:6,sm:3,children:e.jsx(g,{label:"Projektveranstaltung",type:"number",fullWidth:!0,size:"small",value:l.max_sws_projektveranstaltung||"",onChange:s=>m({...l,max_sws_projektveranstaltung:parseFloat(s.target.value)}),inputProps:{step:.5}})}),e.jsx(t,{item:!0,xs:6,sm:3,children:e.jsx(g,{label:"Seminar Master",type:"number",fullWidth:!0,size:"small",value:l.max_sws_seminar_master||"",onChange:s=>m({...l,max_sws_seminar_master:parseFloat(s.target.value)}),inputProps:{step:.5}})}),e.jsx(t,{item:!0,xs:6,sm:3,children:e.jsx(g,{label:"Betreuungen",type:"number",fullWidth:!0,size:"small",value:l.max_sws_betreuung||"",onChange:s=>m({...l,max_sws_betreuung:parseFloat(s.target.value)}),inputProps:{step:.5}})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(n,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Weitere Einstellungen"})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(g,{label:"Warnung bei Ermäßigungen über",type:"number",fullWidth:!0,size:"small",value:l.warn_ermaessigung_ueber||"",onChange:s=>m({...l,warn_ermaessigung_ueber:parseFloat(s.target.value)}),inputProps:{step:.5},helperText:"SWS"})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(g,{label:"Standard Netto-Lehrverpflichtung",type:"number",fullWidth:!0,size:"small",value:l.default_netto_lehrverpflichtung||"",onChange:s=>m({...l,default_netto_lehrverpflichtung:parseFloat(s.target.value)}),inputProps:{step:1},helperText:"SWS"})})]})}),e.jsxs(K,{children:[e.jsx(h,{onClick:()=>E(!1),children:"Abbrechen"}),e.jsx(h,{onClick:_e,variant:"contained",children:"Speichern"})]})]})]})};export{Qe as default};
