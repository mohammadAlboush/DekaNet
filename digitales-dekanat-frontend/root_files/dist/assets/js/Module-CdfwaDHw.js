import{j as e,aD as Le,aE as Ie,B as b,bH as Se,f as l,K as z,aS as en,aF as Ee,H as he,L as Ae,g as Be,k as Te,$ as s,aG as on,O as c,z as ye,aw as ee,ax as te,az as ne,o as p,D as Oe,P as Z,i as dn,b0 as et,w as jn,aH as Me,Q as mn,aL as fn,aA as We,ay as nt,l as le,I as J,bI as tt,ae as pn,af as bn,ag as vn,ah as ve,ai as w,aj as zn,aW as Xe,ab as N,b3 as Pe,aY as Ce,ak as be,a7 as yn,a8 as Q,aZ as Ne,b4 as _e,N as cn,am as De,a0 as Qe,a1 as Ye,a$ as hn,b7 as xn,ap as rt,R as st}from"./vendor-mui-BiVZR0IW.js";import{r as d,b as ze}from"./vendor-react-CBtCGaWm.js";import{m as k}from"./modulService-C21jSBeL.js";import{c as nn,a as de,h as ce,g as D,l as lt,u as it}from"./index-BXi_OX1m.js";import{d as at}from"./dozentService-Bp4gwnVO.js";import{c as ut}from"./vendor-utils-DTv3oRQQ.js";const A=nn("ModulVerwaltung");class ot{async getModuleMitDozenten(i){try{A.debug(" Fetching module with params:",i);const h=new URLSearchParams;i?.po_id&&h.append("po_id",i.po_id.toString()),i?.nur_aktive!==void 0&&h.append("nur_aktive",i.nur_aktive.toString());const g=`/modul-verwaltung/${h.toString()?`?${h}`:""}`;A.debug(" Request URL:",g);const j=await de.get(g);return A.debug(" Response:",{success:j.data.success,moduleCount:j.data.data?.length||0}),j.data}catch(h){throw A.error(" Error fetching module:",h),new Error(ce(h))}}async addDozentToModul(i,h){try{A.debug(" Adding dozent to modul:",i,h);const g=await de.post(`/modul-verwaltung/${i}/dozenten`,h);return A.debug(" ✓ Dozent added to modul"),g.data}catch(g){throw A.error(" Error adding dozent:",g),new Error(ce(g))}}async removeDozentFromModul(i,h){try{A.debug(" Removing dozent:",i);const g=await de.delete(`/modul-verwaltung/dozenten/${i}`,{data:h});return A.debug(" ✓ Dozent removed from modul"),g.data}catch(g){throw A.error(" Error removing dozent:",g),new Error(ce(g))}}async replaceDozent(i,h){try{A.debug(" Replacing dozent:",i,h);const g=await de.put(`/modul-verwaltung/dozenten/${i}`,h);return A.debug(" ✓ Dozent replaced"),g.data}catch(g){throw A.error(" Error replacing dozent:",g),new Error(ce(g))}}async bulkTransferModule(i){try{A.debug(" Bulk transfer:",i);const h=await de.post("/modul-verwaltung/bulk-transfer",i);return A.debug(" ✓ Bulk transfer completed:",h.data.data),h.data}catch(h){throw A.error(" Error in bulk transfer:",h),new Error(ce(h))}}async getAuditLog(i){try{A.debug(" Fetching audit log with params:",i);const h=new URLSearchParams;i?.modul_id&&h.append("modul_id",i.modul_id.toString()),i?.dozent_id&&h.append("dozent_id",i.dozent_id.toString()),i?.limit&&h.append("limit",i.limit.toString());const g=`/modul-verwaltung/audit-log${h.toString()?`?${h}`:""}`;A.debug(" Request URL:",g);const j=await de.get(g);return A.debug(" Audit log entries:",j.data.data?.length||0),j.data}catch(h){throw A.error(" Error fetching audit log:",h),new Error(ce(h))}}}const wn=new ot;class dt{async getAll(){try{return(await de.get("/pruefungsordnungen/")).data}catch(i){throw new Error(ce(i))}}async getById(i){try{return(await de.get(`/pruefungsordnungen/${i}`)).data}catch(h){throw new Error(ce(h))}}async getModules(i,h){try{const g=h?{turnus:h}:{};return(await de.get(`/pruefungsordnungen/${i}/module`,{params:g})).data}catch(g){throw new Error(ce(g))}}}const ct=new dt,gn=nn("BulkTransferDialog"),ht=({open:v,onClose:i,onSuccess:h,module:g})=>{const[j,_]=d.useState(!1),[x,xe]=d.useState(!1),[ie,re]=d.useState(!1),[m,B]=d.useState(null),[C,O]=d.useState([]),[Y,G]=d.useState([]),[y,r]=d.useState(null),[o,$]=d.useState(null),[K,q]=d.useState(null),[U,S]=d.useState(null),[I,T]=d.useState("verantwortlich"),[R,E]=d.useState([]),[se,M]=d.useState("");d.useEffect(()=>{v&&(ae(),V(),r(null))},[v]),d.useEffect(()=>{if(o){const t=g.filter(a=>a.dozenten.some(f=>f.id===o.id&&f.rolle===I)).map(a=>a.id);E(t)}else E([])},[o,I,g]);const ae=async()=>{xe(!0);try{const t=await at.getAllDozenten({aktiv:!0});t.success&&O(t.data||[])}catch(t){gn.error("Error loading dozenten:",{error:t})}finally{xe(!1)}},V=async()=>{re(!0);try{const t=await ct.getAll();t.success&&t.data&&(G(t.data),t.data.length>0&&!U&&S(t.data[0].id))}catch(t){gn.error("Error loading Prüfungsordnungen:",{error:t})}finally{re(!1)}},L=()=>{$(null),q(null),S(Y.length>0?Y[0].id:null),T("verantwortlich"),E([]),M(""),B(null),r(null)},P=()=>{L(),i()},ue=t=>{E(a=>a.includes(t)?a.filter(f=>f!==t):[...a,t])},we=async()=>{if(!o||!K||!U||R.length===0){B("Bitte füllen Sie alle Pflichtfelder aus und wählen Sie mindestens ein Modul");return}if(o.id===K.id){B("Von-Dozent und Zu-Dozent müssen unterschiedlich sein");return}_(!0),B(null);try{const t=await wn.bulkTransferModule({modul_ids:R,von_dozent_id:o.id,zu_dozent_id:K.id,po_id:U,rolle:I,bemerkung:se||void 0});t.success&&t.data?(r(t.data),t.data.fehlgeschlagen_count===0&&setTimeout(()=>{h(),P()},2e3)):B(t.message||"Fehler beim Übertragen der Module")}catch(t){B(D(t,"Ein Fehler ist aufgetreten"))}finally{_(!1)}},Fe=o!==null&&K!==null&&U!==null&&R.length>0,W=g.filter(t=>t.dozenten.some(a=>a.id===o?.id&&a.rolle===I));return e.jsxs(Le,{open:v,onClose:P,maxWidth:"md",fullWidth:!0,children:[e.jsx(Ie,{children:e.jsxs(b,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(b,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Se,{}),e.jsx(l,{variant:"h6",children:"Bulk Transfer - Module übertragen"})]}),e.jsx(z,{onClick:P,size:"small",children:e.jsx(en,{})})]})}),e.jsxs(Ee,{dividers:!0,children:[m&&e.jsx(he,{severity:"error",sx:{mb:2},onClose:()=>B(null),children:m}),y&&e.jsxs(he,{severity:y.fehlgeschlagen_count===0?"success":"warning",sx:{mb:2},children:[e.jsxs(l,{variant:"body2",fontWeight:"bold",children:[y.erfolgreich_count," von ",y.gesamt," Modulen erfolgreich übertragen"]}),y.fehlgeschlagen_count>0&&e.jsxs(b,{sx:{mt:1},children:[e.jsx(l,{variant:"caption",children:"Fehler:"}),e.jsx(Ae,{dense:!0,children:y.fehlgeschlagen.map((t,a)=>e.jsx(Be,{dense:!0,children:e.jsx(Te,{primary:`Modul ${t.modul_id}: ${t.fehler}`,primaryTypographyProps:{variant:"caption"}})},a))})]})]}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(on,{options:C,getOptionLabel:t=>t.name_komplett,value:o,onChange:(t,a)=>$(a),loading:x,disabled:j||!!y,renderInput:t=>e.jsx(c,{...t,label:"Von Dozent *",placeholder:"Aktueller Dozent...",InputProps:{...t.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[x?e.jsx(ye,{color:"inherit",size:20}):null,t.InputProps.endAdornment]})}})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(on,{options:C.filter(t=>t.id!==o?.id),getOptionLabel:t=>t.name_komplett,value:K,onChange:(t,a)=>q(a),loading:x,disabled:j||!!y,renderInput:t=>e.jsx(c,{...t,label:"Zu Dozent *",placeholder:"Neuer Dozent...",InputProps:{...t.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[x?e.jsx(ye,{color:"inherit",size:20}):null,t.InputProps.endAdornment]})}})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(ee,{fullWidth:!0,required:!0,disabled:j||!!y||ie,children:[e.jsx(te,{children:"Prüfungsordnung"}),e.jsx(ne,{value:U||"",label:"Prüfungsordnung",onChange:t=>S(t.target.value),children:ie?e.jsx(p,{disabled:!0,children:"Lädt..."}):Y.length===0?e.jsx(p,{disabled:!0,children:"Keine POs verfügbar"}):Y.map(t=>e.jsxs(p,{value:t.id,children:[t.po_jahr,t.gueltig_bis&&` (gültig bis ${new Date(t.gueltig_bis).toLocaleDateString("de-DE")})`]},t.id))})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(ee,{fullWidth:!0,required:!0,disabled:j||!!y,children:[e.jsx(te,{children:"Rolle"}),e.jsxs(ne,{value:I,label:"Rolle",onChange:t=>T(t.target.value),children:[e.jsx(p,{value:"verantwortlich",children:"Verantwortlich"}),e.jsx(p,{value:"mitwirkend",children:"Mitwirkend"}),e.jsx(p,{value:"vertreter",children:"Vertreter"}),e.jsx(p,{value:"pruefend",children:"Prüfend"})]})]})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(Oe,{})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsxs(l,{variant:"subtitle2",gutterBottom:!0,children:["Module auswählen (",R.length," ausgewählt)"]}),W.length===0?e.jsxs(he,{severity:"info",children:[o.name_komplett,' hat keine Module mit der Rolle "',I,'"']}):e.jsx(Z,{variant:"outlined",sx:{maxHeight:300,overflow:"auto"},children:e.jsx(Ae,{dense:!0,children:W.map(t=>e.jsxs(Be,{button:!0,onClick:()=>!j&&!y&&ue(t.id),disabled:j||!!y,children:[e.jsx(dn,{children:e.jsx(et,{edge:"start",checked:R.includes(t.id),disabled:j||!!y})}),e.jsx(dn,{children:e.jsx(jn,{})}),e.jsx(Te,{primary:`${t.kuerzel} - ${t.bezeichnung_de}`,secondary:`${t.dozenten.length} Dozent(en)`})]},t.id))})})]})]}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Bemerkung (optional)",placeholder:"z.B. 'Workload-Ausgleich WS25/26'",value:se,onChange:t=>M(t.target.value),disabled:j||!!y})}),o&&K&&R.length>0&&!y&&e.jsx(s,{item:!0,xs:12,children:e.jsxs(he,{severity:"info",children:[e.jsx(l,{variant:"body2",fontWeight:"bold",children:"Vorschau:"}),e.jsxs(l,{variant:"caption",children:[R.length," Module werden von"," ",e.jsx("strong",{children:o.name_komplett})," zu"," ",e.jsx("strong",{children:K.name_komplett})," übertragen (Rolle: ",I,")"]})]})})]})]}),e.jsxs(Me,{children:[e.jsx(z,{onClick:P,disabled:j,children:y?"Schließen":"Abbrechen"}),!y&&e.jsx(z,{variant:"contained",onClick:we,disabled:j||!Fe,startIcon:j?e.jsx(ye,{size:20}):e.jsx(Se,{}),children:j?"Wird übertragen...":`${R.length} Module übertragen`})]})]})},xt=()=>{const[v,i]=d.useState(!1),[h,g]=d.useState(null),[j,_]=d.useState([]),[x]=d.useState(""),[xe]=d.useState(""),[ie,re]=d.useState(100),[m,B]=d.useState("");d.useEffect(()=>{C()},[]);const C=async()=>{i(!0),g(null);try{const o=await wn.getAuditLog({modul_id:x||void 0,dozent_id:xe||void 0,limit:ie});o.success?_(o.data||[]):g(o.message||"Fehler beim Laden des Audit Logs")}catch(o){g(D(o,"Ein Fehler ist aufgetreten"))}finally{i(!1)}},O=ze.useMemo(()=>{if(!m)return j;const o=m.toLowerCase();return j.filter($=>$.modul?.kuerzel.toLowerCase().includes(o)||$.modul?.bezeichnung_de.toLowerCase().includes(o)||$.alter_dozent?.name.toLowerCase().includes(o)||$.neuer_dozent?.name.toLowerCase().includes(o)||$.geaendert_von?.name.toLowerCase().includes(o))},[j,m]),Y=o=>{switch(o){case"dozent_hinzugefuegt":return e.jsx(Ce,{color:"success"});case"dozent_entfernt":return e.jsx(Pe,{color:"error"});case"dozent_ersetzt":return e.jsx(Se,{color:"primary"});default:return e.jsx(Xe,{})}},G=o=>{switch(o){case"dozent_hinzugefuegt":return"Hinzugefügt";case"dozent_entfernt":return"Entfernt";case"dozent_ersetzt":return"Ersetzt";default:return o}},y=o=>{const $={dozent_hinzugefuegt:"success",dozent_entfernt:"error",dozent_ersetzt:"primary"};return e.jsx(N,{label:G(o),size:"small",color:$[o]||"default",icon:Y(o)})},r=o=>{try{const $=new Date(o);return ut($,"dd.MM.yyyy HH:mm",{locale:lt})}catch{return o}};return e.jsxs(b,{children:[e.jsx(Z,{elevation:2,sx:{p:3,mb:3},children:e.jsxs(s,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(c,{fullWidth:!0,variant:"outlined",placeholder:"Suche in Audit Log...",value:m,onChange:o=>B(o.target.value),InputProps:{startAdornment:e.jsx(mn,{position:"start",children:e.jsx(fn,{})})}})}),e.jsx(s,{item:!0,xs:12,md:2,children:e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Limit"}),e.jsxs(ne,{value:ie,label:"Limit",onChange:o=>re(o.target.value),children:[e.jsx(p,{value:50,children:"50 Einträge"}),e.jsx(p,{value:100,children:"100 Einträge"}),e.jsx(p,{value:200,children:"200 Einträge"}),e.jsx(p,{value:500,children:"500 Einträge"})]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(We,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(z,{variant:"outlined",startIcon:e.jsx(nt,{}),onClick:C,children:"Filter anwenden"}),e.jsx(le,{title:"Aktualisieren",children:e.jsx(J,{onClick:C,color:"primary",children:e.jsx(tt,{})})})]})})]})}),h&&e.jsx(he,{severity:"error",sx:{mb:2},onClose:()=>g(null),children:h}),e.jsxs(Z,{elevation:2,children:[e.jsx(pn,{children:e.jsxs(bn,{children:[e.jsx(vn,{children:e.jsxs(ve,{children:[e.jsx(w,{children:e.jsx("strong",{children:"Zeitstempel"})}),e.jsx(w,{children:e.jsx("strong",{children:"Aktion"})}),e.jsx(w,{children:e.jsx("strong",{children:"Modul"})}),e.jsx(w,{children:e.jsx("strong",{children:"Alter Dozent"})}),e.jsx(w,{children:e.jsx("strong",{children:"Neuer Dozent"})}),e.jsx(w,{children:e.jsx("strong",{children:"Rolle"})}),e.jsx(w,{children:e.jsx("strong",{children:"Geändert von"})}),e.jsx(w,{children:e.jsx("strong",{children:"Bemerkung"})})]})}),e.jsx(zn,{children:v?e.jsx(ve,{children:e.jsx(w,{colSpan:8,align:"center",children:e.jsx(b,{py:4,children:e.jsx(ye,{})})})}):O.length===0?e.jsx(ve,{children:e.jsx(w,{colSpan:8,align:"center",children:e.jsxs(b,{py:4,children:[e.jsx(Xe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Keine Audit Log Einträge gefunden"})]})})}):O.map(o=>e.jsxs(ve,{hover:!0,children:[e.jsx(w,{children:e.jsx(l,{variant:"body2",children:r(o.created_at)})}),e.jsx(w,{children:y(o.aktion)}),e.jsx(w,{children:o.modul?e.jsxs(b,{children:[e.jsx(l,{variant:"body2",fontWeight:"bold",children:o.modul.kuerzel}),e.jsx(l,{variant:"caption",color:"text.secondary",children:o.modul.bezeichnung_de})]}):e.jsx(l,{variant:"caption",color:"text.secondary",children:"N/A"})}),e.jsx(w,{children:o.alter_dozent?e.jsxs(b,{children:[e.jsx(l,{variant:"body2",children:o.alter_dozent.name}),o.alte_rolle&&e.jsxs(l,{variant:"caption",color:"text.secondary",children:["(",o.alte_rolle,")"]})]}):e.jsx(l,{variant:"caption",color:"text.secondary",children:"-"})}),e.jsx(w,{children:o.neuer_dozent?e.jsxs(b,{children:[e.jsx(l,{variant:"body2",children:o.neuer_dozent.name}),o.neue_rolle&&e.jsxs(l,{variant:"caption",color:"text.secondary",children:["(",o.neue_rolle,")"]})]}):e.jsx(l,{variant:"caption",color:"text.secondary",children:"-"})}),e.jsx(w,{children:o.neue_rolle||o.alte_rolle||"-"}),e.jsx(w,{children:o.geaendert_von?e.jsx(l,{variant:"body2",children:o.geaendert_von.name}):e.jsx(l,{variant:"caption",color:"text.secondary",children:"System"})}),e.jsx(w,{children:o.bemerkung?e.jsx(le,{title:o.bemerkung,children:e.jsx(l,{variant:"caption",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:o.bemerkung})}):e.jsx(l,{variant:"caption",color:"text.secondary",children:"-"})})]},o.id))})]})}),e.jsx(b,{sx:{p:2,borderTop:1,borderColor:"divider"},children:e.jsxs(l,{variant:"caption",color:"text.secondary",children:[O.length," von ",j.length," Einträgen"]})})]})]})},$e=ze.memo(({children:v,value:i,index:h})=>e.jsx("div",{hidden:i!==h,style:{padding:"16px 0"},children:i===h&&v}));function gt({open:v,modul:i,onClose:h,onSaveSuccess:g,onSaveBasics:j,onSavePruefung:_,onSaveLernergebnisse:x,onSaveVoraussetzungen:xe,onSaveArbeitsaufwand:ie,onAddLiteratur:re,onDeleteLiteratur:m}){const[B,C]=d.useState(0),[O,Y]=d.useState(!1),[G,y]=d.useState(null),r=d.useMemo(()=>({bezeichnung_de:i?.bezeichnung_de||"",bezeichnung_en:i?.bezeichnung_en||"",untertitel:i?.untertitel||"",leistungspunkte:i?.leistungspunkte||5,turnus:i?.turnus||"WiSe",dauer_semester:i?.dauer_semester||1,sprache:i?.sprache||"Deutsch",gruppengroesse:i?.gruppengroesse||"",teilnehmerzahl:i?.teilnehmerzahl||"",anmeldemodalitaeten:i?.anmeldemodalitaeten||""}),[i]),o=d.useMemo(()=>({pruefungsform:i?.pruefung?.pruefungsform||"",pruefungsdauer_minuten:i?.pruefung?.dauer_minuten||i?.pruefung?.pruefungsdauer_minuten||"",benotung:i?.pruefung?.benotung||"",pruefungsleistungen:i?.pruefung?.pruefungsleistungen||""}),[i?.pruefung]),$=d.useMemo(()=>({lernziele:i?.lernergebnisse?.lernziele||"",kompetenzen:i?.lernergebnisse?.kompetenzen||"",inhalt:i?.lernergebnisse?.inhalt||""}),[i?.lernergebnisse]),K=d.useMemo(()=>({formal:i?.voraussetzungen?.formal||"",empfohlen:i?.voraussetzungen?.empfohlen||"",inhaltlich:i?.voraussetzungen?.inhaltlich||""}),[i?.voraussetzungen]),q=Array.isArray(i?.arbeitsaufwand)?i.arbeitsaufwand[0]:i?.arbeitsaufwand,U=d.useMemo(()=>({kontaktzeit_stunden:q?.kontaktzeit_stunden||q?.kontaktzeit||0,selbststudium_stunden:q?.selbststudium_stunden||q?.selbststudium||0,pruefungsvorbereitung_stunden:q?.pruefungsvorbereitung_stunden||q?.pruefungsvorbereitung||0,gesamt_stunden:q?.gesamt_stunden||q?.gesamt||0}),[q]),[S,I]=d.useState(r),[T,R]=d.useState(o),[E,se]=d.useState($),[M,ae]=d.useState(K),[V,L]=d.useState(U),[P,ue]=d.useState({titel:"",autoren:"",verlag:"",jahr:""});d.useEffect(()=>{v&&i&&(I(r),R(o),se($),ae(K),L(U),C(0),y(null))},[v,i,r,o,$,K,U]);const we=async()=>{if(!i?.id)return;Y(!0),y(null);const t=[],a=[];try{try{await j(S),a.push("Basisdaten")}catch(f){t.push("Basisdaten: "+D(f,"Fehler"))}try{await _({pruefungsform:T.pruefungsform||null,pruefungsdauer_minuten:T.pruefungsdauer_minuten?parseInt(String(T.pruefungsdauer_minuten)):null,benotung:T.benotung||null,pruefungsleistungen:T.pruefungsleistungen||null}),a.push("Prüfung")}catch(f){t.push("Pruefung: "+D(f,"Fehler"))}try{await x(E),a.push("Lernergebnisse")}catch(f){t.push("Lernergebnisse: "+D(f,"Fehler"))}try{await xe(M),a.push("Voraussetzungen")}catch(f){t.push("Voraussetzungen: "+D(f,"Fehler"))}try{await ie(V),a.push("Arbeitsaufwand")}catch(f){t.push("Arbeitsaufwand: "+D(f,"Fehler"))}t.length===0?(y({type:"success",text:"Alle Daten gespeichert!"}),setTimeout(async()=>{g&&await g(),h()},800)):a.length>0?y({type:"error",text:`Gespeichert: ${a.join(", ")}. Fehler: ${t.join("; ")}`}):y({type:"error",text:t.join("; ")})}catch(f){y({type:"error",text:D(f,"Unbekannter Fehler")})}finally{Y(!1)}},Fe=async()=>{if(!(!P.titel||!re))try{await re(P),ue({titel:"",autoren:"",verlag:"",jahr:""}),y({type:"success",text:"Literatur hinzugefügt"})}catch(t){y({type:"error",text:D(t)})}};if(!i)return null;const W=i||{};return e.jsxs(Le,{open:v,onClose:h,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Ie,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(be,{color:"primary"}),e.jsxs(l,{variant:"h6",children:[W.kuerzel," bearbeiten"]})]}),e.jsx(J,{onClick:h,size:"small",children:e.jsx(en,{})})]}),G&&e.jsx(he,{severity:G.type,sx:{mx:2},onClose:()=>y(null),children:G.text}),e.jsxs(Ee,{dividers:!0,sx:{p:2},children:[e.jsxs(yn,{value:B,onChange:(t,a)=>C(a),sx:{borderBottom:1,borderColor:"divider",mb:2},children:[e.jsx(Q,{label:"Basis"}),e.jsx(Q,{label:"Prüfung"}),e.jsx(Q,{label:"Lernziele"}),e.jsx(Q,{label:"Literatur"}),e.jsx(Q,{label:"Info"})]}),e.jsx($e,{value:B,index:0,children:e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,label:"Bezeichnung (DE)",value:S.bezeichnung_de,onChange:t=>I({...S,bezeichnung_de:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,label:"Bezeichnung (EN)",value:S.bezeichnung_en,onChange:t=>I({...S,bezeichnung_en:t.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Untertitel",value:S.untertitel,onChange:t=>I({...S,untertitel:t.target.value})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"LP",type:"number",value:S.leistungspunkte,onChange:t=>I({...S,leistungspunkte:parseInt(t.target.value)||0})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Turnus"}),e.jsxs(ne,{value:S.turnus,label:"Turnus",onChange:t=>I({...S,turnus:t.target.value}),children:[e.jsx(p,{value:"WiSe",children:"Wintersemester"}),e.jsx(p,{value:"SoSe",children:"Sommersemester"}),e.jsx(p,{value:"WiSe/SoSe",children:"Jedes Semester"})]})]})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Semester",type:"number",value:S.dauer_semester,onChange:t=>I({...S,dauer_semester:parseInt(t.target.value)||1})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Sprache"}),e.jsxs(ne,{value:S.sprache,label:"Sprache",onChange:t=>I({...S,sprache:t.target.value}),children:[e.jsx(p,{value:"Deutsch",children:"Deutsch"}),e.jsx(p,{value:"Englisch",children:"Englisch"}),e.jsx(p,{value:"Deutsch/Englisch",children:"DE/EN"})]})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Gruppengröße",value:S.gruppengroesse,onChange:t=>I({...S,gruppengroesse:t.target.value})})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Teilnehmerzahl",value:S.teilnehmerzahl,onChange:t=>I({...S,teilnehmerzahl:t.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Anmeldemodalitäten",value:S.anmeldemodalitaeten,onChange:t=>I({...S,anmeldemodalitaeten:t.target.value})})})]})}),e.jsx($e,{value:B,index:1,children:e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{fullWidth:!0,label:"Prüfungsform",value:T.pruefungsform,placeholder:"z.B. Klausur, Hausarbeit",onChange:t=>R({...T,pruefungsform:t.target.value})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Dauer (Min)",type:"number",value:T.pruefungsdauer_minuten,onChange:t=>R({...T,pruefungsdauer_minuten:t.target.value})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Benotung"}),e.jsxs(ne,{value:T.benotung,label:"Benotung",onChange:t=>R({...T,benotung:t.target.value}),children:[e.jsx(p,{value:"",children:"-"}),e.jsx(p,{value:"benotet",children:"benotet"}),e.jsx(p,{value:"unbenotet",children:"unbenotet"})]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Prüfungsleistungen",value:T.pruefungsleistungen,onChange:t=>R({...T,pruefungsleistungen:t.target.value})})})]})}),e.jsx($e,{value:B,index:2,children:e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Lernziele",value:E.lernziele,onChange:t=>se({...E,lernziele:t.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Kompetenzen",value:E.kompetenzen,onChange:t=>se({...E,kompetenzen:t.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Inhalt",value:E.inhalt,onChange:t=>se({...E,inhalt:t.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(Oe,{sx:{my:1},children:e.jsx(N,{label:"Voraussetzungen",size:"small"})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Formal",value:M.formal,onChange:t=>ae({...M,formal:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Empfohlen",value:M.empfohlen,onChange:t=>ae({...M,empfohlen:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Inhaltlich",value:M.inhaltlich,onChange:t=>ae({...M,inhaltlich:t.target.value})})})]})}),e.jsxs($e,{value:B,index:3,children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Literaturliste"}),i.literatur?.length>0?e.jsx(Ae,{dense:!0,sx:{bgcolor:"grey.50",borderRadius:1,mb:2},children:i.literatur.map((t,a)=>e.jsxs(Be,{children:[e.jsx(Te,{primary:t.titel,secondary:[t.autoren,t.verlag,t.jahr].filter(Boolean).join(" - ")}),m&&e.jsx(Ne,{children:e.jsx(J,{size:"small",onClick:()=>m(t.id),children:e.jsx(Pe,{fontSize:"small"})})})]},a))}):e.jsx(l,{color:"text.secondary",sx:{mb:2},children:"Keine Literatur vorhanden"}),e.jsxs(Z,{variant:"outlined",sx:{p:2},children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Neue Literatur"}),e.jsxs(s,{container:!0,spacing:1,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{size:"small",fullWidth:!0,label:"Titel",value:P.titel,onChange:t=>ue({...P,titel:t.target.value})})}),e.jsx(s,{item:!0,xs:4,children:e.jsx(c,{size:"small",fullWidth:!0,label:"Autor(en)",value:P.autoren,onChange:t=>ue({...P,autoren:t.target.value})})}),e.jsx(s,{item:!0,xs:4,children:e.jsx(c,{size:"small",fullWidth:!0,label:"Verlag",value:P.verlag,onChange:t=>ue({...P,verlag:t.target.value})})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(c,{size:"small",fullWidth:!0,label:"Jahr",value:P.jahr,onChange:t=>ue({...P,jahr:t.target.value})})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(z,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:Fe,disabled:!P.titel,children:"Hinzufügen"})})]})]})]}),e.jsxs($e,{value:B,index:4,children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Arbeitsaufwand (Stunden)"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Kontaktzeit",type:"number",value:V.kontaktzeit_stunden,onChange:t=>L({...V,kontaktzeit_stunden:parseInt(t.target.value)||0})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Selbststudium",type:"number",value:V.selbststudium_stunden,onChange:t=>L({...V,selbststudium_stunden:parseInt(t.target.value)||0})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Prüfungsvorbereitung",type:"number",value:V.pruefungsvorbereitung_stunden,onChange:t=>L({...V,pruefungsvorbereitung_stunden:parseInt(t.target.value)||0})})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(c,{fullWidth:!0,label:"Gesamt",type:"number",value:V.gesamt_stunden,onChange:t=>L({...V,gesamt_stunden:parseInt(t.target.value)||0})})})]}),e.jsx(Oe,{sx:{my:3}}),e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Modul-Info"}),e.jsxs(s,{container:!0,spacing:1,children:[e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(N,{label:`ID: ${W.id}`,size:"small"})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(N,{label:`Kürzel: ${W.kuerzel}`,size:"small"})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(N,{label:`PO: ${W.po_id}`,size:"small"})}),e.jsx(s,{item:!0,xs:6,md:3,children:e.jsx(N,{label:`LP: ${W.leistungspunkte}`,size:"small"})})]}),i.lehrformen?.length>0&&e.jsxs(b,{sx:{mt:2},children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Lehrformen"}),i.lehrformen.map((t,a)=>e.jsx(N,{label:`${t.bezeichnung||t.lehrform?.bezeichnung}: ${t.sws} SWS`,size:"small",sx:{mr:1,mb:1}},a))]}),(i.dozenten?.verantwortliche?.length>0||i.dozenten?.lehrpersonen?.length>0)&&e.jsxs(b,{sx:{mt:2},children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Dozenten"}),i.dozenten?.verantwortliche?.map((t,a)=>e.jsx(N,{label:`${t.name_komplett||t.name} (V)`,size:"small",color:"primary",sx:{mr:1,mb:1}},`v${a}`)),i.dozenten?.lehrpersonen?.map((t,a)=>e.jsx(N,{label:t.name_komplett||t.name,size:"small",sx:{mr:1,mb:1}},`l${a}`))]})]})]}),e.jsxs(Me,{sx:{px:2,py:1.5},children:[e.jsx(z,{onClick:h,children:"Abbrechen"}),e.jsx(z,{variant:"contained",onClick:we,disabled:O,startIcon:O?e.jsx(ye,{size:18}):e.jsx(_e,{}),children:O?"Speichert...":"Speichern"})]})]})}const Re=nn("Module"),pe=ze.memo(function(i){const{children:h,value:g,index:j,loaded:_=!0,...x}=i;return!_&&g!==j?null:e.jsx("div",{role:"tabpanel",hidden:g!==j,...x,children:g===j&&e.jsx(b,{sx:{py:3},children:h})})}),jt=ze.memo(function({modul:i,canEdit:h,onViewDetails:g,onEdit:j,onDelete:_}){return e.jsxs(ve,{hover:!0,sx:{cursor:"pointer"},onClick:()=>g(i.id),children:[e.jsx(w,{children:e.jsx(N,{label:i.kuerzel,color:"primary",variant:"outlined",size:"small"})}),e.jsxs(w,{children:[e.jsx(l,{variant:"body2",fontWeight:500,children:i.bezeichnung_de}),i.bezeichnung_en&&e.jsx(l,{variant:"caption",color:"text.secondary",children:i.bezeichnung_en})]}),e.jsx(w,{align:"center",children:e.jsx(N,{label:i.leistungspunkte,size:"small",color:"success",variant:"outlined"})}),e.jsx(w,{align:"center",children:e.jsx(l,{variant:"body2",children:i.sws_gesamt})}),e.jsx(w,{children:e.jsx(N,{label:i.turnus,size:"small",variant:"outlined"})}),e.jsxs(w,{align:"center",onClick:x=>x.stopPropagation(),children:[e.jsx(le,{title:"Details anzeigen",children:e.jsx(J,{size:"small",onClick:()=>g(i.id),children:e.jsx(st,{})})}),h&&e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Bearbeiten",children:e.jsx(J,{size:"small",color:"primary",onClick:()=>j(i),children:e.jsx(be,{})})}),e.jsx(le,{title:"Löschen",children:e.jsx(J,{size:"small",color:"error",onClick:()=>_(i),children:e.jsx(Pe,{})})})]})]})]})},(v,i)=>v.modul.id===i.modul.id&&v.modul.kuerzel===i.modul.kuerzel&&v.modul.bezeichnung_de===i.modul.bezeichnung_de&&v.modul.bezeichnung_en===i.modul.bezeichnung_en&&v.modul.leistungspunkte===i.modul.leistungspunkte&&v.modul.sws_gesamt===i.modul.sws_gesamt&&v.modul.turnus===i.modul.turnus&&v.canEdit===i.canEdit),yt=()=>{const{user:v,isAuthenticated:i}=it(),h=ze.useMemo(()=>v?typeof v.rolle=="string"?v.rolle==="dekan":v.rolle?.name==="dekan":!1,[v]),g=ze.useCallback(n=>{if(!v||!n)return Re.debug("isModulverantwortlicher: false - no user or modul"),!1;if(!v.dozent_id)return Re.debug("isModulverantwortlicher: false - user has no dozent_id",{user:v}),!1;if(n.dozenten&&Array.isArray(n.dozenten)){const u=n.dozenten.map(oe=>({dozent_id:oe.dozent_id,rolle:oe.rolle,name:oe.name_komplett||oe.name_kurz||`${oe.vorname||""} ${oe.nachname||""}`.trim()})),X=n.dozenten.some(oe=>{if(oe.dozent_id!==v.dozent_id)return!1;const un=oe.rolle?.toLowerCase()||"";return un==="verantwortlicher"||un==="modulverantwortlicher"});return Re.debug("isModulverantwortlicher check:",{modulId:n.id,modulName:n.kuerzel,userDozentId:v.dozent_id,dozentenWithRoles:u,modulDozenten:n.dozenten,isVerantwortlicher:X}),X}return Re.debug("isModulverantwortlicher: false - no dozenten array"),!1},[v]),j=ze.useCallback(n=>h||g(n),[h,g]),[_,x]=d.useState(!1),[xe,ie]=d.useState(!0),[re,m]=d.useState(null),[B,C]=d.useState(null),[O,Y]=d.useState([]),[G,y]=d.useState(""),[r,o]=d.useState(null),[$,K]=d.useState(!1),[q,U]=d.useState(!1),[S,I]=d.useState(!1),[T,R]=d.useState(!1),[E,se]=d.useState(0),[M,ae]=d.useState({0:!0}),[V,L]=d.useState(null),[P,ue]=d.useState([]),[we,Fe]=d.useState([]),[W,t]=d.useState({kuerzel:"",po_id:1,bezeichnung_de:"",bezeichnung_en:"",untertitel:"",leistungspunkte:5,turnus:"WiSe",gruppengroesse:"",teilnehmerzahl:"",anmeldemodalitaeten:""}),[a,f]=d.useState({}),[ge,He]=d.useState({lehrform_id:"",sws:2}),[je,Ge]=d.useState({dozent_id:"",rolle:"lehrperson"}),[F,me]=d.useState({titel:"",autoren:"",verlag:"",jahr:"",isbn:"",typ:"buch",pflichtliteratur:!1,sortierung:0}),[qe,Ue]=d.useState(null),[Ze,Je]=d.useState(""),[kn,Ve]=d.useState(!1),[ke,tn]=d.useState(null),[Ke,rn]=d.useState(""),[_n,sn]=d.useState(!1),[Cn,ln]=d.useState(!1);d.useEffect(()=>{(async()=>{await new Promise(u=>setTimeout(u,100)),ie(!1),i&&v&&await Promise.all([fe(),Sn()])})()},[i]);const fe=d.useCallback(async()=>{if(i){x(!0),m(null);try{const n=await k.getAllModules({per_page:200});n.success?Y(n.data||[]):m(n.message||"Fehler beim Laden der Module")}catch(n){m(D(n))}finally{x(!1)}}},[i]),Sn=d.useCallback(async()=>{try{const[n,u]=await Promise.all([k.getLehrformenOptions(),k.getDozentenOptions()]);n.success&&ue(n.data||[]),u.success&&Fe(u.data||[])}catch(n){Re.error("Error loading options:",n)}},[]),an=d.useCallback(async()=>{if(!G){fe();return}x(!0),m(null);try{const n=await k.searchModules(G);n.success?Y(n.data||[]):m(n.message||"Fehler bei der Suche")}catch(n){m(D(n))}finally{x(!1)}},[G,fe]),H=d.useCallback(async n=>{x(!0),m(null);try{const u=await k.getModulDetails(n);u.success&&u.data?(o(u.data),K(!0),se(0),L(null),ae({0:!0})):m(u.message||"Fehler beim Laden der Details")}catch(u){m(D(u))}finally{x(!1)}},[]),Dn=d.useCallback(()=>{t({kuerzel:"",po_id:1,bezeichnung_de:"",bezeichnung_en:"",untertitel:"",leistungspunkte:5,turnus:"WiSe",gruppengroesse:"",teilnehmerzahl:"",anmeldemodalitaeten:""}),U(!0)},[]),Wn=d.useCallback(async n=>{x(!0);try{const u=await k.getModulDetails(n.id);u.success&&u.data?(o(u.data),ln(!0)):m("Fehler beim Laden der Modul-Details")}catch(u){m(u.message)}finally{x(!1)}},[]),Ln=async()=>{if(!W.kuerzel||!W.bezeichnung_de){m("Kürzel und Bezeichnung sind erforderlich");return}x(!0),m(null);try{const n=await k.createModule(W);n.success?(C("Modul erfolgreich erstellt"),U(!1),fe()):m(n.message||"Fehler beim Erstellen")}catch(n){m(D(n))}finally{x(!1)}},In=d.useCallback(n=>{o(n),R(!1),I(!0)},[]),En=async()=>{if(r){x(!0),m(null);try{const n=await k.deleteModule(r.id,T);n.success?(C("Modul erfolgreich gelöscht"),I(!1),fe()):m(n.message||"Fehler beim Löschen")}catch(n){m(D(n))}finally{x(!1)}}},Mn=()=>{r&&(f({bezeichnung_de:r.bezeichnung_de,bezeichnung_en:r.bezeichnung_en||"",untertitel:r.untertitel||"",leistungspunkte:r.leistungspunkte||5,turnus:r.turnus||"WiSe",gruppengroesse:r.gruppengroesse||"",teilnehmerzahl:r.teilnehmerzahl||"",anmeldemodalitaeten:r.anmeldemodalitaeten||""}),L("basis"))},An=async()=>{if(r){x(!0);try{const n=await k.updateModule(r.id,a);n.success?(C("Basis-Daten aktualisiert"),L(null),await H(r.id)):m(n.message||"Fehler beim Speichern")}catch(n){m(D(n))}finally{x(!1)}}},Bn=async()=>{if(!(!r||!ge.lehrform_id)){x(!0);try{(await k.addLehrform(r.id,{lehrform_id:parseInt(ge.lehrform_id),sws:ge.sws})).success&&(C("Lehrform hinzugefügt"),He({lehrform_id:"",sws:2}),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Tn=async n=>{if(!(!r||!window.confirm("Lehrform wirklich entfernen?"))){x(!0);try{(await k.deleteLehrform(r.id,n)).success&&(C("Lehrform entfernt"),await H(r.id))}catch(u){m(D(u))}finally{x(!1)}}},Pn=async()=>{if(!(!r||!je.dozent_id)){x(!0);try{(await k.addDozent(r.id,{dozent_id:parseInt(je.dozent_id),rolle:je.rolle})).success&&(C("Dozent hinzugefügt"),Ge({dozent_id:"",rolle:"lehrperson"}),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Fn=async n=>{if(!(!r||!window.confirm("Dozent wirklich entfernen?"))){x(!0);try{(await k.deleteDozent(r.id,n)).success&&(C("Dozent entfernt"),await H(r.id))}catch(u){m(D(u))}finally{x(!1)}}},$n=n=>{Ue(n.id),Je(n.rolle)},Rn=async n=>{if(!(!r||!Ze)){x(!0);try{(await k.updateDozentRolle(r.id,n,Ze)).success&&(C("Dozent-Rolle aktualisiert"),Ue(null),await H(r.id))}catch(u){m(D(u,"Fehler beim Aktualisieren der Rolle"))}finally{x(!1)}}},Vn=()=>{Ue(null),Je("")},Kn=n=>{tn({id:n.id,name:n.name_komplett||n.name_kurz||`${n.vorname||""} ${n.nachname||""}`.trim(),rolle:n.rolle}),rn(""),Ve(!0)},Nn=async()=>{if(!(!r||!ke||!Ke)){x(!0);try{(await k.replaceDozent(r.id,ke.id,parseInt(Ke))).success&&(C("Dozent erfolgreich ersetzt"),Ve(!1),tn(null),await H(r.id))}catch(n){m(D(n,"Fehler beim Ersetzen des Dozenten"))}finally{x(!1)}}},On=async()=>{if(!(!r||!F.titel)){x(!0);try{(await k.addLiteratur(r.id,{...F,jahr:F.jahr?parseInt(F.jahr):void 0})).success&&(C("Literatur hinzugefügt"),me({titel:"",autoren:"",verlag:"",jahr:"",isbn:"",typ:"buch",pflichtliteratur:!1,sortierung:0}),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Hn=async n=>{if(!(!r||!window.confirm("Literatur wirklich entfernen?"))){x(!0);try{(await k.deleteLiteratur(r.id,n)).success&&(C("Literatur entfernt"),await H(r.id))}catch(u){m(D(u))}finally{x(!1)}}},Gn=()=>{if(!r)return;const n=r.pruefung||{};f({pruefungsform:n.pruefungsform||"",pruefungsdauer_minuten:n.pruefungsdauer_minuten||"",pruefungsleistungen:n.pruefungsleistungen||"",benotung:n.benotung||""}),L("pruefung")},qn=async()=>{if(r){x(!0);try{(await k.updatePruefung(r.id,a)).success&&(C("Prüfung aktualisiert"),L(null),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Un=()=>{if(!r)return;const n=r.lernergebnisse||{};f({lernziele:n.lernziele||"",kompetenzen:n.kompetenzen||"",inhalt:n.inhalt||""}),L("lernergebnisse")},Zn=async()=>{if(r){x(!0);try{(await k.updateLernergebnisse(r.id,a)).success&&(C("Lernergebnisse aktualisiert"),L(null),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Jn=()=>{if(!r)return;const n=r.voraussetzungen||{};f({formal:n.formal||"",empfohlen:n.empfohlen||"",inhaltlich:n.inhaltlich||""}),L("voraussetzungen")},Qn=async()=>{if(r){x(!0);try{(await k.updateVoraussetzungen(r.id,a)).success&&(C("Voraussetzungen aktualisiert"),L(null),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}},Yn=()=>{if(!r)return;const n=r.arbeitsaufwand?.[0]||{};f({kontaktzeit_stunden:n.kontaktzeit_stunden||"",selbststudium_stunden:n.selbststudium_stunden||"",pruefungsvorbereitung_stunden:n.pruefungsvorbereitung_stunden||"",gesamt_stunden:n.gesamt_stunden||""}),L("arbeitsaufwand")},Xn=async()=>{if(r){x(!0);try{(await k.updateArbeitsaufwand(r.id,a)).success&&(C("Arbeitsaufwand aktualisiert"),L(null),await H(r.id))}catch(n){m(D(n))}finally{x(!1)}}};return xe?e.jsx(cn,{children:e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(ye,{})})}):e.jsxs(cn,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(b,{sx:{mb:4},children:[e.jsx(l,{variant:"h4",fontWeight:600,gutterBottom:!0,children:"Module"}),e.jsxs(l,{variant:"body1",color:"text.secondary",children:["Modulverwaltung - ",O.length," Module"]})]}),re&&e.jsx(he,{severity:"error",sx:{mb:3},onClose:()=>m(null),children:re}),B&&e.jsx(he,{severity:"success",sx:{mb:3},onClose:()=>C(null),children:B}),e.jsx(Z,{sx:{p:3,mb:3},children:e.jsxs(b,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(c,{placeholder:"Modul suchen...",value:G,onChange:n=>y(n.target.value),onKeyPress:n=>n.key==="Enter"&&an(),InputProps:{startAdornment:e.jsx(mn,{position:"start",children:e.jsx(fn,{})})},size:"small",sx:{flexGrow:1}}),e.jsx(z,{variant:"outlined",onClick:an,disabled:_,children:"Suchen"}),G&&e.jsx(z,{variant:"outlined",onClick:()=>{y(""),fe()},children:"Zurücksetzen"}),h&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outlined",startIcon:e.jsx(Se,{}),onClick:()=>sn(!0),children:"Bulk Transfer"}),e.jsx(z,{variant:"contained",startIcon:e.jsx(Ce,{}),onClick:Dn,children:"Neu"})]})]})}),e.jsx(pn,{component:Z,children:e.jsxs(bn,{children:[e.jsx(vn,{children:e.jsxs(ve,{children:[e.jsx(w,{children:"Kürzel"}),e.jsx(w,{children:"Bezeichnung"}),e.jsx(w,{align:"center",children:"ECTS"}),e.jsx(w,{align:"center",children:"SWS"}),e.jsx(w,{children:"Turnus"}),e.jsx(w,{align:"center",children:"Aktionen"})]})}),e.jsx(zn,{children:_&&O.length===0?e.jsx(ve,{children:e.jsx(w,{colSpan:6,align:"center",children:e.jsx(ye,{size:32,sx:{my:2}})})}):O.length===0?e.jsx(ve,{children:e.jsx(w,{colSpan:6,align:"center",children:e.jsx(l,{color:"text.secondary",sx:{py:4},children:G?"Keine Module gefunden":"Keine Module vorhanden"})})}):O.map(n=>e.jsx(jt,{modul:n,canEdit:j(n),onViewDetails:H,onEdit:Wn,onDelete:In},n.id))})]})}),h&&e.jsxs(Z,{sx:{mt:3,p:3},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Xe,{color:"primary"}),e.jsx(l,{variant:"h6",children:"Änderungsprotokoll"})]}),e.jsx(xt,{})]}),e.jsx(Le,{open:$,onClose:()=>K(!1),maxWidth:"lg",fullWidth:!0,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(jn,{color:"primary"}),e.jsxs(b,{children:[e.jsxs(l,{variant:"h6",children:[r.kuerzel," - ",r.bezeichnung_de]}),r.bezeichnung_en&&e.jsx(l,{variant:"caption",color:"text.secondary",children:r.bezeichnung_en})]})]}),e.jsx(J,{onClick:()=>K(!1),children:e.jsx(en,{})})]})}),e.jsxs(Ee,{dividers:!0,children:[e.jsxs(yn,{value:E,onChange:(n,u)=>{se(u),M[u]||ae(X=>({...X,[u]:!0}))},sx:{mb:2},children:[e.jsx(Q,{label:"Übersicht"}),e.jsx(Q,{label:"Lehrformen"}),e.jsx(Q,{label:"Dozenten"}),e.jsx(Q,{label:"Literatur"}),e.jsx(Q,{label:"Prüfung"}),e.jsx(Q,{label:"Lernergebnisse"}),e.jsx(Q,{label:"Voraussetzungen"}),e.jsx(Q,{label:"Arbeitsaufwand"})]}),e.jsx(pe,{value:E,index:0,loaded:!!M[0],children:V!=="basis"?e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(l,{variant:"h6",children:"Basis-Daten"}),j(r)&&e.jsx(z,{startIcon:e.jsx(be,{}),onClick:Mn,variant:"outlined",size:"small",children:"Bearbeiten"})]}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Kürzel"}),e.jsx(l,{variant:"h6",children:r.kuerzel})]}),e.jsxs(s,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Leistungspunkte"}),e.jsxs(l,{variant:"h6",children:[r.leistungspunkte," ECTS"]})]}),e.jsxs(s,{item:!0,xs:12,md:4,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Turnus"}),e.jsx(l,{variant:"h6",children:r.turnus})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Bezeichnung (DE)"}),e.jsx(l,{children:r.bezeichnung_de})]}),r.bezeichnung_en&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Bezeichnung (EN)"}),e.jsx(l,{children:r.bezeichnung_en})]}),r.untertitel&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Untertitel"}),e.jsx(l,{children:r.untertitel})]}),r.gruppengroesse&&e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Gruppengröße"}),e.jsx(l,{children:r.gruppengroesse})]}),r.teilnehmerzahl&&e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Teilnehmerzahl"}),e.jsx(l,{children:r.teilnehmerzahl})]}),r.anmeldemodalitaeten&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Anmeldemodalitäten"}),e.jsx(l,{children:r.anmeldemodalitaeten})]})]})]}):e.jsxs(b,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Basis-Daten bearbeiten"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Bezeichnung (DE)",required:!0,value:a.bezeichnung_de||"",onChange:n=>f({...a,bezeichnung_de:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Bezeichnung (EN)",value:a.bezeichnung_en||"",onChange:n=>f({...a,bezeichnung_en:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Untertitel",value:a.untertitel||"",onChange:n=>f({...a,untertitel:n.target.value})})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Leistungspunkte",type:"number",value:a.leistungspunkte||"",onChange:n=>f({...a,leistungspunkte:parseInt(n.target.value)})})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(c,{fullWidth:!0,select:!0,label:"Turnus",value:a.turnus||"",onChange:n=>f({...a,turnus:n.target.value}),children:[e.jsx(p,{value:"WiSe",children:"Wintersemester"}),e.jsx(p,{value:"SoSe",children:"Sommersemester"}),e.jsx(p,{value:"WiSe/SoSe",children:"Jedes Semester"})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Gruppengröße",value:a.gruppengroesse||"",onChange:n=>f({...a,gruppengroesse:n.target.value})})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Teilnehmerzahl",value:a.teilnehmerzahl||"",onChange:n=>f({...a,teilnehmerzahl:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Anmeldemodalitäten",value:a.anmeldemodalitaeten||"",onChange:n=>f({...a,anmeldemodalitaeten:n.target.value})})})]}),e.jsxs(We,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:An,disabled:_,children:"Speichern"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:()=>L(null),children:"Abbrechen"})]})]})}),e.jsxs(pe,{value:E,index:1,loaded:!!M[1],children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Lehrformen"}),e.jsx(Ae,{children:r.lehrformen&&r.lehrformen.length>0?r.lehrformen.map(n=>e.jsxs(Be,{children:[e.jsx(Te,{primary:`${n.bezeichnung} (${n.kuerzel})`,secondary:`${n.sws} SWS`}),j(r)&&e.jsx(Ne,{children:e.jsx(J,{edge:"end",color:"error",onClick:()=>Tn(n.id),children:e.jsx(Pe,{})})})]},n.id)):e.jsx(l,{color:"text.secondary",children:"Keine Lehrformen zugeordnet"})}),j(r)&&e.jsx(Qe,{sx:{mt:3,bgcolor:"grey.50"},children:e.jsxs(Ye,{children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Neue Lehrform hinzufügen"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:8,children:e.jsxs(ee,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Lehrform"}),e.jsx(ne,{value:ge.lehrform_id,onChange:n=>He({...ge,lehrform_id:n.target.value}),children:P.map(n=>e.jsxs(p,{value:n.id,children:[n.bezeichnung," (",n.kuerzel,")"]},n.id))})]})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(c,{fullWidth:!0,size:"small",label:"SWS",type:"number",value:ge.sws,onChange:n=>He({...ge,sws:parseInt(n.target.value)})})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(z,{fullWidth:!0,variant:"contained",size:"small",startIcon:e.jsx(Ce,{}),onClick:Bn,disabled:!ge.lehrform_id||_,children:"Hinzufügen"})})]})]})})]}),e.jsxs(pe,{value:E,index:2,loaded:!!M[2],children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Dozenten"}),e.jsx(Ae,{children:r.dozenten&&r.dozenten.length>0?r.dozenten.map(n=>e.jsxs(Be,{sx:{bgcolor:qe===n.id?"action.selected":"inherit",borderRadius:1},children:[e.jsx(Te,{primary:n.name_komplett||n.name_kurz||`${n.vorname||""} ${n.nachname||""}`.trim(),secondary:qe===n.id?e.jsx(ee,{size:"small",sx:{mt:1,minWidth:180},children:e.jsxs(ne,{value:Ze,onChange:u=>Je(u.target.value),children:[e.jsx(p,{value:"verantwortlicher",children:"Modulverantwortlicher"}),e.jsx(p,{value:"lehrperson",children:"Lehrperson"}),e.jsx(p,{value:"pruefend",children:"Prüfend"}),e.jsx(p,{value:"mitwirkend",children:"Mitwirkend"}),e.jsx(p,{value:"vertreter",children:"Vertreter"})]})}):e.jsx(N,{label:n.rolle,size:"small",color:n.rolle==="verantwortlicher"||n.rolle==="Modulverantwortlicher"?"primary":"default",variant:"outlined"})}),j(r)&&e.jsx(Ne,{children:qe===n.id?e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Speichern",children:e.jsx(J,{edge:"end",color:"primary",onClick:()=>Rn(n.id),disabled:_,children:e.jsx(_e,{})})}),e.jsx(le,{title:"Abbrechen",children:e.jsx(J,{edge:"end",onClick:Vn,children:e.jsx(De,{})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Rolle bearbeiten",children:e.jsx(J,{edge:"end",onClick:()=>$n(n),children:e.jsx(be,{fontSize:"small"})})}),e.jsx(le,{title:"Dozent ersetzen",children:e.jsx(J,{edge:"end",color:"info",onClick:()=>Kn(n),children:e.jsx(Se,{fontSize:"small"})})}),e.jsx(le,{title:"Entfernen",children:e.jsx(J,{edge:"end",color:"error",onClick:()=>Fn(n.id),children:e.jsx(Pe,{fontSize:"small"})})})]})})]},n.id)):e.jsx(l,{color:"text.secondary",children:"Keine Dozenten zugeordnet"})}),j(r)&&e.jsx(Qe,{sx:{mt:3,bgcolor:"grey.50"},children:e.jsxs(Ye,{children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Neuen Dozenten hinzufügen"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:7,children:e.jsxs(ee,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Dozent"}),e.jsx(ne,{value:je.dozent_id,onChange:n=>Ge({...je,dozent_id:n.target.value}),children:we.map(n=>e.jsx(p,{value:n.id,children:n.name},n.id))})]})}),e.jsx(s,{item:!0,xs:3,children:e.jsxs(ee,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Rolle"}),e.jsxs(ne,{value:je.rolle,onChange:n=>Ge({...je,rolle:n.target.value}),children:[e.jsx(p,{value:"verantwortlicher",children:"Modulverantwortlicher"}),e.jsx(p,{value:"lehrperson",children:"Lehrperson"}),e.jsx(p,{value:"pruefend",children:"Prüfend"}),e.jsx(p,{value:"mitwirkend",children:"Mitwirkend"}),e.jsx(p,{value:"vertreter",children:"Vertreter"})]})]})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(z,{fullWidth:!0,variant:"contained",size:"small",startIcon:e.jsx(Ce,{}),onClick:Pn,disabled:!je.dozent_id||_,children:"Hinzufügen"})})]})]})})]}),e.jsxs(pe,{value:E,index:3,loaded:!!M[3],children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Literatur"}),e.jsx(Ae,{children:r.literatur&&r.literatur.length>0?r.literatur.map((n,u)=>e.jsxs(ze.Fragment,{children:[u>0&&e.jsx(Oe,{sx:{my:1}}),e.jsxs(Be,{alignItems:"flex-start",children:[e.jsx(Te,{primary:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{variant:"subtitle1",children:n.titel}),n.pflichtliteratur&&e.jsx(N,{label:"Pflicht",size:"small",color:"error"}),n.typ&&e.jsx(N,{label:n.typ,size:"small",variant:"outlined"})]}),secondary:e.jsxs(e.Fragment,{children:[n.autoren&&e.jsxs(l,{variant:"body2",children:["Autor(en): ",n.autoren]}),e.jsxs(b,{sx:{display:"flex",gap:2,flexWrap:"wrap",mt:.5},children:[n.verlag&&e.jsxs(l,{variant:"body2",children:["Verlag: ",n.verlag]}),n.jahr&&e.jsxs(l,{variant:"body2",children:["Jahr: ",n.jahr]}),n.isbn&&e.jsxs(l,{variant:"body2",children:["ISBN: ",n.isbn]})]})]})}),j(r)&&e.jsx(Ne,{children:e.jsx(J,{edge:"end",color:"error",onClick:()=>Hn(n.id),children:e.jsx(Pe,{})})})]})]},n.id||u)):e.jsx(l,{color:"text.secondary",children:"Keine Literatur hinterlegt"})}),j(r)&&e.jsx(Qe,{sx:{mt:3,bgcolor:"grey.50"},children:e.jsxs(Ye,{children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Neue Literatur hinzufügen"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,size:"small",label:"Titel",required:!0,value:F.titel,onChange:n=>me({...F,titel:n.target.value})})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,size:"small",label:"Autoren",value:F.autoren,onChange:n=>me({...F,autoren:n.target.value})})}),e.jsx(s,{item:!0,xs:4,children:e.jsx(c,{fullWidth:!0,size:"small",label:"Verlag",value:F.verlag,onChange:n=>me({...F,verlag:n.target.value})})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(c,{fullWidth:!0,size:"small",label:"Jahr",type:"number",value:F.jahr,onChange:n=>me({...F,jahr:n.target.value})})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,size:"small",label:"ISBN",value:F.isbn,onChange:n=>me({...F,isbn:n.target.value})})}),e.jsx(s,{item:!0,xs:3,children:e.jsxs(ee,{fullWidth:!0,size:"small",children:[e.jsx(te,{children:"Typ"}),e.jsxs(ne,{value:F.typ,onChange:n=>me({...F,typ:n.target.value}),children:[e.jsx(p,{value:"buch",children:"Buch"}),e.jsx(p,{value:"artikel",children:"Artikel"}),e.jsx(p,{value:"online",children:"Online"}),e.jsx(p,{value:"zeitschrift",children:"Zeitschrift"})]})]})}),e.jsx(s,{item:!0,xs:2,children:e.jsx(hn,{control:e.jsx(xn,{checked:F.pflichtliteratur,onChange:n=>me({...F,pflichtliteratur:n.target.checked})}),label:"Pflicht"})}),e.jsx(s,{item:!0,xs:1,children:e.jsx(z,{fullWidth:!0,variant:"contained",size:"small",startIcon:e.jsx(Ce,{}),onClick:On,disabled:!F.titel||_,children:"+"})})]})]})})]}),e.jsx(pe,{value:E,index:4,loaded:!!M[4],children:V!=="pruefung"?e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(l,{variant:"h6",children:"Prüfung"}),j(r)&&e.jsx(z,{startIcon:e.jsx(be,{}),onClick:Gn,variant:"outlined",size:"small",children:"Bearbeiten"})]}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Prüfungsform"}),e.jsx(l,{children:r.pruefung?.pruefungsform||"-"})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Prüfungsdauer"}),e.jsx(l,{children:r.pruefung?.pruefungsdauer_minuten?`${r.pruefung.pruefungsdauer_minuten} Minuten`:"-"})]}),e.jsxs(s,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Benotung"}),e.jsx(l,{children:r.pruefung?.benotung||"-"})]}),r.pruefung?.pruefungsleistungen&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Details"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.pruefung.pruefungsleistungen})})]})]})]}):e.jsxs(b,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Prüfung bearbeiten"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:8,children:e.jsx(c,{fullWidth:!0,label:"Prüfungsform",value:a.pruefungsform||"",onChange:n=>f({...a,pruefungsform:n.target.value})})}),e.jsx(s,{item:!0,xs:4,children:e.jsx(c,{fullWidth:!0,label:"Dauer (Minuten)",type:"number",value:a.pruefungsdauer_minuten||"",onChange:n=>f({...a,pruefungsdauer_minuten:parseInt(n.target.value)})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Benotung",value:a.benotung||"",onChange:n=>f({...a,benotung:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:4,label:"Prüfungsleistungen",value:a.pruefungsleistungen||"",onChange:n=>f({...a,pruefungsleistungen:n.target.value})})})]}),e.jsxs(We,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:qn,disabled:_,children:"Speichern"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:()=>L(null),children:"Abbrechen"})]})]})}),e.jsx(pe,{value:E,index:5,loaded:!!M[5],children:V!=="lernergebnisse"?e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(l,{variant:"h6",children:"Lernergebnisse"}),j(r)&&e.jsx(z,{startIcon:e.jsx(be,{}),onClick:Un,variant:"outlined",size:"small",children:"Bearbeiten"})]}),e.jsxs(s,{container:!0,spacing:3,children:[r.lernergebnisse?.lernziele&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Lernziele"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.lernergebnisse.lernziele})})]}),r.lernergebnisse?.kompetenzen&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Kompetenzen"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.lernergebnisse.kompetenzen})})]}),r.lernergebnisse?.inhalt&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Inhalt"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.lernergebnisse.inhalt})})]}),!r.lernergebnisse?.lernziele&&!r.lernergebnisse?.kompetenzen&&!r.lernergebnisse?.inhalt&&e.jsx(s,{item:!0,xs:12,children:e.jsx(l,{color:"text.secondary",children:"Keine Lernergebnisse hinterlegt"})})]})]}):e.jsxs(b,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Lernergebnisse bearbeiten"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:4,label:"Lernziele",value:a.lernziele||"",onChange:n=>f({...a,lernziele:n.target.value}),helperText:"Was sollen die Studierenden lernen?"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:4,label:"Kompetenzen",value:a.kompetenzen||"",onChange:n=>f({...a,kompetenzen:n.target.value}),helperText:"Welche Kompetenzen werden erworben?"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:6,label:"Inhalt",value:a.inhalt||"",onChange:n=>f({...a,inhalt:n.target.value}),helperText:"Was sind die Inhalte des Moduls?"})})]}),e.jsxs(We,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:Zn,disabled:_,children:"Speichern"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:()=>L(null),children:"Abbrechen"})]})]})}),e.jsx(pe,{value:E,index:6,loaded:!!M[6],children:V!=="voraussetzungen"?e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(l,{variant:"h6",children:"Voraussetzungen"}),j(r)&&e.jsx(z,{startIcon:e.jsx(be,{}),onClick:Jn,variant:"outlined",size:"small",children:"Bearbeiten"})]}),e.jsxs(s,{container:!0,spacing:3,children:[r.voraussetzungen?.formal&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Formale Voraussetzungen"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.voraussetzungen.formal})})]}),r.voraussetzungen?.empfohlen&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Empfohlene Voraussetzungen"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.voraussetzungen.empfohlen})})]}),r.voraussetzungen?.inhaltlich&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(l,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Inhaltliche Voraussetzungen"}),e.jsx(Z,{sx:{p:2,bgcolor:"background.default"},children:e.jsx(l,{variant:"body2",style:{whiteSpace:"pre-wrap"},children:r.voraussetzungen.inhaltlich})})]}),!r.voraussetzungen?.formal&&!r.voraussetzungen?.empfohlen&&!r.voraussetzungen?.inhaltlich&&e.jsx(s,{item:!0,xs:12,children:e.jsx(l,{color:"text.secondary",children:"Keine Voraussetzungen hinterlegt"})})]})]}):e.jsxs(b,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Voraussetzungen bearbeiten"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Formale Voraussetzungen",value:a.formal||"",onChange:n=>f({...a,formal:n.target.value}),helperText:"Formale Anforderungen (z.B. bestandene Klausuren)"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Empfohlene Voraussetzungen",value:a.empfohlen||"",onChange:n=>f({...a,empfohlen:n.target.value}),helperText:"Empfohlene Vorkenntnisse"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,multiline:!0,rows:3,label:"Inhaltliche Voraussetzungen",value:a.inhaltlich||"",onChange:n=>f({...a,inhaltlich:n.target.value}),helperText:"Inhaltliche Anforderungen"})})]}),e.jsxs(We,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:Qn,disabled:_,children:"Speichern"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:()=>L(null),children:"Abbrechen"})]})]})}),e.jsx(pe,{value:E,index:7,loaded:!!M[7],children:V!=="arbeitsaufwand"?e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(l,{variant:"h6",children:"Arbeitsaufwand"}),j(r)&&e.jsx(z,{startIcon:e.jsx(be,{}),onClick:Yn,variant:"outlined",size:"small",children:"Bearbeiten"})]}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Kontaktzeit"}),e.jsxs(l,{variant:"h5",color:"primary",children:[r.arbeitsaufwand?.[0]?.kontaktzeit_stunden||0," Std."]})]}),e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Selbststudium"}),e.jsxs(l,{variant:"h5",color:"primary",children:[r.arbeitsaufwand?.[0]?.selbststudium_stunden||0," Std."]})]}),e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Prüfungsvorbereitung"}),e.jsxs(l,{variant:"h5",color:"primary",children:[r.arbeitsaufwand?.[0]?.pruefungsvorbereitung_stunden||0," Std."]})]}),e.jsxs(s,{item:!0,xs:12,md:3,children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Gesamt"}),e.jsxs(l,{variant:"h5",color:"success.main",children:[r.arbeitsaufwand?.[0]?.gesamt_stunden||0," Std."]})]})]})]}):e.jsxs(b,{children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Arbeitsaufwand bearbeiten"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Kontaktzeit (Std)",type:"number",value:a.kontaktzeit_stunden||"",onChange:n=>f({...a,kontaktzeit_stunden:parseInt(n.target.value)}),helperText:"Präsenzzeit in Stunden"})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Selbststudium (Std)",type:"number",value:a.selbststudium_stunden||"",onChange:n=>f({...a,selbststudium_stunden:parseInt(n.target.value)}),helperText:"Selbstlernzeit in Stunden"})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Prüfungsvorbereitung (Std)",type:"number",value:a.pruefungsvorbereitung_stunden||"",onChange:n=>f({...a,pruefungsvorbereitung_stunden:parseInt(n.target.value)}),helperText:"Zeit für Prüfungsvorbereitung"})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Gesamt (Std)",type:"number",value:a.gesamt_stunden||"",onChange:n=>f({...a,gesamt_stunden:parseInt(n.target.value)}),helperText:"Gesamtaufwand"})})]}),e.jsxs(We,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(_e,{}),onClick:Xn,disabled:_,children:"Speichern"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(De,{}),onClick:()=>L(null),children:"Abbrechen"})]})]})})]}),e.jsx(Me,{children:e.jsx(z,{onClick:()=>{K(!1),L(null)},children:"Schließen"})})]})}),e.jsxs(Le,{open:q,onClose:()=>U(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ie,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ce,{color:"primary"}),e.jsx(l,{variant:"h6",children:"Neues Modul erstellen"})]})}),e.jsx(Ee,{dividers:!0,children:e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Kürzel",fullWidth:!0,required:!0,value:W.kuerzel,onChange:n=>t({...W,kuerzel:n.target.value.toUpperCase()})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"PO ID",type:"number",fullWidth:!0,required:!0,value:W.po_id,onChange:n=>t({...W,po_id:parseInt(n.target.value)})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{label:"Bezeichnung (Deutsch)",fullWidth:!0,required:!0,value:W.bezeichnung_de,onChange:n=>t({...W,bezeichnung_de:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{label:"Bezeichnung (Englisch)",fullWidth:!0,value:W.bezeichnung_en,onChange:n=>t({...W,bezeichnung_en:n.target.value})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{label:"Untertitel",fullWidth:!0,value:W.untertitel,onChange:n=>t({...W,untertitel:n.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Leistungspunkte",type:"number",fullWidth:!0,value:W.leistungspunkte,onChange:n=>t({...W,leistungspunkte:parseInt(n.target.value)})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(c,{label:"Turnus",select:!0,fullWidth:!0,value:W.turnus,onChange:n=>t({...W,turnus:n.target.value}),children:[e.jsx(p,{value:"WiSe",children:"Wintersemester"}),e.jsx(p,{value:"SoSe",children:"Sommersemester"}),e.jsx(p,{value:"WiSe/SoSe",children:"Jedes Semester"})]})})]})}),e.jsxs(Me,{children:[e.jsx(z,{onClick:()=>U(!1),children:"Abbrechen"}),e.jsx(z,{variant:"contained",onClick:Ln,disabled:_,children:"Erstellen"})]})]}),e.jsxs(Le,{open:S,onClose:()=>I(!1),maxWidth:"sm",children:[e.jsx(Ie,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(rt,{color:"error"}),e.jsx(l,{variant:"h6",children:"Modul löschen"})]})}),e.jsxs(Ee,{children:[e.jsxs(l,{gutterBottom:!0,children:["Möchten Sie das Modul ",e.jsx("strong",{children:r?.kuerzel})," wirklich löschen?"]}),e.jsx(hn,{control:e.jsx(xn,{checked:T,onChange:n=>R(n.target.checked)}),label:"Erzwingen (auch bei Verwendung in Planungen)"})]}),e.jsxs(Me,{children:[e.jsx(z,{onClick:()=>I(!1),children:"Abbrechen"}),e.jsx(z,{variant:"contained",color:"error",onClick:En,disabled:_,children:"Löschen"})]})]}),e.jsxs(Le,{open:kn,onClose:()=>Ve(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Se,{color:"primary"}),e.jsx(l,{variant:"h6",children:"Dozent ersetzen"})]})}),e.jsx(Ee,{dividers:!0,children:ke&&e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsxs(b,{sx:{p:2,bgcolor:"grey.100",borderRadius:1},children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Aktueller Dozent"}),e.jsx(l,{variant:"body1",fontWeight:"bold",children:ke.name}),e.jsx(N,{label:ke.rolle,size:"small",sx:{mt:1}})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(ee,{fullWidth:!0,children:[e.jsx(te,{children:"Neuer Dozent"}),e.jsx(ne,{value:Ke,label:"Neuer Dozent",onChange:n=>rn(n.target.value),children:we.filter(n=>n.id!==ke.id).map(n=>e.jsx(p,{value:n.id,children:n.name},n.id))})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(he,{severity:"info",children:["Die Rolle ",e.jsx("strong",{children:ke.rolle})," wird auf den neuen Dozenten übertragen."]})})]})}),e.jsxs(Me,{children:[e.jsx(z,{onClick:()=>Ve(!1),disabled:_,children:"Abbrechen"}),e.jsx(z,{variant:"contained",onClick:Nn,disabled:_||!Ke,startIcon:_?e.jsx(ye,{size:16}):e.jsx(Se,{}),children:_?"Wird ersetzt...":"Ersetzen"})]})]}),e.jsx(ht,{open:_n,onClose:()=>sn(!1),onSuccess:()=>{C("Bulk Transfer erfolgreich durchgeführt"),fe()},module:O.map(n=>({id:n.id,kuerzel:n.kuerzel,bezeichnung_de:n.bezeichnung_de,dozenten:n.dozenten?.map(u=>({zuordnung_id:u.id,id:u.dozent_id,name:u.name_komplett||u.name_kurz||`${u.vorname||""} ${u.nachname||""}`.trim(),rolle:u.rolle}))||[]}))}),e.jsx(gt,{open:Cn,modul:r,onClose:()=>{ln(!1)},onSaveSuccess:async()=>{await fe(),r?.id&&await H(r.id),C("Änderungen wurden gespeichert")},onSaveBasics:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.updateModule(r.id,n);if(!u.success)throw new Error(u.message);return u},onSavePruefung:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.updatePruefung(r.id,n);if(!u.success)throw new Error(u.message);return u},onSaveLernergebnisse:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.updateLernergebnisse(r.id,n);if(!u.success)throw new Error(u.message);return u},onSaveVoraussetzungen:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.updateVoraussetzungen(r.id,n);if(!u.success)throw new Error(u.message);return u},onSaveArbeitsaufwand:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.updateArbeitsaufwand(r.id,n);if(!u.success)throw new Error(u.message);return u},onAddLiteratur:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.addLiteratur(r.id,n);if(!u.success)throw new Error(u.message);const X=await k.getModulDetails(r.id);return X.success&&X.data&&o(X.data),u},onDeleteLiteratur:async n=>{if(!r?.id)throw new Error("Kein Modul ausgewählt");const u=await k.deleteLiteratur(r.id,n);if(!u.success)throw new Error(u.message);const X=await k.getModulDetails(r.id);return X.success&&X.data&&o(X.data),u},lehrformOptions:P,dozentOptions:we})]})};export{yt as default};
