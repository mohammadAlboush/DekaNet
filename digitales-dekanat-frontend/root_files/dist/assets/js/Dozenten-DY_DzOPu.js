import{j as e,N as le,B as c,z as re,f as s,H as K,P as ie,O as u,Q as ye,aL as ke,K as j,aY as ce,ae as De,af as Ce,ag as ze,ah as W,ai as d,aj as Se,m as Ae,an as oe,bm as Ee,ab as A,l as V,I as w,R as Fe,ak as H,b3 as Te,aD as L,aE as B,aS as _e,aF as P,a7 as Ie,a8 as M,$ as n,L as We,g as we,k as Le,aH as $,a$ as q,b7 as G,ap as Be}from"./vendor-mui-BiVZR0IW.js";import{b as Pe,r as i}from"./vendor-react-CBtCGaWm.js";import{d as k}from"./dozentService-Bp4gwnVO.js";import{u as Me,g as D}from"./index-BXi_OX1m.js";import"./vendor-utils-DTv3oRQQ.js";function N(m){const{children:v,value:p,index:g,...o}=m;return e.jsx("div",{role:"tabpanel",hidden:p!==g,...o,children:p===g&&e.jsx(c,{sx:{py:3},children:v})})}const Ve=()=>{const{user:m,isAuthenticated:v}=Me(),p=Pe.useMemo(()=>m?typeof m.rolle=="string"?m.rolle==="dekan":m.rolle?.name==="dekan":!1,[m]),[g,o]=i.useState(!1),[he,de]=i.useState(!0),[J,r]=i.useState(null),[Q,E]=i.useState(null),[F,U]=i.useState([]),[C,Y]=i.useState(""),[a,O]=i.useState(null),[xe,z]=i.useState(!1),[ue,T]=i.useState(!1),[je,_]=i.useState(!1),[me,I]=i.useState(!1),[Z,X]=i.useState(!1),[S,ee]=i.useState(0),[h,f]=i.useState({titel:"",vorname:"",nachname:"",email:"",fachbereich:"",aktiv:!0}),[x,b]=i.useState({titel:"",vorname:"",nachname:"",email:"",fachbereich:"",aktiv:!0});i.useEffect(()=>{(async()=>{await new Promise(l=>setTimeout(l,100)),de(!1),v&&m&&y()})()},[v]);const y=i.useCallback(async()=>{if(v){o(!0),r(null);try{const t=await k.getAllDozenten();t.success?U(t.data||[]):r(t.message||"Fehler beim Laden der Dozenten")}catch(t){r(D(t))}finally{o(!1)}}},[v]),te=async()=>{if(!C){y();return}o(!0),r(null);try{const t=await k.searchDozenten(C);t.success?U(t.data||[]):r(t.message||"Fehler bei der Suche")}catch(t){r(D(t))}finally{o(!1)}},se=async t=>{o(!0),r(null);try{const l=await k.getDozentDetails(t);l.success&&l.data?(O(l.data),z(!0),ee(0)):r(l.message||"Fehler beim Laden der Details")}catch(l){r(D(l))}finally{o(!1)}},ge=()=>{f({titel:"",vorname:"",nachname:"",email:"",fachbereich:"",aktiv:!0}),_(!0)},ae=t=>{b({titel:t.titel||"",vorname:t.vorname||"",nachname:t.nachname||"",email:t.email||"",fachbereich:t.fachbereich||"",aktiv:t.aktiv!==!1}),O(t),T(!0)},fe=async()=>{if(!h.nachname){r("Nachname ist erforderlich");return}o(!0),r(null);try{const t=await k.createDozent(h);t.success?(E("Dozent erfolgreich erstellt"),_(!1),y()):r(t.message||"Fehler beim Erstellen")}catch(t){r(D(t))}finally{o(!1)}},be=async()=>{if(a){o(!0),r(null);try{const t=await k.updateDozent(a.id,x);t.success?(E("Dozent erfolgreich aktualisiert"),T(!1),y()):r(t.message||"Fehler beim Aktualisieren")}catch(t){r(D(t))}finally{o(!1)}}},ve=t=>{O(t),X(!1),I(!0)},pe=async()=>{if(a){o(!0),r(null);try{const t=await k.deleteDozent(a.id,Z);t.success?(E("Dozent erfolgreich gelöscht"),I(!1),y()):r(t.message||"Fehler beim Löschen")}catch(t){r(D(t))}finally{o(!1)}}};return he?e.jsx(le,{children:e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(re,{})})}):e.jsxs(le,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(c,{sx:{mb:4},children:[e.jsx(s,{variant:"h4",fontWeight:600,gutterBottom:!0,children:"Dozenten"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Dozentenverwaltung - ",F.length," Dozenten"]})]}),J&&e.jsx(K,{severity:"error",sx:{mb:3},onClose:()=>r(null),children:J}),Q&&e.jsx(K,{severity:"success",sx:{mb:3},onClose:()=>E(null),children:Q}),e.jsx(ie,{sx:{p:3,mb:3},children:e.jsxs(c,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(u,{placeholder:"Dozent suchen...",value:C,onChange:t=>Y(t.target.value),onKeyPress:t=>t.key==="Enter"&&te(),InputProps:{startAdornment:e.jsx(ye,{position:"start",children:e.jsx(ke,{})})},size:"small",sx:{flexGrow:1}}),e.jsx(j,{variant:"outlined",onClick:te,disabled:g,children:"Suchen"}),C&&e.jsx(j,{variant:"outlined",onClick:()=>{Y(""),y()},children:"Zurücksetzen"}),p&&e.jsx(j,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:ge,children:"Neu"})]})}),e.jsx(De,{component:ie,children:e.jsxs(Ce,{children:[e.jsx(ze,{children:e.jsxs(W,{children:[e.jsx(d,{children:"Name"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Fachbereich"}),e.jsx(d,{align:"center",children:"Module"}),e.jsx(d,{align:"center",children:"Status"}),e.jsx(d,{align:"center",children:"Aktionen"})]})}),e.jsx(Se,{children:g&&F.length===0?e.jsx(W,{children:e.jsx(d,{colSpan:6,align:"center",children:e.jsx(re,{size:32,sx:{my:2}})})}):F.length===0?e.jsx(W,{children:e.jsx(d,{colSpan:6,align:"center",children:e.jsx(s,{color:"text.secondary",sx:{py:4},children:C?"Keine Dozenten gefunden":"Keine Dozenten vorhanden"})})}):F.map(t=>e.jsxs(W,{hover:!0,sx:{cursor:"pointer"},onClick:()=>se(t.id),children:[e.jsx(d,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ae,{sx:{bgcolor:"primary.main"},children:e.jsx(oe,{})}),e.jsxs(c,{children:[e.jsx(s,{variant:"body2",fontWeight:500,children:t.name_mit_titel||t.name_komplett}),t.titel&&e.jsx(s,{variant:"caption",color:"text.secondary",children:t.titel})]})]})}),e.jsx(d,{children:t.email?e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{fontSize:"small",color:"action"}),e.jsx(s,{variant:"body2",children:t.email})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(d,{children:t.fachbereich?e.jsx(s,{variant:"body2",children:t.fachbereich}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(d,{align:"center",children:e.jsx(A,{label:t.anzahl_module||0,size:"small",color:"primary",variant:"outlined"})}),e.jsx(d,{align:"center",children:e.jsx(A,{label:t.aktiv?"Aktiv":"Inaktiv",size:"small",color:t.aktiv?"success":"default",variant:"outlined"})}),e.jsxs(d,{align:"center",onClick:l=>l.stopPropagation(),children:[e.jsx(V,{title:"Details anzeigen",children:e.jsx(w,{size:"small",onClick:()=>se(t.id),children:e.jsx(Fe,{})})}),p&&e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Bearbeiten",children:e.jsx(w,{size:"small",onClick:()=>ae(t),children:e.jsx(H,{})})}),e.jsx(V,{title:"Löschen",children:e.jsx(w,{size:"small",color:"error",onClick:()=>ve(t),children:e.jsx(Te,{})})})]})]})]},t.id))})]})}),e.jsx(L,{open:xe,onClose:()=>z(!1),maxWidth:"lg",fullWidth:!0,children:a&&e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{color:"primary"}),e.jsxs(c,{children:[e.jsx(s,{variant:"h6",children:a.name_mit_titel||a.name_komplett}),a.email&&e.jsx(s,{variant:"caption",color:"text.secondary",children:a.email})]})]}),e.jsxs(c,{children:[p&&e.jsx(j,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>{z(!1),ae(a)},sx:{mr:1},children:"Bearbeiten"}),e.jsx(w,{onClick:()=>z(!1),children:e.jsx(_e,{})})]})]})}),e.jsxs(P,{dividers:!0,children:[e.jsxs(Ie,{value:S,onChange:(t,l)=>ee(l),sx:{mb:2},children:[e.jsx(M,{label:"Übersicht"}),e.jsx(M,{label:"Module"}),e.jsx(M,{label:"Benutzer-Account"}),e.jsx(M,{label:"Alle Daten"})]}),e.jsx(N,{value:S,index:0,children:e.jsxs(n,{container:!0,spacing:3,children:[a.titel&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Titel"}),e.jsx(s,{variant:"h6",children:a.titel})]}),a.vorname&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Vorname"}),e.jsx(s,{variant:"h6",children:a.vorname})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Nachname"}),e.jsx(s,{variant:"h6",children:a.nachname})]}),a.fachbereich&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Fachbereich"}),e.jsx(s,{variant:"h6",children:a.fachbereich})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(A,{label:a.aktiv?"Aktiv":"Inaktiv",color:a.aktiv?"success":"default"})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Anzahl Module"}),e.jsx(s,{variant:"h6",children:a.anzahl_module||0})]}),a.created_at&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Erstellt am"}),e.jsx(s,{children:new Date(a.created_at).toLocaleString("de-DE")})]}),a.updated_at&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Aktualisiert am"}),e.jsx(s,{children:new Date(a.updated_at).toLocaleString("de-DE")})]})]})}),e.jsx(N,{value:S,index:1,children:a.module&&a.module.length>0?e.jsx(We,{children:(()=>{const t=new Map;return a.module.forEach(l=>{const R=`${l.kuerzel}-${l.po_id}`;if(t.has(R)){const ne=t.get(R);ne.rollen.includes(l.rolle)||ne.rollen.push(l.rolle)}else t.set(R,{...l,rollen:[l.rolle]})}),Array.from(t.values()).map(l=>e.jsx(we,{children:e.jsx(Le,{primary:`${l.kuerzel} - ${l.bezeichnung_de}`,secondary:`Rolle: ${l.rollen.join(", ")} | PO: ${l.po_id}`})},`${l.kuerzel}-${l.po_id}`))})()}):e.jsx(s,{color:"text.secondary",children:"Keine Module zugeordnet"})}),e.jsx(N,{value:S,index:2,children:a.hat_benutzer_account&&a.benutzer?e.jsxs(n,{container:!0,spacing:2,children:[e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Benutzername"}),e.jsx(s,{children:a.benutzer.username})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Email"}),e.jsx(s,{children:a.benutzer.email})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Rolle"}),e.jsx(A,{label:a.benutzer.rolle,size:"small"})]}),e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(A,{label:a.benutzer.aktiv?"Aktiv":"Inaktiv",color:a.benutzer.aktiv?"success":"default",size:"small"})]}),a.benutzer.letzter_login&&e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"Letzter Login"}),e.jsx(s,{children:new Date(a.benutzer.letzter_login).toLocaleString("de-DE")})]})]}):e.jsx(K,{severity:"info",children:"Dieser Dozent hat keinen Benutzer-Account."})}),e.jsxs(N,{value:S,index:3,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Alle Datenbankfelder"}),e.jsx(c,{sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:e.jsx("pre",{children:JSON.stringify(a,null,2)})})]})]}),e.jsx($,{children:e.jsx(j,{onClick:()=>z(!1),children:"Schließen"})})]})}),e.jsxs(L,{open:ue,onClose:()=>T(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(B,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(H,{color:"primary"}),e.jsx(s,{variant:"h6",children:"Dozent bearbeiten"})]})}),e.jsx(P,{dividers:!0,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Titel",fullWidth:!0,value:x.titel,onChange:t=>b({...x,titel:t.target.value})})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Vorname",fullWidth:!0,value:x.vorname,onChange:t=>b({...x,vorname:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Nachname",fullWidth:!0,required:!0,value:x.nachname,onChange:t=>b({...x,nachname:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Email",type:"email",fullWidth:!0,value:x.email,onChange:t=>b({...x,email:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Fachbereich",fullWidth:!0,value:x.fachbereich,onChange:t=>b({...x,fachbereich:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(q,{control:e.jsx(G,{checked:x.aktiv,onChange:t=>b({...x,aktiv:t.target.checked})}),label:"Aktiv"})})]})}),e.jsxs($,{children:[e.jsx(j,{onClick:()=>T(!1),children:"Abbrechen"}),e.jsx(j,{variant:"contained",onClick:be,disabled:g,children:"Speichern"})]})]}),e.jsxs(L,{open:je,onClose:()=>_(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(B,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ce,{color:"primary"}),e.jsx(s,{variant:"h6",children:"Neuen Dozenten erstellen"})]})}),e.jsx(P,{dividers:!0,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Titel",fullWidth:!0,value:h.titel,onChange:t=>f({...h,titel:t.target.value})})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Vorname",fullWidth:!0,value:h.vorname,onChange:t=>f({...h,vorname:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Nachname",fullWidth:!0,required:!0,value:h.nachname,onChange:t=>f({...h,nachname:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Email",type:"email",fullWidth:!0,value:h.email,onChange:t=>f({...h,email:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{label:"Fachbereich",fullWidth:!0,value:h.fachbereich,onChange:t=>f({...h,fachbereich:t.target.value})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(q,{control:e.jsx(G,{checked:h.aktiv,onChange:t=>f({...h,aktiv:t.target.checked})}),label:"Aktiv"})})]})}),e.jsxs($,{children:[e.jsx(j,{onClick:()=>_(!1),children:"Abbrechen"}),e.jsx(j,{variant:"contained",onClick:fe,disabled:g,children:"Erstellen"})]})]}),e.jsxs(L,{open:me,onClose:()=>I(!1),maxWidth:"sm",children:[e.jsx(B,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Be,{color:"error"}),e.jsx(s,{variant:"h6",children:"Dozent löschen"})]})}),e.jsxs(P,{children:[e.jsxs(s,{gutterBottom:!0,children:["Möchten Sie den Dozenten ",e.jsx("strong",{children:a?.name_komplett})," wirklich löschen?"]}),e.jsx(q,{control:e.jsx(G,{checked:Z,onChange:t=>X(t.target.checked)}),label:"Erzwingen (auch bei Modulzuordnungen)"})]}),e.jsxs($,{children:[e.jsx(j,{onClick:()=>I(!1),children:"Abbrechen"}),e.jsx(j,{variant:"contained",color:"error",onClick:pe,disabled:g,children:"Löschen"})]})]})]})};export{Ve as default};
